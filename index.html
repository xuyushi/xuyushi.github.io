<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Xu Yushi Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="安卓开发之路">
<meta property="og:type" content="website">
<meta property="og:title" content="Xu Yushi Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Xu Yushi Blog">
<meta property="og:description" content="安卓开发之路">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xu Yushi Blog">
<meta name="twitter:description" content="安卓开发之路">
  
    <link rel="alternative" href="/atom.xml" title="Xu Yushi Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://farm4.staticflickr.com/3898/19134655491_08ecb4a373_b.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Xu Yushi</a></h1>
		</hgroup>

		
		<p class="header-subtitle">低调、务实、自驱、反思</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/categories/android">Andronid</a></li>
				        
							<li><a href="/categories/随笔">随笔</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/xuyushi/" title="github">github</a>
					        
								<a class="mail" target="_blank" href="/xmy166@gmail.com" title="mail">mail</a>
					        
								<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/view?id=391535324" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Gson/" style="font-size: 10px;">Gson</a> <a href="/tags/UI/" style="font-size: 13.33px;">UI</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/bluetooth/" style="font-size: 10px;">bluetooth</a> <a href="/tags/eventbus/" style="font-size: 10px;">eventbus</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/greendao/" style="font-size: 16.67px;">greendao</a> <a href="/tags/json/" style="font-size: 10px;">json</a> <a href="/tags/loader/" style="font-size: 10px;">loader</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/volley/" style="font-size: 10px;">volley</a> <a href="/tags/wifi/" style="font-size: 10px;">wifi</a> <a href="/tags/日记/" style="font-size: 10px;">日记</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Xu Yushi</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://farm4.staticflickr.com/3898/19134655491_08ecb4a373_b.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Xu Yushi</h1>
			</hgroup>
			
			<p class="header-subtitle">低调、务实、自驱、反思</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/categories/android">Andronid</a></li>
		        
					<li><a href="/categories/随笔">随笔</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/xuyushi/" title="github">github</a>
			        
						<a class="mail" target="_blank" href="/xmy166@gmail.com" title="mail">mail</a>
			        
						<a class="linkedin" target="_blank" href="http://www.linkedin.com/profile/view?id=391535324" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-Android 触摸事件传递机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/08/02/Android 触摸事件传递机制/" class="article-date">
  	<time datetime="2015-08-02T08:07:41.000Z" itemprop="datePublished">2015-08-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: Android 触摸事件传递机制</p>
<p>date: August 2, 2015 15:12 PM</p>
<p>categories: android</p>
<p>tags: [android,触摸事件]</p>
<h2 id="description:_之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递">description: 之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递</h2><p>[TOC]</p>
<h1 id="Android_触摸事件传递机制">Android 触摸事件传递机制</h1><p>之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递</p>
<h2 id="View">View</h2><h3 id="常用监听方法">常用监听方法</h3><p>view表示没有子空间的布局，例如textview、button等，MotionEvent分为三种</p>
<ul>
<li>MotionEvent.ACTION_DOWN：按下时候</li>
<li>MotionEvent.ACTION_MOVE：滑动时</li>
<li>MotionEvent.ACTION_UP：抬起时</li>
</ul>
<p>常用两种监听事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">******.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;		</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">*******.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span></span>&#123;</span><br><span class="line">				<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">	</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：setOnTouchListener中最后返回的是false</p>
</blockquote>
<p>通常一个按键触发的顺序是：</p>
<ol>
<li>onClick-&gt;MotionEvent.ACTION_DOWN</li>
<li>onClick-&gt;MotionEvent.ACTION_UP</li>
<li>OnClickListener</li>
</ol>
<p>若在setOnTouchListener返回true，则不会执行OnClickListener方法</p>
<h3 id="分析源码">分析源码</h3><p>在Button中并未发现dispatchTouchEvent代码，向上寻找，Button-&gt;TextVIew-&gt;View，在view中发现dispatchTouchEvent函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">     * Pass the touch screen motion event down to the target view, or this</span><br><span class="line">     * view if it is the target.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> event The motion event to be dispatched.</span><br><span class="line">     * <span class="doctag">@return</span> True if the event was handled by the view, false otherwise.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// If the event should be handled by accessibility focus first.</span></span><br><span class="line">        <span class="keyword">if</span> (event.isTargetAccessibilityFocus()) &#123;</span><br><span class="line">            <span class="comment">// We don't have focus or no virtual descendant has it, do not handle the event.</span></span><br><span class="line">            <span class="keyword">if</span> (!isAccessibilityFocusedViewOrHost()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// We have focus and got the event, then use normal event dispatch.</span></span><br><span class="line">            event.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mInputEventConsistencyVerifier.onTouchEvent(event, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = event.getActionMasked();</span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Defensive cleanup for new gesture</span></span><br><span class="line">            stopNestedScroll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class="line">            <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">            ListenerInfo li = mListenerInfo;</span><br><span class="line">            <span class="keyword">if</span> (li != <span class="keyword">null</span> &amp;&amp; li.mOnTouchListener != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</span><br><span class="line">                    &amp;&amp; li.mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>注意 if (li != null &amp;&amp; <strong>li.mOnTouchListener != null</strong>                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {</p>
<p>mOnTouchListener即注册的touch监听事件。</p>
<p>当li.mOnTouchListener 返回true时，result = true</p>
<p>在onTouchEvent中依次调用performClick()-&gt;li.mOnClickListener.onClick(this);</p>
<p>最终会回调用户注册的onclick函数</p>
<p>d</p>
<h3 id="测试代码">测试代码</h3><h4 id="主Activity">主Activity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MyButton button;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button = (MyButton) findViewById(R.id.button_id);</span><br><span class="line"></span><br><span class="line">        button.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                        Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnTouchListener()-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                        Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnTouchListener()-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnClickListener()-&gt;"</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"dispatchTouchEvent()-&gt;"</span>+<span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"dispatchTouchEvent()-&gt;"</span>+ <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"onTouchEvent()-&gt;"</span>+<span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"onTouchEvent()-&gt;"</span>+ <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="自定义Button">自定义Button</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/2.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyButton</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//注意 这里第二个参数不能省略，否则会导致崩溃，之后有时间学习研究</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyButton</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"onTouchEvent-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"onTouchEvent-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"dispatchTouchEvent-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"dispatchTouchEvent-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="布局文件">布局文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span> <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">io.github.xuyushi.toucheventtest.MyButton</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/button_id"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"button"</span></span><br><span class="line">        <span class="attribute">android:textSize</span>=<span class="value">"30dp"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="log">log</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnClickListener()-&gt;</span><br></pre></td></tr></table></figure>
<h4 id="若修改MyButton_dispatchTouchEvent返回值为true时">若修改MyButton dispatchTouchEvent返回值为true时</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br></pre></td></tr></table></figure>
<p>事件先由Activity的dispatchTouchEvent进行分发，然后TestButton的dispatchTouchEvent进行分发，接着执行onTouch监听，然后执行onTouchEvent。第二次UP动作的时候，在onTouchEvent里又执行了onClick监听</p>
<h4 id="若修改MyButton_onTouchEvent返回值为true时">若修改MyButton onTouchEvent返回值为true时</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：这里和参考博客的结果不一样，因为在dispatchTouchEvent源码中，进行之前做<strong> if (li != null &amp;&amp; </strong>li.mOnTouchListener != null<strong>                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {</strong>判断后，执行的是<code>result = true;</code>并不是 <code>return true;</code> 所以<code>onTouchEvent</code> 依然会执行</p>
</blockquote>
<p>所以只少一个 OnClickListener未执行</p>
<h2 id="ViewGroup">ViewGroup</h2><p>ViewGroup比View多一个onInterceptTouchEvent方法，此方法是用来拦截事件，拦截之后ViewGroup中的子布局是接受不到事件了。</p>
<h3 id="源码修改">源码修改</h3><h4 id="自定义布局">自定义布局</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/2.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLinearLayout</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyLinearLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"dispatchTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"dispatchTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onInterceptTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onInterceptTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="主activity增加监听">主activity增加监听</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mylayout.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span>(event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"setOnTouchListener()-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"setOnTouchListener()-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mylayout.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        Log.i(TAG, <span class="string">"MainActivity--mylayout-onClick..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="LOG">LOG</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;<span class="built_in">test</span>Btn---onClick</span><br><span class="line">MainActivity-&gt;OnClickListener()</span><br></pre></td></tr></table></figure>
<p>如果将Linearlayout的onInterceptTouchEvent 改成return true</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_UP</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">MainActivity--mylayout-onClick...</span><br></pre></td></tr></table></figure>
<p>由此可见，当onInterceptTouchEvent 返回ture之后，button接受不到事件了，只执行MyLinearLayout中的OnTouch 和OnClick了</p>
<h2 id="总结">总结</h2><p>1、如果是自定义复合控件，如图片+文字，我再Activity里给你注册了onClick监听，期望点击它执行。那么最简单的方法就是将图片+文字的父布局，也即让其容器ViewGroup的秘书将事件拦下，这样父亲就可以执行onClick了。这时候的父亲就像一个独立的孩子一样了(View)，再也不用管它的孩子了,可以正常onClick onTouch.</p>
<p>2、如果希望一个View只onTouch而不onClick，在onTouch里return true就ok了。</p>
<p>3、dispatch是为了onTouch监听，onTouchEvent是为了onClick监听。</p>
<p>4、自定义布局时，一般情况下：</p>
<p>@Override</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onTouchEvent</span><span class="params">(event)</span></span>;}  
</code></pre><p>@Override</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">dispatchTouchEvent</span><span class="params">(event)</span></span>;

我们可以复写，但是最后的<span class="keyword">super</span>.***是万万不能少滴。如果少了，表示连dispatch*** onTouchEvent压根就不调用了，事件就此打住。
</code></pre><h2 id="参考">参考</h2><blockquote>
<p><a href="http://blog.csdn.net/yanzi1225627/article/details/22592831" target="_blank" rel="external">http://blog.csdn.net/yanzi1225627/article/details/22592831</a></p>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/9097463" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/9097463</a></p>
<p><a href="http://www.cnblogs.com/sunzn/archive/2013/05/10/3064129.html" target="_blank" rel="external">http://www.cnblogs.com/sunzn/archive/2013/05/10/3064129.html</a></p>
</blockquote>
<h4 id=""> </h4>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-volley学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/12/volley学习/" class="article-date">
  	<time datetime="2015-07-12T09:13:00.000Z" itemprop="datePublished">2015-07-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/12/volley学习/">volley学习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="背景">背景</h2><p>Vollry特别适合数据量不大但是通信频繁的场景。</p>
<p>比如以前从网上下载图片的步骤可能这样的流程：</p>
<ul>
<li>在ListAdatpter-getview（）方法里开始图像的读取</li>
<li>通过AsyncTask等机制使用HttpURLConnection从服务器去读取图片资源</li>
<li>在AsyncTask-onPostExecute（）里设置相应的Imageview的属性</li>
</ul>
<p>而在Volley下，只需要一个函数即可</p>
<h2 id="Volley提供的功能：">Volley提供的功能：</h2><ul>
<li>JSON,图像等异步下载；</li>
<li>网络请求的排序</li>
<li>网络请求的优先级处理</li>
<li>缓存</li>
<li>多级别取消请求</li>
<li>和Activity的生命周期的联动（Activity结束的同时，取消所有网络请求）</li>
</ul>
<h2 id="下载volley_jar包">下载volley jar包</h2><h3 id="法1">法1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://android.googlesource.com/platform/frameworks/volley</span><br><span class="line">$ <span class="built_in">cd</span> volley</span><br><span class="line">$ android update project -p .</span><br><span class="line">$ ant jar</span><br></pre></td></tr></table></figure>
<p>复制<code>bin/volley.jar</code> 到工程 <code>libs/</code>目录<br>在android studio中 add as library</p>
<h3 id="法2">法2</h3><p>直接下载 <a href="http://api.androidhive.info/volley/volley.jar" target="_blank" rel="external">http://api.androidhive.info/volley/volley.jar</a></p>
<h3 id="法3">法3</h3><p>gradle加入<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.mcxiaoke.volley:library:1.0.+'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>非官方的镜像</p>
</blockquote>
<h2 id="StringRequest的用法">StringRequest的用法</h2><h3 id="加上网络权限">加上网络权限</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="获取RequestQueue对象">获取RequestQueue对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestQueue mQueue = Volley.newRequestQueue(context);</span><br></pre></td></tr></table></figure>
<p>注意这里拿到的RequestQueue是一个请求队列对象，它可以缓存所有的HTTP请求，然后按照一定的算法并发地发出这些请求。RequestQueue内部的设计就是非常合适高并发的，因此我们不必为每一次HTTP请求都创建一个RequestQueue对象，这是非常浪费资源的，基本上在每一个需要和网络交互的Activity中创建一个RequestQueue对象就足够了。</p>
<h3 id="创建一个StringRequest对象">创建一个StringRequest对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">StringRequest stringRequest = <span class="keyword">new</span> StringRequest(<span class="string">"http://www.baidu.com"</span>,</span><br><span class="line">		<span class="keyword">new</span> Response.Listener&lt;String&gt;() &#123;</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(String response)</span> </span>&#123;</span><br><span class="line">				Log.d(<span class="string">"TAG"</span>, response);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;</span><br><span class="line">		Log.e(<span class="string">"TAG"</span>, error.getMessage(), error);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>参数1：目标服务器地址<br>参数2：响应成功的回调函数<br>参数3：响应十八的回调函数</p>
<h3 id="将这个StringRequest对象添加到RequestQueue">将这个StringRequest对象添加到RequestQueue</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mQueue.add(stringRequest);</span><br></pre></td></tr></table></figure>
<h2 id="post请求">post请求</h2><p>Volley会尝试调用StringRequest的父类——Request中的getParams()方法来获取POST参数,，我们只需要在StringRequest的匿名类中重写getParams()方法，在这里设置POST参数就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringRequest stringRequest = <span class="keyword">new</span> StringRequest(Method.POST, url,  listener, errorListener) &#123;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> Map&lt;String, String&gt; getParams() <span class="keyword">throws</span> AuthFailureError &#123;  </span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();  </span><br><span class="line">        map.put(<span class="string">"params1"</span>, <span class="string">"value1"</span>);  </span><br><span class="line">        map.put(<span class="string">"params2"</span>, <span class="string">"value2"</span>);  </span><br><span class="line">        <span class="keyword">return</span> map;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="JsonRequest的用法">JsonRequest的用法</h2><p>JsonRequest有两个直接的子类<br>JsonObjectRequest和JsonArrayRequest，从名字上你应该能就看出它们的区别了吧？一个是用于请求一段JSON数据的，一个是用于请求一段JSON数组的</p>
<p>同理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">JsonObjectRequest jsonObjectRequest = <span class="keyword">new</span> JsonObjectRequest(<span class="string">"http://m.weather.com.cn/data/101010100.html"</span>, <span class="keyword">null</span>,  </span><br><span class="line">        <span class="keyword">new</span> Response.Listener&lt;JSONObject&gt;() &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(JSONObject response)</span> </span>&#123;  </span><br><span class="line">                Log.d(<span class="string">"TAG"</span>, response.toString());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, <span class="keyword">new</span> Response.ErrorListener() &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;  </span><br><span class="line">                Log.e(<span class="string">"TAG"</span>, error.getMessage(), error);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mQueue.add(jsonObjectRequest);</span><br></pre></td></tr></table></figure>
<h2 id="使用Volley加载网络图片">使用Volley加载网络图片</h2><h3 id="ImageRequest的用法">ImageRequest的用法</h3><h4 id="创建RequestQueue对象">创建RequestQueue对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestQueue mQueue = Volley.newRequestQueue(context);</span><br></pre></td></tr></table></figure>
<h4 id="实例化ImageRequest对象">实例化ImageRequest对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getImg</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">	RequestQueue mQueue = Volley.newRequestQueue(<span class="keyword">this</span>);</span><br><span class="line">	ImageRequest imageRequest = <span class="keyword">new</span> ImageRequest(</span><br><span class="line">			<span class="string">"http://avatar.csdn.net/blogpic/20140903135550859.jpg"</span>,</span><br><span class="line">			<span class="keyword">new</span> Response.Listener&lt;Bitmap&gt;() &#123;</span><br><span class="line">				<span class="annotation">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Bitmap response)</span> </span>&#123;</span><br><span class="line">					imageView.setImageBitmap(response);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;, <span class="number">0</span>, <span class="number">0</span>, Bitmap.Config.RGB_565, <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;</span><br><span class="line">			imageView.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p>参数1：图片地址<br>参数2：回调函数，在此把接受的bitmap设置到imageView中<br>参数3：图片最大宽度<br>参数4：图片最大高度<br>参数5：图片的颜色（ARGB_8888最好的颜色。RGB_565每个像素2字节）</p>
<h4 id="imageRequest加入队列">imageRequest加入队列</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mQueue.add(imageRequest);</span><br></pre></td></tr></table></figure>
<h3 id="ImageLoader的用法">ImageLoader的用法</h3><ol>
<li>创建一个RequestQueue对象。</li>
<li>创建一个ImageLoader对象。</li>
<li>获取一个ImageListener对象。</li>
<li>调用ImageLoader的get()方法加载网络上的图片。<h4 id="新建一个ImageLoader对">新建一个ImageLoader对</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(mQueue, <span class="keyword">new</span> ImageCache() &#123;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putBitmap</span><span class="params">(String url, Bitmap bitmap)</span> </span>&#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getBitmap</span><span class="params">(String url)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>参数1：RequestQueue<br>参数2：ImageCache对象</p>
<h4 id="获取一个ImageListener对象">获取一个ImageListener对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ImageListener listener = ImageLoader.getImageListener(imageView,  </span><br><span class="line">        R.drawable.default_image, R.drawable.failed_image);</span><br></pre></td></tr></table></figure>
<p>我们通过调用ImageLoader的getImageListener()方法能够获取到一个ImageListener对象，getImageListener()方法接收三个参数，第一个参数指定用于显示图片的ImageView控件，第二个参数指定加载图片的过程中显示的图片，第三个参数指定加载图片失败的情况下显示的图片。</p>
<h4 id="调用ImageLoader的get()方法来加载图片">调用ImageLoader的get()方法来加载图片</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageLoader.get(<span class="string">"http://img.my.csdn.net/uploads/201404/13/1397393290_5765.jpeg"</span>, listener);</span><br></pre></td></tr></table></figure>
<h4 id="cache的实现">cache的实现</h4><p>BitmapCache并实现了ImageCache接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitmapCache</span> <span class="keyword">implements</span> <span class="title">ImageCache</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> LruCache&lt;String, Bitmap&gt; mCache;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BitmapCache</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> maxSize = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">        mCache = <span class="keyword">new</span> LruCache&lt;String, Bitmap&gt;(maxSize) &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap bitmap)</span> </span>&#123;  </span><br><span class="line">                <span class="keyword">return</span> bitmap.getRowBytes() * bitmap.getHeight();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getBitmap</span><span class="params">(String url)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> mCache.get(url);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putBitmap</span><span class="params">(String url, Bitmap bitmap)</span> </span>&#123;  </span><br><span class="line">        mCache.put(url, bitmap);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到，这里我们将缓存图片的大小设置为10M。接着修改创建ImageLoader实例的代码，第二个参数传入BitmapCache的实例，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(mQueue, <span class="keyword">new</span> BitmapCache());</span><br></pre></td></tr></table></figure></p>
<p>除了以上两种方式之外，Volley还提供了第三种方式来加载网络图片，即使用NetworkImageView。不同于以上两种方式，NetworkImageView是一个自定义控制，它是继承自ImageView的，具备ImageView控件的所有功能，并且在原生的基础之上加入了加载网络图片的功能。NetworkImageView控件的用法要比前两种方式更加简单，大致可以分为以下五步：</p>
<ol>
<li>创建一个RequestQueue对象。</li>
<li>创建一个ImageLoader对象。</li>
<li>在布局文件中添加一个NetworkImageView控件。</li>
<li>在代码中获取该控件的实例。</li>
<li>设置要加载的图片地址。</li>
</ol>
<p>其中，第一第二步和ImageLoader的用法是完全一样的，因此这里我们就从第三步开始学习了。首先修改布局文件中的代码，在里面加入NetworkImageView控件，如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span>  </span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"fill_parent"</span>  </span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> &gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span>  </span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/button"</span>  </span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span>  </span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span>  </span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"Send Request"</span> /&gt;</span>  </span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;<span class="title">com.android.volley.toolbox.NetworkImageView</span>   </span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/network_image_view"</span>  </span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"200dp"</span>  </span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"200dp"</span>  </span><br><span class="line">        <span class="attribute">android:layout_gravity</span>=<span class="value">"center_horizontal"</span>  </span><br><span class="line">        /&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>获取控件<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">networkImageView = (NetworkImageView) findViewById(R.id.network_image_view);</span><br></pre></td></tr></table></figure></p>
<p>得到了NetworkImageView控件的实例之后，我们可以调用它的setDefaultImageResId()方法、setErrorImageResId()方法和setImageUrl()方法来分别设置加载中显示的图片，加载失败时显示的图片，以及目标图片的URL地址，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">networkImageView.setDefaultImageResId(R.drawable.default_image);  </span><br><span class="line">networkImageView.setErrorImageResId(R.drawable.failed_image);  </span><br><span class="line">networkImageView.setImageUrl(<span class="string">"http://img.my.csdn.net/uploads/201404/13/1397393290_5765.jpeg"</span>,  </span><br><span class="line">                imageLoader);</span><br></pre></td></tr></table></figure></p>
<p>NetworkImageView并不需要提供任何设置最大宽高的方法也能够对加载的图片进行压缩。这是由于NetworkImageView是一个控件，在加载图片的时候它会自动获取自身的宽高，然后对比网络图片的宽度，再决定是否需要对图片进行压缩。也就是说，压缩过程是在内部完全自动化的，并不需要我们关心，NetworkImageView会始终呈现给我们一张大小刚刚好的网络图片，不会多占用任何一点内存，这也是NetworkImageView最简单好用的一点吧。</p>
<blockquote>
<p>转自 ：<a href="http://blog.csdn.net/guolin_blog/article/details/17482165" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/17482165</a></p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/volley/">volley</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-wifi压力测试" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/09/wifi压力测试/" class="article-date">
  	<time datetime="2015-07-09T11:12:00.000Z" itemprop="datePublished">2015-07-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/09/wifi压力测试/">wifi压力测试</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="效果图">效果图</h2><p><img src="https://raw.githubusercontent.com/xuyushi/Blog_img/master/wifitest.gif" alt="效果图"></p>
<p>开关wifi<br>并且在开wifi后，判断网络连接<br>由于存在wifi连接之后并没有网络的情况，所以采用ping 来判断网络的通断</p>
<h2 id="AndroidManifest中申请权限">AndroidManifest中申请权限</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.CHANGE_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.WAKE_LOCK"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.WRITE_SETTINGS"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="控件，界面初始化">控件，界面初始化</h2><p>  详见源码</p>
<h2 id="循环任务">循环任务</h2><p>使用timer来实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTest</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">       isRunning = <span class="keyword">true</span>;</span><br><span class="line">       mTimer = <span class="keyword">new</span> Timer();</span><br><span class="line">       mTimer.schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">           <span class="annotation">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">if</span> (!isRunning || (mMaxTestCount != <span class="number">0</span> &amp;&amp; mCurrentCount &gt;= mMaxTestCount)) &#123;</span><br><span class="line">                   mHandler.sendEmptyMessage(<span class="number">0</span>);</span><br><span class="line">                   mTimer.cancel();</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">if</span> (mWifiManager.getWifiState() == mWifiManager.WIFI_STATE_DISABLED) &#123;</span><br><span class="line">                       mWifiManager.setWifiEnabled(<span class="keyword">true</span>);</span><br><span class="line">                       Log.d(TAG, <span class="string">"*********wifistate is closed, try open wifi now!*****"</span>);</span><br><span class="line">                   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mWifiManager.getWifiState() == mWifiManager.WIFI_STATE_ENABLED) &#123;</span><br><span class="line">                       pingIpAddr();</span><br><span class="line">                       <span class="keyword">if</span> (<span class="keyword">null</span> != mPingIpAddrResult) &#123;</span><br><span class="line">                           Log.d(TAG, mPingIpAddrResult);</span><br><span class="line">                       &#125;</span><br><span class="line">                       mWifiManager.setWifiEnabled(<span class="keyword">false</span>);</span><br><span class="line">                       Log.d(TAG, <span class="string">"*********wifistate is opened, try close wifi now!******"</span>);</span><br><span class="line">                       incCurCount();</span><br><span class="line">                   &#125;</span><br><span class="line">                   mHandler.sendEmptyMessage(<span class="number">1</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, <span class="number">2000</span>, <span class="number">10000</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>判断 isRunning 标志位，</p>
<ul>
<li>如果为！isRunning ，或者任务的次数执行完毕，则取消定时任务。并且发送message(0)</li>
<li>如果为！isRunning，切换wifi的状态，并在wifi开的适合判断网络连接，并且发送message（1）</li>
</ul>
<h3 id="判断网络通断代码">判断网络通断代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pingIpAddr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span>: Hardcoded for now, make it UI configurable</span></span><br><span class="line">            Process p = Runtime.getRuntime().exec(<span class="string">"ping -c 1 -w 7 "</span> + mIpAddress);</span><br><span class="line">            <span class="keyword">int</span> status = p.waitFor();</span><br><span class="line">            <span class="keyword">if</span> (status == <span class="number">0</span>) &#123;</span><br><span class="line">                mPingIpAddrResult = <span class="string">"Pass"</span>;</span><br><span class="line">                mPassCount++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mPingIpAddrResult = <span class="string">"Fail: IP addr not reachable"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            mPingIpAddrResult = <span class="string">"Fail: IOException"</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            mPingIpAddrResult = <span class="string">"Fail: InterruptedException"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>Runtime.getRuntime().exec</code>来执行命令行<br><code>status = p.waitFor();</code>来获取运行结果。</p>
<blockquote>
<p>p.waitFor会阻塞</p>
</blockquote>
<h2 id="自定义handle处理消息">自定义handle处理消息</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                  isRunning = <span class="keyword">false</span>;</span><br><span class="line">                  <span class="keyword">if</span> (mTimer != <span class="keyword">null</span>)</span><br><span class="line">                      mTimer.cancel();</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                  currentCount.setText(getString(R.string.current_count) + mCurrentCount);</span><br><span class="line">                  passCount.setText(getString(R.string.pass_count) + mPassCount);</span><br><span class="line">                  Log.d(TAG, <span class="string">"already test time:"</span> + mCurrentCount);</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">default</span>:</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>源码：<a href="https://github.com/xuyushi/WifiTest" target="_blank" rel="external">https://github.com/xuyushi/WifiTest</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wifi/">wifi</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-loader 总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/05/loader 总结/" class="article-date">
  	<time datetime="2015-07-05T07:57:00.000Z" itemprop="datePublished">2015-07-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/05/loader 总结/">loader 总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="本文实现的功能">本文实现的功能</h2><p>在listfragment使用自定义的adpter现实数据库的数据，当数据库的数据发生变化时，自动刷新</p>
<p>效果如下<br><img src="https://raw.githubusercontent.com/xuyushi/Blog_img/master/loader1.gif" alt="loader"></p>
<h2 id="用到的知识点">用到的知识点</h2><ol>
<li>listfragment</li>
<li><a href="http://xuyushi.github.io/2015/06/29/GreenDao学习/" target="_blank" rel="external">GreenDao</a></li>
<li>自定义loader</li>
<li>自定义adapter</li>
<li>loaderManger</li>
<li>contentobserver监听数据库</li>
</ol>
<h2 id="实现过程">实现过程</h2><h3 id="数据库的简历">数据库的简历</h3><p>不做过多分析，详见<a href="http://xuyushi.github.io/2015/06/29/GreenDao学习/" target="_blank" rel="external">GreenDao</a><br>建立了student表，包括</p>
<ol>
<li>id</li>
<li>name</li>
<li>age</li>
</ol>
<p>在DBHleper中实现了以下增加，删除的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addToStudentTable</span><span class="params">(de.greenrobot.daoexample.Student student)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == Student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Student.insert(student);</span><br><span class="line">    <span class="keyword">if</span> (mObserver!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        mObserver.onChange(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Student.loadAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Student.deleteAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在MainActivity的onCreat方法初始化数据库<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DBHelper.getInstance(<span class="keyword">this</span>).clearStudent();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i &lt; STUDENT_NUM;i++) &#123;</span><br><span class="line">        student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setName(<span class="string">"testname"</span>+i);</span><br><span class="line">        student.setAge(<span class="number">10</span>+i);</span><br><span class="line">        DBHelper.getInstance(<span class="keyword">this</span>).addToStudentTable(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在主界面中增加一个按钮，用来增加数据库，用来观测loader是否刷新List<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add_sth</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    student = <span class="keyword">new</span> Student();</span><br><span class="line">    student.setName(<span class="string">"createdByButton"</span>);</span><br><span class="line">    student.setAge(<span class="number">100</span>);</span><br><span class="line">    DBHelper.getInstance(<span class="keyword">this</span>).addToStudentTable(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="实现自定义adapter">实现自定义adapter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mresourceId; <span class="comment">//对应的xml布局文件，也可以不传出来，在getView中写死。</span></span><br><span class="line">    <span class="keyword">private</span> Context mcontext;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; mdata;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentAdapter</span><span class="params">(Context context, <span class="keyword">int</span> resourceId, List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        mresourceId = resourceId;</span><br><span class="line">        mcontext = context;</span><br><span class="line">        mdata = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mdata.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mdata.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//convertView用于将之前加载好的view缓存</span></span><br><span class="line">        ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">        View view;</span><br><span class="line">        Student student = (Student) getItem(position);</span><br><span class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">            holder = <span class="keyword">new</span> ViewHolder();</span><br><span class="line"></span><br><span class="line">            view = LayoutInflater.from(mcontext).inflate(mresourceId, <span class="keyword">null</span>);</span><br><span class="line">            holder.id = (TextView) view.findViewById(R.id.id);</span><br><span class="line">            holder.name = (TextView) view.findViewById(R.id.name);</span><br><span class="line">            holder.age = (TextView) view.findViewById(R.id.age);</span><br><span class="line">            view.setTag(holder);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view = convertView;</span><br><span class="line">            holder = (ViewHolder) view.getTag();</span><br><span class="line">        &#125;</span><br><span class="line">        holder.id.setText(<span class="string">"id"</span> + student.getId().toString());</span><br><span class="line">        holder.name.setText(<span class="string">"name"</span> + student.getName());</span><br><span class="line">        holder.age.setText(<span class="string">"age"</span> + student.getAge());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        TextView id;</span><br><span class="line">        TextView name;</span><br><span class="line">        TextView age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用holder可以大大加快程序效率，避免重复加载。</p>
<h3 id="自定义loader">自定义loader</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xuyushi.loadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.AsyncTaskLoader;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.content.Loader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.greenrobot.DBHelper;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.Student;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/7/5.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentLoader</span> <span class="keyword">extends</span> <span class="title">AsyncTaskLoader</span>&lt;<span class="title">List</span>&lt;<span class="title">Student</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; mdata;</span><br><span class="line">    <span class="keyword">final</span> ForceLoadContentObserver mObserver ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentLoader</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        mObserver = <span class="keyword">new</span> ForceLoadContentObserver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">loadInBackground</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            mdata =  DBHelper.getInstance(getContext()).getStudent();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mdata;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliverResult</span><span class="params">(List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        mdata = data;</span><br><span class="line">        <span class="keyword">if</span> (isStarted()) &#123;</span><br><span class="line">            <span class="keyword">super</span>.deliverResult(data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStartLoading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStartLoading();</span><br><span class="line">        <span class="keyword">if</span> (mdata != <span class="keyword">null</span>) &#123;</span><br><span class="line">            deliverResult(mdata);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mdata == <span class="keyword">null</span>) &#123;</span><br><span class="line">            forceLoad();</span><br><span class="line">        &#125;</span><br><span class="line">        DBHelper.getInstance(getContext()).registerObserver(mObserver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCanceled</span><span class="params">(List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCanceled(data);</span><br><span class="line">        cancelLoad();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onReset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onReset();</span><br><span class="line">        onStopLoading();</span><br><span class="line">        <span class="keyword">if</span> (mdata != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//释放资源</span></span><br><span class="line">            mdata = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>onStartLoading：注册一些监听器到loader上，并且执行一次forceLoad(); 否则loader不会开始工作</li>
<li>loadInBackground：加载数据并且返回，其实这个数据就返回到了回调函数中LoaderManager的onLoadFinished方法第二个data参数</li>
<li>onStopLoading：停止加载数据，但不要停止监听也不要释放数据，就可以随时重启loader</li>
<li>onReset：先确保已经停止加载数据了，然后释放掉监听器并设为null</li>
<li>onCanceled： 在这里可以释放资源，如果是list就不需要做什么了，但是象cursor或者打开了什么文件就应该关闭一下</li>
</ul>
<h3 id="fragment">fragment</h3><p>继承fragmentlist ，并实现 LoaderManager.LoaderCallbacks方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/7/5.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fragment1</span> <span class="keyword">extends</span> <span class="title">ListFragment</span> <span class="keyword">implements</span></span><br><span class="line">        <span class="title">LoaderManager</span>.<span class="title">LoaderCallbacks</span>&lt;<span class="title">List</span>&lt;<span class="title">Student</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StudentAdapter mAdapter;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; mStudents;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater,</span><br><span class="line">                             ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment1, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">//在fragment中获取context的方法getActivity().getApplicationContext()</span></span><br><span class="line">        <span class="comment">//设置list的Adapter</span></span><br><span class="line"><span class="comment">//        setListAdapter(new StudentAdapter(getActivity().getApplicationContext(),</span></span><br><span class="line"><span class="comment">//                R.layout.student_adpter,</span></span><br><span class="line"><span class="comment">//                DBHelper.getInstance(getActivity().getApplicationContext()).getStudent()));</span></span><br><span class="line">        mStudents = DBHelper.getInstance(getActivity().getApplicationContext()).getStudent();</span><br><span class="line">        mAdapter = <span class="keyword">new</span> StudentAdapter(getActivity().getApplicationContext(),</span><br><span class="line">                R.layout.student_adpter,</span><br><span class="line">                mStudents);</span><br><span class="line">        setListAdapter(mAdapter);</span><br><span class="line">        getLoaderManager().initLoader(<span class="number">2</span>, <span class="keyword">null</span>, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onListItemClick</span><span class="params">(ListView parent, View v,</span><br><span class="line">                                <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Toast.makeText(getActivity(),</span></span><br><span class="line"><span class="comment">//                "You have selected " + presidents[position],</span></span><br><span class="line"><span class="comment">//                Toast.LENGTH_SHORT).show();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//回调函数</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Loader&lt;List&lt;Student&gt;&gt; onCreateLoader(<span class="keyword">int</span> id, Bundle args) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StudentLoader(getActivity().getApplicationContext());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadFinished</span><span class="params">(Loader&lt;List&lt;Student&gt;&gt; loader, List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAdapter) &#123;</span><br><span class="line">            mStudents.clear();</span><br><span class="line">            mStudents.addAll(DBHelper.getInstance(getActivity().getApplicationContext()).getStudent());</span><br><span class="line">            mAdapter.notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoaderReset</span><span class="params">(Loader&lt;List&lt;Student&gt;&gt; loader)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>onLoadFinished:中的第二个参数，即loader在doinbackfround的返回值</li>
</ul>
<blockquote>
<p>注：在调试中发现虽然 mStudents 的数据刷新了，但是直接调用 mAdapter.notifyDataSetChanged();并不能刷新界面。<br>原因是:mAdapter会通过mStudents获取数据库中的内容。但是实际上可能是，在调用super(MyActivity.this, R.layout.item, usersList)时mAdapter保存了指向原数据库的引用，在调用query函数之后，mstudent指向了一个新的List（List b）。但是在调用notifyDataSetChanged()时，mAdapter会跟据保存的引用（即指向List a的引用）去更新，因此当然还是原来的结果，不会进行更新。</p>
</blockquote>
<p>所以有以下修改<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mStudents.clear();           mStudents.addAll(DBHelper.getInstance(getActivity().getApplicationContext()).getStudent());</span><br><span class="line">            mAdapter.notifyDataSetChanged();</span><br></pre></td></tr></table></figure></p>
<h3 id="contentobserver监听数据库">contentobserver监听数据库</h3><p>通过contentobserver可以实时的更新数据库中的信息，无需去轮询。</p>
<h4 id="在StudentLoader中注册contentobserver">在StudentLoader中注册contentobserver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStartLoading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStartLoading();</span><br><span class="line">    <span class="keyword">if</span> (mdata != <span class="keyword">null</span>) &#123;</span><br><span class="line">        deliverResult(mdata);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mdata == <span class="keyword">null</span>) &#123;</span><br><span class="line">        forceLoad();</span><br><span class="line">    &#125;</span><br><span class="line">    DBHelper.getInstance(getContext()).registerObserver(mObserver);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="DBHelper中">DBHelper中</h4><h5 id="定义mObserver">定义mObserver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Loader.ForceLoadContentObserver mObserver;</span><br></pre></td></tr></table></figure>
<h5 id="实现注册函数registerObserver">实现注册函数registerObserver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Loader&lt;List&lt;Student&gt;&gt;.ForceLoadContentObserver Observer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mObserver = Observer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即把变量取出</p>
<h5 id="在数据库改变的地方发出通知">在数据库改变的地方发出通知</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addToStudentTable</span><span class="params">(de.greenrobot.daoexample.Student student)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == Student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Student.insert(student);</span><br><span class="line">    <span class="keyword">if</span> (mObserver!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        mObserver.onChange(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用<code>mObserver.onChange(true);</code>发出通知</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/greendao/">greendao</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/loader/">loader</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-使用命令行查看android sqlite数据库" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/05/使用命令行查看android sqlite数据库/" class="article-date">
  	<time datetime="2015-07-05T01:33:00.000Z" itemprop="datePublished">2015-07-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/05/使用命令行查看android sqlite数据库/">使用命令行查看android sqlite数据库</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="首先adb_shell连接虚拟机或者设备">首先adb shell连接虚拟机或者设备</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br></pre></td></tr></table></figure>
<h2 id="进入数据库目录">进入数据库目录</h2><p>通常在/data/data/包名/databases 下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /data/data/com.example.xuyushi.loadertest/databases</span><br></pre></td></tr></table></figure></p>
<h2 id="进入数据库">进入数据库</h2><p>使用sqlite3 进入，需要安装工具<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite3 xxxx</span><br></pre></td></tr></table></figure></p>
<p>提示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQLite version <span class="number">3.7</span>.<span class="number">11</span> <span class="number">2012</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">11</span>:<span class="number">35</span>:<span class="number">50</span></span><br><span class="line">Enter <span class="string">".help"</span> <span class="keyword">for</span> instructions</span><br><span class="line">Enter SQL statements terminated with a <span class="string">";"</span></span><br><span class="line">sqlite&gt;</span><br></pre></td></tr></table></figure></p>
<p>使用<code>.help</code>可以查看帮助</p>
<h2 id="使用-table查看已建的表格">使用.table查看已建的表格</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .table</span><br></pre></td></tr></table></figure>
<p>提示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .table</span><br><span class="line">STUDENT           android_metadata</span><br></pre></td></tr></table></figure></p>
<h2 id="使用SELECT查看表内容">使用SELECT查看表内容</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ SELECT * FROM STUDENT;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意有分号</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite&gt; SELECT * FROM STUDENT;</span><br><span class="line"><span class="number">1</span>|zhangsan|<span class="number">22</span></span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/greendao/">greendao</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlite/">sqlite</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-蓝牙学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/01/蓝牙学习/" class="article-date">
  	<time datetime="2015-07-01T11:16:00.000Z" itemprop="datePublished">2015-07-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/01/蓝牙学习/">蓝牙学习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h2 id="权限">权限</h2><p>有两种权限，至少需要一种权限</p>
<ol>
<li><code>BLUETOOTH</code>:执行任何蓝牙通信，例如请求一个连接、接受一个连接以及传输数据</li>
<li><code>BLUETOOTH_ADMIN</code>：初始化设备查找或控制蓝牙设置</li>
</ol>
<blockquote>
<p>如果你使用BLUETOOTH_ADMIN权限，那么必须拥有BLUETOOTH权限。</p>
</blockquote>
<p>在manifest文件中声明权限<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">...</span> &gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.BLUETOOTH"</span> /&gt;</span>    </span><br><span class="line">    ...  </span><br><span class="line"><span class="tag">&lt;/<span class="title">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="设置蓝牙">设置蓝牙</h2><p>在使用蓝牙和其他设备通信之前，要确保本地设备支持蓝牙，并处于打开的状态。</p>
<h3 id="获取BluetoothAdapter">获取BluetoothAdapter</h3><p> 使用getDefaultAdapter方法来获取，如果获取的为null则表示设备不支持蓝牙。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</span><br><span class="line"><span class="keyword">if</span> (mBluetoothAdapter == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Device does not support Bluetooth</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="开启蓝牙">开启蓝牙</h3><p>用<code>isEnabled()</code>来检测蓝牙是否开启，若没用使用<code>startActivityForResult()</code> 的 <code>ACTION_REQUEST_ENABLE</code>来启动一个activity来提示用户启动蓝牙<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!mBluetoothAdapter.isEnabled()) &#123;</span><br><span class="line">    Intent enableBtIntent = <span class="keyword">new</span> Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);</span><br><span class="line">    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行完后，会有一个对话框出现，提示打开蓝牙，如果用户点击 是，系统则会打开蓝牙，返回打开成功/失败的状态</p>
<p>在<code>onActivityResult</code>中接受蓝牙打开的状态<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">	<span class="comment">//resultCode 是之前startActivityForResult中的REQUEST_ENABLE_BT</span></span><br><span class="line">	Log.d(TAG, <span class="string">"requestCode:"</span> + requestCode + <span class="string">"\n resultCode: "</span> + resultCode);</span><br><span class="line">	<span class="keyword">if</span> ((requestCode==RESULT_OK)||(requestCode==RESULT_FIRST_USER)) &#123;</span><br><span class="line">		Log.d(TAG, <span class="string">"；蓝牙开启成功"</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		Log.d(TAG, <span class="string">"；蓝牙开启失败"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="查找设备">查找设备</h2><p>使用<code>BluetoothAdapter</code>发现远程蓝牙设备或者本地已绑定的设备<br>设备查找是一个扫描周围蓝牙设备的过程，在此过程中，周围的蓝牙设备会回应一些信息，例如设备名，类，mac地址等。利用这些信息，发起扫描的设备可以选择一个设备进行连接</p>
<p>一旦第一次连接发起时，配对请求会自动呈现给用户，当设备配对后，设备的基本信息（设备名，mac地址）会被保存，而且可以使用蓝牙的API接口读出来，使用已知的mac地址，不用扫描，连接可以随时建立。<br>配对不等同于连接。配对表示两个设备知道彼此的存在，连接表示两个设备共享一个RFCOMM可以互相发送数据，在进行数据发送之前，设备必须配对。</p>
<h3 id="查询已配对的设备">查询已配对的设备</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();</span><br><span class="line"><span class="comment">// If there are paired devices</span></span><br><span class="line"><span class="keyword">if</span> (pairedDevices.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Loop through paired devices</span></span><br><span class="line">    <span class="keyword">for</span> (BluetoothDevice device : pairedDevices) &#123;</span><br><span class="line">        <span class="comment">// Add the name and address to an array adapter to show in a ListView</span></span><br><span class="line">        mArrayAdapter.add(device.getName() + <span class="string">"\n"</span> + device.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扫描设备">扫描设备</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> BroadcastReceiver mReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">            String action = intent.getAction();</span><br><span class="line">            <span class="comment">// When discovery finds a device</span></span><br><span class="line">            <span class="keyword">if</span> (BluetoothDevice.ACTION_FOUND.equals(action)) &#123;</span><br><span class="line">                <span class="comment">// Get the BluetoothDevice object from the Intent</span></span><br><span class="line">                BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);</span><br><span class="line">                <span class="comment">// Add the name and address to an array adapter to show in a ListView</span></span><br><span class="line">                mArrayAdapter.add(device.getName() + <span class="string">"\n"</span> + device.getAddress());</span><br><span class="line">                Log.d(TAG, device.getName() + <span class="string">"\n"</span> + device.getAddress());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="comment">// Register the BroadcastReceiver</span></span><br><span class="line">IntentFilter filter = <span class="keyword">new</span> IntentFilter(BluetoothDevice.ACTION_FOUND);</span><br><span class="line">registerReceiver(mReceiver, filter); <span class="comment">// Don't forget to unregister during onDestroy</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>SCAN需要BLUETOOTH_ADMIN权限</p>
</blockquote>
<h3 id="可被查找">可被查找</h3><p>弹出一个对话框，用户点允许则可被发现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent discoverableIntent = <span class="keyword">new</span></span><br><span class="line">Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE);</span><br><span class="line">discoverableIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, <span class="number">300</span>);</span><br><span class="line">startActivity(discoverableIntent);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如过蓝牙未被开启，用户点击可被发现时，蓝牙被自动开启。</p>
</blockquote>
<p><code>discoverableIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, 300);</code> 最后一个参数是可被查找的时间。设置为0，为一直可被发现。<br>可被查找状态改变时希望获取状态可以有以下实现方式：<br>注册一个<code>ACTION_SCAN_MODE_CHANGED</code>intent其中 extra fields<code>EXTRA_SCAN_MODE</code>and <code>EXTRA_PREVIOUS_SCAN_MODE</code>表示之前状态和现在状态</p>
<h2 id="连接设备">连接设备</h2><p>为了在两个设备建立一个连接，需要实现server和clint的接口，一个设备打开server socker，另一个设备开始连接(用server的mac地址连接)，当他们在同一个RFCOMM频道上建立了<code>BluetoothSocket</code>连接时，则认为他们连接上了。此时设备可以获取输入输出流可以开始传输数据，本节描述了两台设备之间初始化连接。</p>
<p>server和client获取<code>BluetoothSocket</code>的方式不同。server在接受连接是会得到BluetoothSocket。client在向服务器端打开一个RFCOMM通道时会得到BluetoothSocket。</p>
<h3 id="server端连接">server端连接</h3><p>当你希望连接两台设备，一台设备必须作为server持有并打开<code>BluetoothServerSocket</code>，为了监听接受的连接请求，当一个请求接受后，提供一个<code>BluetoothSocket</code>，==当该<code>BluetoothSocket</code>被<code>BluetoothServerSocket</code>请求时，<code>BluetoothServerSocket</code>可以（而且应当）被舍弃==</p>
<p>下面是创建一个服务器socket并且接受一个连接的基本过程：</p>
<ol>
<li>通过调用 <code>listenUsingRfcommWithServiceRecord(String, UUID)</code>获取一个<code>BluetoothServerSocket</code><br>string 是独一无二的你的server名，系统将会把它写入设备中的一个新的服务发现协议（SDP）数据库条目中（名字是任意的，并且可以只是你应用的名字）。UUID同样被包含在SDP条目中，并且将会成为和客户端设备连接协议的基础。也就是说，==当客户端尝试连接这个设备时，它将会携带一个UUID用于唯一指定它想要连接的服务器。==这些UUIDs必须匹配以便该连接可以被接受（在下一步中）。</li>
<li>通过调用accept()开始监听连接请求。<br>这一个阻塞调用。在一个连接被接受或一个异常出现时，它将会返回。只有当一个远程设备使用一个UUID发送了一个连接请求，并且该UUID和正在监听的服务器socket注册的UUID相匹配时，一个连接才会被接受。成功后，accept() 将会返回一个已连接的 <code>BluetoothSocket</code>。</li>
<li>调用close()，除非你想要接受更多的连接。<br>这将释放服务器socket和它所有的资源，但是不会关闭 accept()返回的已连接的 BluetoothSocket。不同于TCP/IP，RFCOMM仅仅允许每一个通道上在某一时刻只有一个已连接的客户端，因此在大多数情况下在接受一个已连接的socket后，在BluetoothServerSocket上调用 close() 是非常必要的。</li>
</ol>
<p>accept() 不应该再主活动UI线程上执行，因为它是一个阻塞调用，并且将会阻止任何与应用的交互行为。它通常在你的应用管理的一个新的线程中使用一个BluetoothServerSocket 或 BluetoothSocket 来完成所有工作。为了中止一个阻塞调用，例如accept()，从你的其他线程里在BluetoothServerSocket (或 BluetoothSocket) 上调用 close() ，然后阻塞调用就会立即返回。注意在 BluetoothServerSocket 或 BluetoothSocket 上所有的方法都是线程安全的。</p>
<p>下面是一个简单的线程，用于服务器端接受外来的连接：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothServerSocket mmServerSocket;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AcceptThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Use a temporary object that is later assigned to mmServerSocket,</span></span><br><span class="line">        <span class="comment">// because mmServerSocket is final</span></span><br><span class="line">        BluetoothServerSocket tmp = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// MY_UUID is the app's UUID string, also used by the client code</span></span><br><span class="line">            tmp = mBluetoothAdapter.listenUsingRfcommWithServiceRecord(NAME, MY_UUID);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">        mmServerSocket = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BluetoothSocket socket = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// Keep listening until exception occurs or a socket is returned</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = mmServerSocket.accept();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// If a connection was accepted</span></span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Do work to manage the connection (in a separate thread)</span></span><br><span class="line">                manageConnectedSocket(socket);</span><br><span class="line">                mmServerSocket.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/** Will cancel the listening socket, and cause the thread to finish */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmServerSocket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意当accept()返回一个 BluetoothSocket是，该socket已经被连接了，因此你不应该调用connect().<br>manageConnectedSocket()是一个虚构的方法，它将会初始化线程来传输数据，下下节讨论。<br>当监听到了外来的连接时，通常是关闭<code>BluetoothServerSocket</code>。在这个例子里， 一旦得到了 BluetoothSocket 就会调用close()。</p>
<h3 id="客户端连接">客户端连接</h3><p>为了和一个远程设备（一个持有服务器socket的设备）初始化一个连接，你必须首先得到一个 <code>BluetoothDevice</code> 对象来表示这个远程设备。（上面的课程Finding Devices讲述了如何得到一个 BluetoothDevice ）。然后你必须使用<code>BluetoothDevice</code>来得到一个<code>BluetoothSocket</code> ，然后初始化该连接。<br>下面是基本的过程：</p>
<ol>
<li>通过调用createRfcommSocketToServiceRecord(UUID)来得到一个 BluetoothSocket 。</li>
<li>通过调用connect()初始化一个连接。</li>
</ol>
<p>下面是初始化一个蓝牙连接的基本例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothDevice mmDevice;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConnectThread</span><span class="params">(BluetoothDevice device)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Use a temporary object that is later assigned to mmSocket,</span></span><br><span class="line">        <span class="comment">// because mmSocket is final</span></span><br><span class="line">        BluetoothSocket tmp = <span class="keyword">null</span>;</span><br><span class="line">        mmDevice = device;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Get a BluetoothSocket to connect with the given BluetoothDevice</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// MY_UUID is the app's UUID string, also used by the server code</span></span><br><span class="line">            tmp = device.createRfcommSocketToServiceRecord(MY_UUID);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">        mmSocket = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Cancel discovery because it will slow down the connection</span></span><br><span class="line">        mBluetoothAdapter.cancelDiscovery();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Connect the device through the socket. This will block</span></span><br><span class="line">            <span class="comment">// until it succeeds or throws an exception</span></span><br><span class="line">            mmSocket.connect();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException connectException) &#123;</span><br><span class="line">            <span class="comment">// Unable to connect; close the socket and get out</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mmSocket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException closeException) &#123; &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Do work to manage the connection (in a separate thread)</span></span><br><span class="line">        manageConnectedSocket(mmSocket);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/** Will cancel an in-progress connection, and close the socket */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmSocket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在连接前最好调用cancelDiscovery()。</p>
</blockquote>
<h2 id="管理一个连接">管理一个连接</h2><p>当你成功连接两个（或更多）设备后，每一个都将有一个已连接的 BluetoothSocket。此时就可以在不同的设备之间共享数据了！</p>
<ol>
<li>分别通过getInputStream() 和 getOutputStream()来得到 <code>InputStream</code> 和 <code>OutputStream</code> 来控制socket之间的传输。</li>
<li>使用 read(byte[]) 和 write(byte[])来向数据流中读取和写入数据。</li>
</ol>
<p>首先并且最重要的是，你应该为所有输入和输出的数据流使用一个专属的线程。这是十分重要的，因为read(byte[]) 和 write(byte[])方法都是阻塞调用。 read(byte[])将会发生阻塞知道送数据流中读取到了一些东西。 write(byte[])不经常发生阻塞，但是当远程设备没有足够迅速地调用 read(byte[])而中间缓冲区已经负载时可以阻塞。因此，你的线程中的主要循环应该是专门从InputStream中读取数据的。一个单独的公共方法可以被用于初始化向 OutputStream 中写入数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectedThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InputStream mmInStream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OutputStream mmOutStream;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConnectedThread</span><span class="params">(BluetoothSocket socket)</span> </span>&#123;</span><br><span class="line">        mmSocket = socket;</span><br><span class="line">        InputStream tmpIn = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream tmpOut = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Get the input and output streams, using temp objects because</span></span><br><span class="line">        <span class="comment">// member streams are final</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            tmpIn = socket.getInputStream();</span><br><span class="line">            tmpOut = socket.getOutputStream();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line"> </span><br><span class="line">        mmInStream = tmpIn;</span><br><span class="line">        mmOutStream = tmpOut;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];  <span class="comment">// buffer store for the stream</span></span><br><span class="line">        <span class="keyword">int</span> bytes; <span class="comment">// bytes returned from read()</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Keep listening to the InputStream until an exception occurs</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Read from the InputStream</span></span><br><span class="line">                bytes = mmInStream.read(buffer);</span><br><span class="line">                <span class="comment">// Send the obtained bytes to the UI activity</span></span><br><span class="line">                mHandler.obtainMessage(MESSAGE_READ, bytes, -<span class="number">1</span>, buffer)</span><br><span class="line">                        .sendToTarget();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* Call this from the main activity to send data to the remote device */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmOutStream.write(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* Call this from the main activity to shutdown the connection */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmSocket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>构造器需要必须的数据流，并且一旦执行，线程将会等待InputStream 中来的数据。当 read(byte[]) 返回一些数值时，数据将会使用一个父类的一个成员变量句柄发送给主活动。然后它返回并继续等待更多的数据。</p>
<p>发送数据只需要在主活动中调用线程的 write()方法，并将需要发送数据传递给它即可。这个方法然后调用 write(byte[])来向远程设备发送数据。</p>
<p>线程的cancel() 方法是重要的，以便连接可以在任何时间被中断（通过关闭BluetoothSocket）。这个方法应该在你完成蓝牙连接后总是被调用。</p>
<p>蓝牙sample的例子 ：<a href="http://developer.android.com/samples/index.html" target="_blank" rel="external">http://developer.android.com/samples/index.html</a></p>
<h2 id="使用配置文件">使用配置文件</h2><p>待续<br>参考</p>
<blockquote>
<p><a href="http://developer.android.com/guide/topics/connectivity/bluetooth.html" target="_blank" rel="external">http://developer.android.com/guide/topics/connectivity/bluetooth.html</a><br><a href="http://blog.csdn.net/candycat1992/article/details/8577927" target="_blank" rel="external">http://blog.csdn.net/candycat1992/article/details/8577927</a></p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bluetooth/">bluetooth</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-GreenDao学习" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/29/GreenDao学习/" class="article-date">
  	<time datetime="2015-06-29T13:01:00.000Z" itemprop="datePublished">2015-06-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/29/GreenDao学习/">GreenDao学习</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="准备工作">准备工作</h2><h3 id="github下载工程">github下载工程</h3><p><a href="https://github.com/greenrobot/greenDAO" target="_blank" rel="external">https://github.com/greenrobot/greenDAO</a></p>
<h3 id="android_studio导入DaoExampleGenerator">android studio导入DaoExampleGenerator</h3><h3 id="下载所需的jar包">下载所需的jar包</h3><p><a href="http://search.maven.org/#search%7Cga%7C1%7CgreenDao" target="_blank" rel="external">http://search.maven.org/#search%7Cga%7C1%7CgreenDao</a><br>下载greendao-generator-1.3.0.jar 和greendao-1.3.7.jar<br><a href="http://mvnrepository.com/artifact/org.freemarker/freemarker" target="_blank" rel="external">http://mvnrepository.com/artifact/org.freemarker/freemarker</a><br>下载freemarker-2.3.20.jar</p>
<h3 id="导入jar包">导入jar包</h3><p>在DaoExampleGenerator工程中新建lib文件夹，将jar包add as library<br>编译报错DaoGenerator找不到。build.gradle中 注释掉//compile project(‘:DaoGenerator’)</p>
<h2 id="生成DaoGenerator生成库">生成DaoGenerator生成库</h2><h3 id="main">main</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * Copyright (C) 2011 Markus Junginger, greenrobot (http://greenrobot.de)</span><br><span class="line"> *</span><br><span class="line"> * Licensed under the Apache License, Version 2.0 (the "License");</span><br><span class="line"> * you may not use this file except in compliance with the License.</span><br><span class="line"> * You may obtain a copy of the License at</span><br><span class="line"> *</span><br><span class="line"> *      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> *</span><br><span class="line"> * Unless required by applicable law or agreed to in writing, software</span><br><span class="line"> * distributed under the License is distributed on an "AS IS" BASIS,</span><br><span class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"> * See the License for the specific language governing permissions and</span><br><span class="line"> * limitations under the License.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">package</span> de.greenrobot.daogenerator.gentest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daogenerator.DaoGenerator;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daogenerator.Entity;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daogenerator.Property;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daogenerator.Schema;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daogenerator.ToMany;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Generates entities and DAOs for the example project DaoExample.</span><br><span class="line"> * </span><br><span class="line"> * Run it as a Java application (not Android).</span><br><span class="line"> * </span><br><span class="line"> * <span class="doctag">@author</span> Markus</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleDaoGenerator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Schema schema = <span class="keyword">new</span> Schema(<span class="number">1000</span>, <span class="string">"de.greenrobot.daoexample"</span>);</span><br><span class="line"></span><br><span class="line">        addNote(schema);</span><br><span class="line">        addCustomerOrder(schema);</span><br><span class="line">        addPrice(schema);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> DaoGenerator().generateAll(schema, <span class="string">"../DaoExample/src-gen"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addPrice</span><span class="params">(Schema schema)</span> </span>&#123;</span><br><span class="line">        Entity note = schema.addEntity(<span class="string">"Price"</span>);</span><br><span class="line">        note.addIdProperty();</span><br><span class="line">        note.addIntProperty(<span class="string">"Price"</span>).notNull();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addNote</span><span class="params">(Schema schema)</span> </span>&#123;</span><br><span class="line">        Entity note = schema.addEntity(<span class="string">"Note"</span>);</span><br><span class="line">        note.addIdProperty();</span><br><span class="line">        note.addStringProperty(<span class="string">"text"</span>).notNull();</span><br><span class="line">        note.addStringProperty(<span class="string">"comment"</span>);</span><br><span class="line">        note.addDateProperty(<span class="string">"date"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addCustomerOrder</span><span class="params">(Schema schema)</span> </span>&#123;</span><br><span class="line">        Entity customer = schema.addEntity(<span class="string">"Customer"</span>);</span><br><span class="line">        customer.addIdProperty();</span><br><span class="line">        customer.addStringProperty(<span class="string">"name"</span>).notNull();</span><br><span class="line"></span><br><span class="line">        Entity order = schema.addEntity(<span class="string">"Order"</span>);</span><br><span class="line">        order.setTableName(<span class="string">"ORDERS"</span>); <span class="comment">// "ORDER" is a reserved keyword</span></span><br><span class="line">        order.addIdProperty();</span><br><span class="line">        Property orderDate = order.addDateProperty(<span class="string">"date"</span>).getProperty();</span><br><span class="line">        Property customerId = order.addLongProperty(<span class="string">"customerId"</span>).notNull().getProperty();</span><br><span class="line">        order.addToOne(customer, customerId);</span><br><span class="line"></span><br><span class="line">        ToMany customerToOrders = customer.addToMany(order, customerId);</span><br><span class="line">        customerToOrders.setName(<span class="string">"orders"</span>);</span><br><span class="line">        customerToOrders.orderAsc(orderDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Schema schema = <span class="keyword">new</span> Schema(<span class="number">1000</span>, <span class="string">"de.greenrobot.daoexample"</span>);</span><br></pre></td></tr></table></figure></p>
<p>参数1：数据库版本号<br>参数2：生成的类的路径</p>
<blockquote>
<p>路径需要先创建否则会报错</p>
</blockquote>
<p>运行程序后<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">This program comes with ABSOLUTELY NO WARRANTY</span><br><span class="line">Processing schema version <span class="number">1000</span>...</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/NoteDao.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/Note.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/CustomerDao.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/Customer.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/OrderDao.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/Order.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/PriceDao.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/Price.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/DaoMaster.java</span><br><span class="line">Written /Users/xuyushi/Downloads/greenDAO-master/DaoExample/src-gen/de/greenrobot/daoexample/DaoSession.java</span><br><span class="line">Processed <span class="number">4</span> entities <span class="keyword">in</span> <span class="number">153</span>ms</span><br><span class="line"></span><br><span class="line">Process finished with <span class="built_in">exit</span> code <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>发现生成了4个 类 和dao类，1个DaoMaster,1个DaoSession.</p>
<h3 id="创建表">创建表</h3><p>在主函数中<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addPrice(schema);</span><br></pre></td></tr></table></figure></p>
<p>函数实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addPrice</span><span class="params">(Schema schema)</span> </span>&#123;</span><br><span class="line">	Entity note = schema.addEntity(<span class="string">"Price"</span>);</span><br><span class="line">	note.addIdProperty();</span><br><span class="line">	note.addIntProperty(<span class="string">"Price"</span>).notNull();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entity note = schema.addEntity(<span class="string">"Price"</span>);</span><br></pre></td></tr></table></figure>
<p>参数：表名</p>
<blockquote>
<p>默认表名就是类名，也可以自定义表名</p>
</blockquote>
<p>可以加入<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dao.addIdProperty().primaryKey().autoincrement();</span><br></pre></td></tr></table></figure></p>
<p>设置一个自增长ID列为主键</p>
<blockquote>
<p>不写系统会默认生成ID为主键</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">note.addIntProperty(<span class="string">"Price"</span>).notNull();</span><br></pre></td></tr></table></figure>
<p>加入价格，int类型，不能为空</p>
<h2 id="常用增删查改功能">常用增删查改功能</h2><ol>
<li>新建android工程</li>
<li>==将之前生成的de.greenrobot.daoexample复制到com.example.xuyushi.greendaotest同级目录下==</li>
<li>==将下载的DaoCore中的de.greenrobot.dao复制到com.example.xuyushi.greendaotest同级目录下==</li>
<li><p>==新建AppApplication 继承系统Application类，在此实现getDaoMaster、getDaoSession==<br>代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xuyushi.greendaotest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Application;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.DaoMaster;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.DaoSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/6/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATABASE_NAME = <span class="string">"datatest"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DaoMaster daoMaster;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DaoSession daoSession;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 取得DaoMaster</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> context</span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DaoMaster <span class="title">getDaoMaster</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (daoMaster == <span class="keyword">null</span>) &#123;</span><br><span class="line">            DaoMaster.OpenHelper helper = <span class="keyword">new</span> DaoMaster.DevOpenHelper(context, DATABASE_NAME, <span class="keyword">null</span>);</span><br><span class="line">            daoMaster = <span class="keyword">new</span> DaoMaster(helper.getWritableDatabase());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> daoMaster;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 取得DaoSession</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> context</span><br><span class="line">     * <span class="doctag">@return</span></span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DaoSession <span class="title">getDaoSession</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (daoSession == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (daoMaster == <span class="keyword">null</span>) &#123;</span><br><span class="line">                daoMaster = getDaoMaster(context);</span><br><span class="line">            &#125;</span><br><span class="line">            daoSession = daoMaster.newSession();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> daoSession;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时就可以在此安卓工程中使用之前生成的类了</p>
</li>
</ol>
<h3 id="新建_DBHelper类，实现数据库的功能">新建 DBHelper类，实现数据库的功能</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> de.greenrobot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.xuyushi.greendaotest.AppApplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.DaoSession;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.Note;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.NoteDao;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.OrderDao;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.Price;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.PriceDao;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/6/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Context mContext;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DBHelper instance;</span><br><span class="line">    <span class="keyword">private</span> CustomerDao Customer;</span><br><span class="line">    <span class="keyword">private</span> NoteDao Note;</span><br><span class="line">    <span class="keyword">private</span> OrderDao Order;</span><br><span class="line">    <span class="keyword">private</span> PriceDao Price;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DBHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DBHelper <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> DBHelper();</span><br><span class="line">            <span class="keyword">if</span> (mContext == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mContext = context;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 数据库对象</span></span><br><span class="line">            DaoSession daoSession = AppApplication.getDaoSession(mContext);</span><br><span class="line">            instance.Customer = daoSession.getCustomerDao();</span><br><span class="line">            instance.Order = daoSession.getOrderDao();</span><br><span class="line">            instance.Note = daoSession.getNoteDao();</span><br><span class="line">            instance.Price = daoSession.getPriceDao();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * 添加数据</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addToNoteTable</span><span class="params">(Note note)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == Note) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == note) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Note.insert(note);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Note&gt; <span class="title">getNote</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Note.loadAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPriceTable</span><span class="params">(Price price)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == Price) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == price) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Price.insert(price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Price&gt; <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Price.loadAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在getIstence方法中需要将表对象都实例化出来<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库对象</span></span><br><span class="line">	DaoSession daoSession = AppApplication.getDaoSession(mContext);</span><br><span class="line">	instance.Customer = daoSession.getCustomerDao();</span><br><span class="line">	instance.Order = daoSession.getOrderDao();</span><br><span class="line">	instance.Note = daoSession.getNoteDao();</span><br><span class="line">	instance.Price = daoSession.getPriceDao();</span><br></pre></td></tr></table></figure></p>
<p>之后实现table的增删查改函数。</p>
<p>本文举例加入了addPriceTable和getPrice函数</p>
<h3 id="主Activity中验证">主Activity中验证</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> id = <span class="number">1</span>;</span><br><span class="line">price = <span class="keyword">new</span> Price(id, <span class="number">22</span>);</span><br><span class="line"><span class="comment">//    price.setId(id);</span></span><br><span class="line">DBHelper.getInstance(<span class="keyword">this</span>).addPriceTable(price);</span><br><span class="line">ListPrice=DBHelper.getInstance(<span class="keyword">this</span>).getPrice();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>调试可以发现Listpice的id为1 Price为22</p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/greendao/">greendao</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-June 27, 2015 8-12 PM" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/27/June 27, 2015 8-12 PM/" class="article-date">
  	<time datetime="2015-06-27T12:12:00.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/June 27, 2015 8-12 PM/">June 27, 2015 8:12 PM</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>  宿舍断网一天，感觉人都放空了。开启沉思模式，回顾半个月以来工作。</p>
<ul>
<li>搭建了这个博客，遇到的问题太多了，以前也没接触过JS、CSS什么的，中国局域网坑了我很久。hexo的3.0版本和之前的配置环境也不一样，用github搭建博客 —&gt; 用hexo生成静态网页 —&gt; clone主题 —&gt; 加入duoshuo评论 —&gt; 动态识别UA。最终弄完还是蛮有成就感的。看代码、写代码、再自己总结一遍。确实是三种不同的境界。</li>
<li>同事很牛逼。人也很nice。之前实习做的是驱动，后来想转做android app，和老大说了，没想到老大答应的这么爽快，非常感谢老大能给这样的一次机会，让我能做自己喜欢的事情。平时技术上的问题刘波哥和申燊同学都非常热情的解答。遇到一群好同事啊。</li>
<li>自己要学的太多太多。拿到代码的时候都懵了，完全不知道从哪下手。不知道申燊同学之前一个人是如何完成的。</li>
<li>学会习惯一个人。刚来的前几天，一个人买个面包能在门口和小黄玩好久，搞得它没事就蹲我门口。习惯了之后发现一个人挺不错的，一个人早睡早起，学习的效率也高不少，以前也很少会静下心来思考一些问题。</li>
<li>理财知识和专业知识并进，后悔没有早点接触理财方面的知识，浮盈的20%多收益差不多都没了，让我坚定了1.资产配置的重要性。2.独立思考，切勿盲目跟风。3没必要整天关心股市做布朗运动。4.对于刚毕业的学生来说多花时间在工作上肯定是没错的。</li>
<li>每天健身，这两周种种原因没有坚持完成。下周先计划个20公里吧。<br>写的好乱，语文不好的基因被暴露无疑。</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/日记/">日记</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-近期学习计划" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/27/近期学习计划/" class="article-date">
  	<time datetime="2015-06-27T09:09:00.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/近期学习计划/">近期学习计划</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="近期学习计划">近期学习计划</h1><ul>
<li>[ ] 学习android优秀的开源库</li>
<li>[ ] 学习一门脚本语言</li>
<li>[ ] 熟悉常见命令行</li>
<li>[ ] 学习Web基础（HTML/CSS/JS/html5)</li>
<li>[ ] 学习数据库相关</li>
<li>[x] Git工具管理</li>
<li>[ ] 《java编程思想》</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-登陆框UI" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/27/登陆框UI/" class="article-date">
  	<time datetime="2015-06-27T04:12:00.000Z" itemprop="datePublished">2015-06-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/27/登陆框UI/">登陆框 UI</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="实现功能">实现功能</h2><p>1.账号自动登陆<br>2.输入密码时，有全清按钮<br>3.账号输入失败 &gt; N次，要求用户输入验证码验证 </p>
<h2 id="布局文件">布局文件</h2><p>登陆核心区域主要由以下几个部分<br>1.账号<br>2.密码<br>3.验证码<br>4.登陆按钮</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">	<span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">	<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">	<span class="attribute">android:orientation</span>=<span class="value">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--应用图标--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">		<span class="attribute">android:layout_width</span>=<span class="value">"60dp"</span></span><br><span class="line">		<span class="attribute">android:layout_height</span>=<span class="value">"60dp"</span></span><br><span class="line">		<span class="attribute">android:layout_gravity</span>=<span class="value">"center"</span></span><br><span class="line">		<span class="attribute">android:background</span>=<span class="value">"@drawable/ic_launcher"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--中间空--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">		<span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">		<span class="attribute">android:layout_height</span>=<span class="value">"16dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--账号栏--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">		<span class="attribute">android:paddingBottom</span>=<span class="value">"8dp"</span></span><br><span class="line">		<span class="attribute">android:paddingTop</span>=<span class="value">"8dp"</span></span><br><span class="line">		<span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">		<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">		<span class="attribute">android:background</span>=<span class="value">"@drawable/bg_search_edit_text"</span></span><br><span class="line">		<span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--账号图片--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">			<span class="attribute">android:paddingLeft</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:paddingRight</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">			<span class="attribute">android:src</span>=<span class="value">"@drawable/img_login_account"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="title">EditText</span></span><br><span class="line">			<span class="attribute">android:id</span>=<span class="value">"@+id/et_login_username"</span></span><br><span class="line">			<span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span></span><br><span class="line">			<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:background</span>=<span class="value">"@color/transparent"</span></span><br><span class="line">			<span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">			<span class="attribute">android:hint</span>=<span class="value">"@string/prompt_username"</span></span><br><span class="line">			<span class="attribute">android:inputType</span>=<span class="value">"text"</span></span><br><span class="line">			<span class="attribute">android:maxLines</span>=<span class="value">"1"</span></span><br><span class="line">			<span class="attribute">android:singleLine</span>=<span class="value">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!--消除输入图片--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">			<span class="attribute">android:paddingLeft</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:paddingRight</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:id</span>=<span class="value">"@+id/img_account_clear"</span></span><br><span class="line">			<span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">			<span class="attribute">android:src</span>=<span class="value">"@drawable/img_login_clear"</span></span><br><span class="line">			<span class="attribute">android:visibility</span>=<span class="value">"gone"</span></span><br><span class="line">			/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">		<span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">		<span class="attribute">android:layout_height</span>=<span class="value">"16dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--密码栏--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">LinearLayout</span></span><br><span class="line">		<span class="attribute">android:paddingBottom</span>=<span class="value">"8dp"</span></span><br><span class="line">		<span class="attribute">android:paddingTop</span>=<span class="value">"8dp"</span></span><br><span class="line">		<span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">		<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">		<span class="attribute">android:background</span>=<span class="value">"@drawable/bg_search_edit_text"</span></span><br><span class="line">		<span class="attribute">android:orientation</span>=<span class="value">"horizontal"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">			<span class="attribute">android:paddingLeft</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:paddingRight</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">			<span class="attribute">android:src</span>=<span class="value">"@drawable/img_login_code"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="title">EditText</span></span><br><span class="line">			<span class="attribute">android:id</span>=<span class="value">"@+id/et_login_password"</span></span><br><span class="line">			<span class="attribute">android:background</span>=<span class="value">"@color/transparent"</span></span><br><span class="line">			<span class="attribute">android:layout_width</span>=<span class="value">"0dp"</span></span><br><span class="line">			<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_weight</span>=<span class="value">"1"</span></span><br><span class="line">			<span class="attribute">android:hint</span>=<span class="value">"@string/prompt_password"</span></span><br><span class="line">			<span class="attribute">android:imeActionId</span>=<span class="value">"@+id/action_login"</span></span><br><span class="line">			<span class="attribute">android:imeActionLabel</span>=<span class="value">"@string/action_sign_in"</span></span><br><span class="line">			<span class="attribute">android:imeOptions</span>=<span class="value">"actionUnspecified"</span></span><br><span class="line">			<span class="attribute">android:inputType</span>=<span class="value">"textPassword"</span></span><br><span class="line">			<span class="attribute">android:maxLines</span>=<span class="value">"1"</span></span><br><span class="line">			<span class="attribute">android:singleLine</span>=<span class="value">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">			<span class="attribute">android:id</span>=<span class="value">"@+id/img_code_clear"</span></span><br><span class="line">			<span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">			<span class="attribute">android:layout_gravity</span>=<span class="value">"center_vertical"</span></span><br><span class="line">			<span class="attribute">android:src</span>=<span class="value">"@drawable/img_login_clear"</span></span><br><span class="line">			<span class="attribute">android:paddingLeft</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:paddingRight</span>=<span class="value">"8dp"</span></span><br><span class="line">			<span class="attribute">android:visibility</span>=<span class="value">"gone"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="注">注</h4><p><code>android:inputType=&quot;textPassword&quot;</code> 输入密码的显示***<br><code>android:singleLine=&quot;true&quot;</code>设置为单行模式</p>
<h2 id="主程序">主程序</h2><p>消除图片设置为隐藏，当edittest有数据时再显示</p>
<h3 id="输入框监听">输入框监听</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">	mUsername.addTextChangedListener(<span class="keyword">new</span> TextWatcher() &#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</span><br><span class="line">		String content = mUsername.getText().toString();</span><br><span class="line">		<span class="keyword">if</span> (!TextUtils.isEmpty(content)) &#123;</span><br><span class="line">			mAccountClear.setVisibility(View.VISIBLE);</span><br><span class="line">			mUsername.setSelection(content.length());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			mAccountClear.setVisibility(View.GONE);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mPassword.addTextChangedListener(<span class="keyword">new</span> TextWatcher() &#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</span><br><span class="line">		String content = mPassword.getText().toString();</span><br><span class="line">		<span class="keyword">if</span> (!TextUtils.isEmpty(content)) &#123;</span><br><span class="line">			mCodeClear.setVisibility(View.VISIBLE);</span><br><span class="line">			mPassword.setSelection(content.length());</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			mCodeClear.setVisibility(View.GONE);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="消除按键监听">消除按键监听</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@OnClick</span>(R.id.img_account_clear)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">claerAccout</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> != mUsername) &#123;</span><br><span class="line">			mUsername.setText(<span class="string">""</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="annotation">@OnClick</span>(R.id.img_code_clear)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">claerCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">null</span> != mPassword) &#123;</span><br><span class="line">		mPassword.setText(<span class="string">""</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="登陆按钮监听">登陆按钮监听</h3><p>主要实现以下功能<br>1.判断用户名、密码是否为空，若为空，提示用户。<br>2.判断需不需要输入验证码，若需要显示验证码edittext和验证码图片<br>3.登陆。更新UI显示登录中</p>
<h3 id="checkbox监听">checkbox监听</h3><p>若勾选，获取存储的账号密码，登陆</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UI/">UI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/android/">android</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2015 Xu Yushi
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>