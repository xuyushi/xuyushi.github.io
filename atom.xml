<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
  <title><![CDATA[Xu Yushi Blog]]></title>
  <subtitle><![CDATA[ä½è°ƒã€åŠ¡å®ã€è‡ªé©±ã€åæ€]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://yoursite.com//"/>
  <updated>2016-02-01T07:57:00.000Z</updated>
  <id>http://yoursite.com//</id>
  
  <author>
    <name><![CDATA[Xu Yushi]]></name>
    <email><![CDATA[xmy166@gmail.com]]></email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[çŠ¶æ€æ¨¡å¼ State Design Pattern]]></title>
    <link href="http://yoursite.com/2016/02/01/%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F/"/>
    <id>http://yoursite.com/2016/02/01/çŠ¶æ€æ¨¡å¼/</id>
    <published>2016-02-01T07:12:00.000Z</published>
    <updated>2016-02-01T07:57:00.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="çŠ¶æ€æ¨¡å¼_State_Design_Pattern">çŠ¶æ€æ¨¡å¼ State Design Pattern</h1><h2 id="å®šä¹‰">å®šä¹‰</h2><h2 id="ç›®çš„">ç›®çš„</h2><ul>
<li>æ ¹æ®ä¸åŒçš„çŠ¶æ€ï¼Œé‡‡å–ä¸åŒçš„è¡Œä¸º</li>
<li>å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¹å˜å…¶è¡Œä¸ºã€‚è¿™ä¸ªå¯¹è±¡çœ‹ä¸Šå»å°±åƒæ˜¯æ”¹å˜äº†å®ƒçš„ç±»ä¸€æ ·</li>
</ul>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2><ul>
<li>å‡å°‘äº† if elseï¼Œswitch è¯­å¥çš„å¤æ‚ç¨‹åº¦ </li>
<li>å¢åŠ æ–°çš„çŠ¶æ€å’Œé€»è¾‘æ—¶ï¼Œä¾¿äºä¿®æ”¹</li>
</ul>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2><ul>
<li>ç±»çš„ç§ç±»å¢åŠ <br>*</li>
</ul>
<h2 id="æ­¥éª¤">æ­¥éª¤</h2><ol>
<li>å®šä¹‰ä¸€ä¸ª <code>context</code> ç±»ï¼Œæ¥ç»™å¤–æ¥æä¾›ä¸€ä¸ªæ¥å£</li>
<li>å®šä¹‰ä¸€ä¸ª <code>state</code> åŸºç±»</li>
<li>æ ¹æ®<code>state</code> çŠ¶æ€ï¼Œæ´¾ç”Ÿå®šä¹‰å…¶ä»–çš„ä¸åŒçŠ¶æ€ç±»</li>
<li>åœ¨æ´¾ç”Ÿ<code>state</code> ä¸­ï¼Œå®šä¹‰ä¸åŒçš„è¡Œä¸º</li>
<li>åœ¨<code>context</code>ä¸­æŒæœ‰ä¸€ä¸ªå½“å‰ <code>state</code>çš„å˜é‡</li>
<li>æ”¹å˜<code>context</code>ä¸­çš„<code>state</code>çŠ¶æ€</li>
</ol>
<h2 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h2><ol>
<li>å¯¹è±¡çš„è¡Œä¸ºå–å†³äºå½“å‰çš„çŠ¶æ€</li>
<li>ä»£ç ä¸­åŒ…å«å¤§é‡çš„ä¸å¯¹è±¡çŠ¶æ€æœ‰å…³çš„æ¡ä»¶è¯­å¥ã€‚çŠ¶æ€æ¨¡å¼å°†æ¯ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯æ”¾å…¥ä¸€ä¸ªç‹¬ç«‹çš„<code>state</code>ç±»ä¸­ã€‚</li>
</ol>
<h2 id="ç»“æ„">ç»“æ„</h2><ul>
<li><code>context</code>ä¸­å®šä¹‰å®¢æˆ·ç«¯æ‰€æ„Ÿå…´è¶£çš„æ¥å£ï¼Œå¹¶æŒæœ‰ä¸€ä¸ªçŠ¶æ€ç±»çš„å®ä¾‹ï¼Œè¡¨ç¤ºç±»å½“å‰çš„çŠ¶æ€</li>
<li><code>state</code>ä¸­å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œç”¨ä»¥å°è£…<code>context</code>ä¸­å¯¹è±¡çš„ä¸€ä¸ªç‰¹å®šçš„çŠ¶æ€æ‰€å¯¹åº”çš„è¡Œä¸º</li>
<li>å…·ä½“çŠ¶æ€å®ç°äº†<code>state</code>ä¸­æ‰€éœ€è¦åŠ¨ä½œçš„å…·ä½“è¡Œä¸ºï¼ˆå¯ä»¥ä¸å®ç°ï¼Œé‚£ä¹ˆé‚£ä¸ªè¡Œä¸ºä¿æŒ<code>state</code>ä¸­çš„è¡Œä¸ºï¼‰</li>
</ul>
<p><strong>UML å›¾</strong></p>
<p><img src="media/14543092051479.png" alt=""></p>
<h2 id="ä¾‹å­">ä¾‹å­</h2><h3 id="context_ç±»">context ç±»</h3><ul>
<li>å…¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³• <code>goNext</code> <code>goPre</code>ï¼Œåˆ†åˆ«è°ƒç”¨å½“å‰çŠ¶æ€ä¸­çš„<code>next</code> <code>pre</code>æ–¹æ³•</li>
<li>å¤å†™äº†<code>toString</code>æ–¹æ³•ï¼Œä¾¿äºè§‚å¯Ÿç»“æœ</li>
<li>åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–å½“å‰çš„<code>state</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 16/1/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wrapper</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> State state;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Wrapper</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.next(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">goPre</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        state.pre(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(State state)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"now state is "</span>+ state.getClass().getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="state_åŸºç±»">state åŸºç±»</h3><ul>
<li>å®šä¹‰äº†<code>next</code> <code>pre</code>æ–¹æ³•ï¼Œå­ç±»å¯ä»¥ä¸ç”¨å¤å†™å…¨éƒ¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨çˆ¶ç±»ä¸­è¦åšç›¸åº”çš„å¤„ç†ï¼Œä¹Ÿå¯ä»¥æŠ›å‡ºå¼‚å¸¸</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 16/1/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">(Wrapper wrapper)</span> </span>&#123;</span><br><span class="line">        System.out.println( <span class="string">"error"</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pre</span><span class="params">(Wrapper wrapper)</span> </span>&#123;</span><br><span class="line">        System.out.println( <span class="string">"error"</span> );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">### å…·ä½“å®ç°ç±»</span><br><span class="line"></span><br><span class="line">* A çŠ¶æ€åªå¤å†™ next æ–¹æ³•</span><br><span class="line">* B çŠ¶æ€å¤å†™ next å’Œ preæ–¹æ³•</span><br><span class="line">* C çŠ¶æ€åªå¤å†™ pre æ–¹æ³•</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="keyword">package</span> io.github.xuyushi.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 16/1/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateA</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">(Wrapper wrapper)</span> </span>&#123;</span><br><span class="line">        wrapper.setState(<span class="keyword">new</span> StateB());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> io.github.xuyushi.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 16/1/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateB</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">(Wrapper wrapper)</span> </span>&#123;</span><br><span class="line">        wrapper.setState(<span class="keyword">new</span> StateC());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pre</span><span class="params">(Wrapper wrapper)</span> </span>&#123;</span><br><span class="line">        wrapper.setState(<span class="keyword">new</span> StateA());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> io.github.xuyushi.state;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 16/1/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateC</span> <span class="keyword">extends</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pre</span><span class="params">(Wrapper wrapper)</span> </span>&#123;</span><br><span class="line">        wrapper.setState(<span class="keyword">new</span> StateA());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å®¢æˆ·ç«¯ä½¿ç”¨">å®¢æˆ·ç«¯ä½¿ç”¨</h3><p>æ¯æ¬¡æ”¹å˜çŠ¶æ€ä¹‹åæ‰“å°å½“å‰çŠ¶æ€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.state;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 16/1/29.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"StateMain RUNNING"</span>);</span><br><span class="line">        <span class="comment">// write your code here</span></span><br><span class="line">        Wrapper wrapper = <span class="keyword">new</span> Wrapper(<span class="keyword">new</span> StateA());</span><br><span class="line">        System.out.println(wrapper.toString());</span><br><span class="line">        wrapper.goPre();</span><br><span class="line">        System.out.println(wrapper.toString());</span><br><span class="line">        wrapper.goNext();</span><br><span class="line">        System.out.println(wrapper.toString());</span><br><span class="line">        wrapper.goNext();</span><br><span class="line">        System.out.println(wrapper.toString());</span><br><span class="line">        wrapper.goNext();</span><br><span class="line">        System.out.println(wrapper.toString());</span><br><span class="line">        wrapper.goNext();</span><br><span class="line">        System.out.println(wrapper.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>log</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">StateMain RUNNING</span><br><span class="line">now state is io.github.xuyushi.state.StateA</span><br><span class="line">error</span><br><span class="line">now state is io.github.xuyushi.state.StateA</span><br><span class="line">now state is io.github.xuyushi.state.StateB</span><br><span class="line">now state is io.github.xuyushi.state.StateC</span><br><span class="line">error</span><br><span class="line">now state is io.github.xuyushi.state.StateC</span><br><span class="line">error</span><br><span class="line">now state is io.github.xuyushi.state.StateC</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1><blockquote>
<ul>
<li>ã€first head è®¾è®¡æ¨¡å¼ã€ </li>
<li><a href="https://sourcemaking.com/design_patterns/state" target="_blank" rel="external">https://sourcemaking.com/design_patterns/state</a></li>
<li><a href="http://www.cnblogs.com/java-my-life/archive/2012/06/08/2538146.html" target="_blank" rel="external">http://www.cnblogs.com/java-my-life/archive/2012/06/08/2538146.html</a></li>
<li><a href="http://blog.csdn.net/hguisu/article/details/7557252" target="_blank" rel="external">http://blog.csdn.net/hguisu/article/details/7557252</a></li>
</ul>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[java çŠ¶æ€æ¨¡å¼ï¼ŒState Design Pattern]]>
    
    </summary>
    
      <category term="Pattern" scheme="http://yoursite.com/tags/Pattern/"/>
    
      <category term="è®¾è®¡æ¨¡å¼" scheme="http://yoursite.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android View å°ç»“]]></title>
    <link href="http://yoursite.com/2016/02/01/%E6%B3%A8%E8%A7%A3/"/>
    <id>http://yoursite.com/2016/02/01/æ³¨è§£/</id>
    <published>2016-02-01T07:12:00.000Z</published>
    <updated>2016-02-01T07:48:21.000Z</updated>
    <content type="html"><![CDATA[<h1 id="æ³¨è§£">æ³¨è§£</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Target</span>(ElementType.FIELD)</span><br><span class="line"><span class="annotation">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="annotation">@interface</span> Column &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">type</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">primary</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>interfaceç”¨æ¥å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯å£°æ˜äº†ä¸€ä¸ªé…ç½®å‚æ•°ã€‚</li>
<li>æ–¹æ³•çš„åç§°å°±æ˜¯å‚æ•°çš„åç§°ï¼Œè¿”å›å€¼ç±»å‹å°±æ˜¯å‚æ•°çš„ç±»å‹ã€‚</li>
<li>å¯ä»¥é€šè¿‡defaultæ¥å£°æ˜å‚æ•°çš„é»˜è®¤å€¼ã€‚</li>
<li>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°@Retentionå’Œ@Targetè¿™æ ·çš„å…ƒæ³¨è§£ï¼Œç”¨æ¥å£°æ˜æ³¨è§£æœ¬èº«çš„è¡Œä¸ºã€‚</li>
<li>@Retentionç”¨æ¥å£°æ˜æ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼Œæœ‰CLASSã€RUNTIMEå’ŒSOURCEè¿™ä¸‰ç§ï¼Œåˆ†åˆ«è¡¨ç¤ºæ³¨è§£ä¿å­˜åœ¨ç±»æ–‡ä»¶ã€JVMè¿è¡Œæ—¶åˆ»å’Œæºä»£ç ä¸­ã€‚</li>
<li>åªæœ‰å½“å£°æ˜ä¸ºRUNTIMEçš„æ—¶å€™ï¼Œæ‰èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åˆ»é€šè¿‡åå°„APIæ¥è·å–åˆ°æ³¨è§£çš„ä¿¡æ¯ã€‚</li>
<li>@Targetç”¨æ¥å£°æ˜æ³¨è§£å¯ä»¥è¢«æ·»åŠ åœ¨å“ªäº›ç±»å‹çš„å…ƒç´ ä¸Šï¼Œå¦‚ç±»å‹ã€æ–¹æ³•å’ŒåŸŸç­‰ã€‚</li>
<li>å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªæ³¨è§£äº†ï¼Œå®ƒå°†è‡ªåŠ¨ç»§æ‰¿Annotation</li>
</ul>
<p>@Target è¡¨ç¤ºè¯¥æ³¨è§£ç”¨äºä»€ä¹ˆåœ°æ–¹ï¼Œå¯èƒ½çš„å€¼åœ¨æšä¸¾ç±» ElemenetType ä¸­ï¼ŒåŒ…æ‹¬ï¼š </p>
<ul>
<li>ElemenetType.CONSTRUCTOR æ„é€ å™¨å£°æ˜ </li>
<li>ElemenetType.FIELD åŸŸå£°æ˜ï¼ˆåŒ…æ‹¬ enum å®ä¾‹ï¼‰ </li>
<li>ElemenetType.LOCAL_VARIABLE å±€éƒ¨å˜é‡å£°æ˜ </li>
<li>ElemenetType.METHOD æ–¹æ³•å£°æ˜ </li>
<li>ElemenetType.PACKAGE åŒ…å£°æ˜ </li>
<li>ElemenetType.PARAMETER å‚æ•°å£°æ˜ </li>
<li>ElemenetType.TYPE ç±»ï¼Œæ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹ï¼‰æˆ–enumå£°æ˜ </li>
</ul>
<p>@Retention è¡¨ç¤ºåœ¨ä»€ä¹ˆçº§åˆ«ä¿å­˜è¯¥æ³¨è§£ä¿¡æ¯ã€‚å¯é€‰çš„å‚æ•°å€¼åœ¨æšä¸¾ç±»å‹ RetentionPolicy ä¸­ï¼ŒåŒ…æ‹¬ï¼š </p>
<ul>
<li>RetentionPolicy.SOURCE æ³¨è§£å°†è¢«ç¼–è¯‘å™¨ä¸¢å¼ƒ </li>
<li>RetentionPolicy.CLASS æ³¨è§£åœ¨classæ–‡ä»¶ä¸­å¯ç”¨ï¼Œä½†ä¼šè¢«VMä¸¢å¼ƒ </li>
<li><p>RetentionPolicy.RUNTIME VMå°†åœ¨è¿è¡ŒæœŸä¹Ÿä¿ç•™æ³¨é‡Šï¼Œå› æ­¤å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¯»å–æ³¨è§£çš„ä¿¡æ¯ã€‚ </p>
<pre><code><span class="variable">@Documented</span> å°†æ­¤æ³¨è§£åŒ…å«åœ¨ javadoc ä¸­ ï¼Œå®ƒä»£è¡¨ç€æ­¤æ³¨è§£ä¼šè¢«javadocå·¥å…·æå–æˆæ–‡æ¡£ã€‚åœ¨docæ–‡æ¡£ä¸­çš„å†…å®¹ä¼šå› ä¸ºæ­¤æ³¨è§£çš„ä¿¡æ¯å†…å®¹ä¸åŒè€Œä¸åŒã€‚ç›¸å½“ä¸<span class="variable">@see</span>,<span class="variable">@param</span> ç­‰ã€‚

<span class="variable">@Inherited</span> å…è®¸å­ç±»ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ³¨è§£ï¼Œä¾‹å­ä¸­è¡¥å……ã€‚
</code></pre></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[Java æ³¨è§£]]>
    
    </summary>
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="æ³¨è§£" scheme="http://yoursite.com/tags/%E6%B3%A8%E8%A7%A3/"/>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World]]></title>
    <link href="http://yoursite.com/2016/02/01/hello-world/"/>
    <id>http://yoursite.com/2016/02/01/hello-world/</id>
    <published>2016-02-01T02:36:14.000Z</published>
    <updated>2015-06-24T13:02:38.000Z</updated>
    <content type="html"><![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2><h3 id="Create_a_new_post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨]]></title>
    <link href="http://yoursite.com/2016/01/14/Java%20%E5%BC%95%E7%94%A8/"/>
    <id>http://yoursite.com/2016/01/14/Java å¼•ç”¨/</id>
    <published>2016-01-14T09:27:00.000Z</published>
    <updated>2016-02-01T08:02:14.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨">å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨</h1><h2 id="å¼ºå¼•ç”¨_StrongReference">å¼ºå¼•ç”¨ StrongReference</h2><blockquote>
<p>åªè¦æŸä¸ªå¯¹è±¡æœ‰å¼ºå¼•ç”¨ä¸ä¹‹å…³è”ï¼ŒJVMå¿…å®šä¸ä¼šå›æ”¶è¿™ä¸ªå¯¹è±¡ï¼Œå³ä½¿åœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼ŒJVMå®æ„¿æŠ›å‡ºOutOfMemoryé”™è¯¯ä¹Ÿä¸ä¼šå›æ”¶è¿™ç§å¯¹è±¡</p>
</blockquote>
<p>è‹¥éœ€è¦ jvm å›æ”¶æ­¤å¯¹è±¡ï¼Œå¯ä»¥å°†å¯¹è±¡å¤åˆ¶ä¸º null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object o = <span class="keyword">new</span> Object();   <span class="comment">//  å¼ºå¼•ç”¨  </span></span><br><span class="line">o = <span class="keyword">null</span>;     <span class="comment">// å¸®åŠ©åƒåœ¾æ”¶é›†å™¨å›æ”¶æ­¤å¯¹è±¡</span></span><br></pre></td></tr></table></figure>
<p><strong>ä½†æ˜¯å¦‚æœè¿™ä¸ªoæ˜¯å…¨å±€çš„å˜é‡æ—¶ï¼Œå°±éœ€è¦åœ¨ä¸ç”¨è¿™ä¸ªå¯¹è±¡æ—¶èµ‹å€¼ä¸ºnullï¼Œå› ä¸ºå¼ºå¼•ç”¨ä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</strong></p>
<a id="more"></a>
<h2 id="è½¯å¼•ç”¨_SoftReference">è½¯å¼•ç”¨ SoftReference</h2><blockquote>
<p>å¯¹äºè½¯å¼•ç”¨å…³è”ç€çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³çš„æ—¶å€™JVMæ‰ä¼šå›æ”¶è¯¥å¯¹è±¡ã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œè¿™ä¸€ç‚¹å¯ä»¥å¾ˆå¥½åœ°ç”¨æ¥è§£å†³OOMçš„é—®é¢˜ï¼Œå¹¶ä¸”è¿™ä¸ªç‰¹æ€§å¾ˆé€‚åˆç”¨æ¥å®ç°ç¼“å­˜ï¼šæ¯”å¦‚ç½‘é¡µç¼“å­˜ã€å›¾ç‰‡ç¼“å­˜ç­‰ã€‚</p>
<h2 id="å¼±å¼•ç”¨_WeakReference">å¼±å¼•ç”¨ WeakReference</h2><blockquote>
<p>å½“JVMè¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›æ”¶è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡</p>
</blockquote>
<h2 id="è™šå¼•ç”¨_PhantomReference">è™šå¼•ç”¨ PhantomReference</h2><blockquote>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸è™šå¼•ç”¨å…³è”ï¼Œåˆ™è·Ÿæ²¡æœ‰å¼•ç”¨ä¸ä¹‹å…³è”ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p>
</blockquote>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1><blockquote>
<p><a href="http://www.cnblogs.com/dolphin0520/p/3784171.html" target="_blank" rel="external">http://www.cnblogs.com/dolphin0520/p/3784171.html</a><br><a href="http://blog.csdn.net/mazhimazh/article/details/19752475" target="_blank" rel="external">http://blog.csdn.net/mazhimazh/article/details/19752475</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[java å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨]]>
    
    </summary>
    
      <category term="GC" scheme="http://yoursite.com/tags/GC/"/>
    
      <category term="å¼•ç”¨" scheme="http://yoursite.com/tags/%E5%BC%95%E7%94%A8/"/>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android å†…å­˜æ³„éœ²]]></title>
    <link href="http://yoursite.com/2016/01/14/%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/"/>
    <id>http://yoursite.com/2016/01/14/å†…å­˜æ³„éœ²/</id>
    <published>2016-01-14T09:27:00.000Z</published>
    <updated>2016-02-01T08:03:26.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="å†…å­˜æ³„éœ²">å†…å­˜æ³„éœ²</h1><blockquote>
<p>å†…å­˜æ³„éœ²çš„å®šä¹‰:<br>å½“æŸäº›å¯¹è±¡ä¸å†è¢«åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨,ä½†æ˜¯ç”±äºä»ç„¶è¢«å¼•ç”¨è€Œå¯¼è‡´åƒåœ¾æ”¶é›†å™¨ä¸èƒ½é‡Šæ”¾(Remove,ç§»é™¤)ä»–ä»¬.</p>
</blockquote>
<h2 id="äº§ç”Ÿçš„åŸå› ï¼š">äº§ç”Ÿçš„åŸå› ï¼š</h2><p>å†…å­˜å¯¹è±¡æ˜æ˜å·²ç»ä¸éœ€è¦çš„æ—¶å€™ï¼Œè¿˜ä»ç„¶ä¿ç•™ç€è¿™å—å†…å­˜å’Œå®ƒçš„è®¿é—®æ–¹å¼ï¼ˆå¼•ç”¨ï¼‰</p>
<p><em>é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„å¼•ç”¨å°±å¾ˆå¯èƒ½å‘ç”Ÿå†…å­˜æ³„éœ²ï¼Œå°½ç®¡çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å·²ç»ä¸å†éœ€è¦ï¼Œä½†æ˜¯å› ä¸ºé•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æŒæœ‰å®ƒçš„å¼•ç”¨è€Œå¯¼è‡´ä¸èƒ½è¢«å›æ”¶ï¼Œè¿™å°±æ˜¯javaä¸­å†…å­˜æ³„éœ²çš„å‘ç”Ÿåœºæ™¯ã€‚</em></p>
<a id="more"></a>
<h3 id="å¸¸è§çš„å†…å­˜æ³„æ¼">å¸¸è§çš„å†…å­˜æ³„æ¼</h3><h4 id="éé™æ€å†…éƒ¨ç±»çš„é™æ€å®ä¾‹å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼">éé™æ€å†…éƒ¨ç±»çš„é™æ€å®ä¾‹å®¹æ˜“é€ æˆå†…å­˜æ³„æ¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityextends</span> <span class="title">Activity</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">static</span> Demo sInstance = <span class="keyword">null</span>;  </span><br><span class="line">          </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(BundlesavedInstanceState)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </span><br><span class="line">        setContentView(R.layout.activity_main);  </span><br><span class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;  </span><br><span class="line">           sInstance= <span class="keyword">new</span> Demo();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Demo</span></span>&#123;  </span><br><span class="line">    voiddoSomething()  &#123;  </span><br><span class="line">               System.out.print(<span class="string">"dosth."</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç ä¸­çš„sInstanceå®ä¾‹ç±»å‹ä¸ºé™æ€å®ä¾‹ï¼Œåœ¨ç¬¬ä¸€ä¸ªMainActivity act1å®ä¾‹åˆ›å»ºæ—¶ï¼ŒsInstanceä¼šè·å¾—å¹¶ä¸€ç›´æŒæœ‰act1çš„å¼•ç”¨ã€‚å½“MainAcitivityé”€æ¯åé‡å»ºï¼Œå› ä¸ºsInstanceæŒæœ‰act1çš„å¼•ç”¨ï¼Œæ‰€ä»¥act1æ˜¯æ— æ³•è¢«GCå›æ”¶çš„ï¼Œè¿›ç¨‹ä¸­ä¼šå­˜åœ¨2ä¸ªMainActivityå®ä¾‹ï¼ˆact1å’Œé‡å»ºåçš„MainActivityå®ä¾‹ï¼‰ï¼Œè¿™ä¸ªact1å¯¹è±¡å°±æ˜¯ä¸€ä¸ªæ— ç”¨çš„ä½†ä¸€ç›´å ç”¨å†…å­˜çš„å¯¹è±¡ï¼Œå³æ— æ³•å›æ”¶çš„åƒåœ¾å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œå¯¹äºlauchModeä¸æ˜¯singleInstanceçš„Activityï¼Œ åº”è¯¥é¿å…åœ¨activityé‡Œé¢å®ä¾‹åŒ–å…¶éé™æ€å†…éƒ¨ç±»çš„é™æ€å®ä¾‹ã€‚</p>
<h4 id="activityä½¿ç”¨é™æ€æˆå‘˜">activityä½¿ç”¨é™æ€æˆå‘˜</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Drawable sBackground;    </span><br><span class="line"><span class="annotation">@Override</span>    </span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle state)</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">super</span>.onCreate(state);    </span><br><span class="line">    </span><br><span class="line">    TextView label = <span class="keyword">new</span> TextView(<span class="keyword">this</span>);    </span><br><span class="line">    label.setText(<span class="string">"Leaks are bad"</span>);    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (sBackground == <span class="keyword">null</span>) &#123;    </span><br><span class="line">        sBackground = getDrawable(R.drawable.large_bitmap);    </span><br><span class="line">    &#125;    </span><br><span class="line">    label.setBackgroundDrawable(sBackground);    </span><br><span class="line">    </span><br><span class="line">    setContentView(label);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºç”¨é™æ€æˆå‘˜sBackground ç¼“å­˜äº†drawableå¯¹è±¡ï¼Œæ‰€ä»¥activityåŠ è½½é€Ÿåº¦ä¼šåŠ å¿«ï¼Œä½†æ˜¯è¿™æ ·åšæ˜¯é”™è¯¯çš„ã€‚å› ä¸ºåœ¨android 2.3ç³»ç»Ÿä¸Šï¼Œå®ƒä¼šå¯¼è‡´activityé”€æ¯åæ— æ³•è¢«ç³»ç»Ÿå›æ”¶ã€‚</p>
<p>label .setBackgroundDrawableå‡½æ•°è°ƒç”¨ä¼šå°†labelèµ‹å€¼ç»™sBackgroundçš„æˆå‘˜å˜é‡mCallbackã€‚</p>
<p>ä¸Šé¢ä»£ç æ„å‘³ç€ï¼šsBackgroundï¼ˆGC Rootï¼‰ä¼šæŒæœ‰TextViewå¯¹è±¡ï¼Œè€ŒTextViewæŒæœ‰Activityå¯¹è±¡ã€‚æ‰€ä»¥å¯¼è‡´Activityå¯¹è±¡æ— æ³•è¢«ç³»ç»Ÿå›æ”¶ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹android4.0ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜æ‰€åšçš„æ”¹è¿›ã€‚</p>
<p>å…ˆçœ‹çœ‹android 2.3çš„Drawable.Javaå¯¹setCallbackçš„å®ç°ï¼š</p>
<pre><code><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">setCallback</span><span class="params">(Callback cb)</span></span>{

    mCallback = cb;
</code></pre><p>}</p>
<p>å†çœ‹çœ‹android 4.0çš„Drawable.Javaå¯¹setCallbackçš„å®ç°ï¼š</p>
<pre><code><span class="keyword">public</span> <span class="keyword">final</span> <span class="function"><span class="keyword">void</span> <span class="title">setCallback</span><span class="params">(Callback cb)</span></span>{

    mCallback = newWeakReference&lt;Callback&gt; (cb);
</code></pre><p>}</p>
<p>åœ¨android 2.3ä¸­è¦é¿å…å†…å­˜æ³„æ¼ä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„, åœ¨activityçš„onDestroyæ—¶è°ƒç”¨</p>
<p>sBackgroundDrawable.setCallback(null)ã€‚</p>
<p>ä»¥ä¸Š2ä¸ªä¾‹å­çš„å†…å­˜æ³„æ¼éƒ½æ˜¯å› ä¸ºActivityçš„å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸè¶…è¶Šäº†activityå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¹Ÿå°±æ˜¯å¸¸è¯´çš„Contextæ³„æ¼ï¼Œå› ä¸ºactivityå°±æ˜¯contextã€‚</p>
<p>æƒ³è¦é¿å…contextç›¸å…³çš„å†…å­˜æ³„æ¼ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>ä¸è¦å¯¹activityçš„contexté•¿æœŸå¼•ç”¨(ä¸€ä¸ªactivityçš„å¼•ç”¨çš„ç”Ÿå­˜å‘¨æœŸåº”è¯¥å’Œactivityçš„ç”Ÿå‘½å‘¨æœŸç›¸åŒ)</li>
<li>å¦‚æœå¯ä»¥çš„è¯ï¼Œå°½é‡ä½¿ç”¨å…³äºapplicationçš„contextæ¥æ›¿ä»£å’Œactivityç›¸å…³çš„context</li>
<li>å¦‚æœä¸€ä¸ªacitivityçš„éé™æ€å†…éƒ¨ç±»çš„ç”Ÿå‘½å‘¨æœŸä¸å—æ§åˆ¶ï¼Œé‚£ä¹ˆé¿å…ä½¿ç”¨å®ƒï¼›æ­£ç¡®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªé™æ€çš„å†…éƒ¨ç±»ï¼Œå¹¶ä¸”å¯¹å®ƒçš„å¤–éƒ¨ç±»æœ‰ä¸€WeakReferenceï¼Œå°±åƒåœ¨ViewRootImplä¸­å†…éƒ¨ç±»Wæ‰€åšçš„é‚£æ ·ã€‚</li>
</ul>
<h4 id="ä½¿ç”¨handleræ—¶çš„å†…å­˜é—®é¢˜">ä½¿ç”¨handleræ—¶çš„å†…å­˜é—®é¢˜</h4><p>æˆ‘ä»¬çŸ¥é“ï¼ŒHandleré€šè¿‡å‘é€Messageä¸å…¶ä»–çº¿ç¨‹äº¤äº’ï¼ŒMessageå‘å‡ºä¹‹åæ˜¯å­˜å‚¨åœ¨ç›®æ ‡çº¿ç¨‹çš„MessageQueueä¸­çš„ï¼Œè€Œæœ‰æ—¶å€™Messageä¹Ÿä¸æ˜¯é©¬ä¸Šå°±è¢«å¤„ç†çš„ï¼Œå¯èƒ½ä¼šé©»ç•™æ¯”è¾ƒä¹…çš„æ—¶é—´ã€‚åœ¨Messageç±»ä¸­å­˜åœ¨ä¸€ä¸ªæˆå‘˜å˜é‡ targetï¼Œå®ƒå¼ºå¼•ç”¨äº†handlerå®ä¾‹ï¼Œå¦‚æœMessageåœ¨Queueä¸­ä¸€ç›´å­˜åœ¨ï¼Œå°±ä¼šå¯¼è‡´handlerå®ä¾‹æ— æ³•è¢«å›æ”¶ï¼Œå¦‚æœhandlerå¯¹åº”çš„ç±»æ˜¯éé™æ€å†…éƒ¨ç±» ï¼Œåˆ™ä¼šå¯¼è‡´å¤–éƒ¨ç±»å®ä¾‹ï¼ˆActivityæˆ–è€…Serviceï¼‰ä¸ä¼šè¢«å›æ”¶ï¼Œè¿™å°±é€ æˆäº†å¤–éƒ¨ç±»å®ä¾‹çš„æ³„éœ²ã€‚ æ‰€ä»¥æ­£ç¡®å¤„ç†Handlerç­‰ä¹‹ç±»çš„å†…éƒ¨ç±»ï¼Œåº”è¯¥å°†è‡ªå·±çš„Handlerå®šä¹‰ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œå¹¶ä¸”åœ¨ç±»ä¸­å¢åŠ ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œç”¨æ¥å¼±å¼•ç”¨å¤–éƒ¨ç±»å®ä¾‹ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutterClass</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">        ......  </span><br><span class="line">        ......  </span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span>  </span><br><span class="line">        </span>&#123;  </span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;OutterClass&gt; mOutterClassInstance;  </span><br><span class="line">            ......  </span><br><span class="line">            ......  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Android lint ä¼šäº§ç”Ÿä¸€ä¸ªè­¦å‘Š </p>
<blockquote>
<p>This Handler class should be static or leaks might occur (com.example.ta.MainActivity.1)<br>Issue: Ensures that Handler classes do not hold on to a reference to an outer class<br>Id: HandlerLeak<br>In Android, Handler classes should be static or leaks might occur. Messages enqueued on the application threadâ€™s MessageQueue also retain their target Handler. If the Handler is an inner class, its outer class will be retained as well. To avoid leaking the outer class, declare the Handler as a static nested class with a WeakReference to its outer class.</p>
</blockquote>
<p>åŸå› æ˜¯ï¼š<br>å½“Androidåº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå…ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨ä¸»çº¿ç¨‹çš„Looperå¯¹è±¡ï¼ŒLooperå®ç°äº†ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸€ä¸ªä¸€ä¸ªçš„å¤„ç†é‡Œé¢çš„Messageå¯¹è±¡ã€‚ä¸»çº¿ç¨‹Looperå¯¹è±¡åœ¨æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­å­˜åœ¨ã€‚<br>å½“åœ¨ä¸»çº¿ç¨‹ä¸­åˆå§‹åŒ–Handleræ—¶ï¼Œè¯¥Handlerå’ŒLooperçš„æ¶ˆæ¯é˜Ÿåˆ—å…³è”ã€‚å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„Messageä¼šå¼•ç”¨å‘é€è¯¥æ¶ˆæ¯çš„Handlerå¯¹è±¡ï¼Œè¿™æ ·ç³»ç»Ÿå¯ä»¥è°ƒç”¨ Handler#handleMessage(Message) æ¥åˆ†å‘å¤„ç†è¯¥æ¶ˆæ¯ã€‚<br>åœ¨Javaä¸­ï¼Œéé™æ€(åŒ¿å)å†…éƒ¨ç±»ä¼šå¼•ç”¨å¤–éƒ¨ç±»å¯¹è±¡ã€‚è€Œé™æ€å†…éƒ¨ç±»ä¸ä¼šå¼•ç”¨å¤–éƒ¨ç±»å¯¹è±¡ã€‚<br>å¦‚æœå¤–éƒ¨ç±»æ˜¯Activityï¼Œåˆ™ä¼šå¼•èµ·Activityæ³„éœ² ã€‚<br>å½“Activity finishåï¼Œå»¶æ—¶æ¶ˆæ¯ä¼šç»§ç»­å­˜åœ¨ä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—ä¸­1åˆ†é’Ÿï¼Œç„¶åå¤„ç†æ¶ˆæ¯ã€‚è€Œè¯¥æ¶ˆæ¯å¼•ç”¨äº†Activityçš„Handlerå¯¹è±¡ï¼Œç„¶åè¿™ä¸ªHandleråˆå¼•ç”¨äº†è¿™ä¸ªActivityã€‚è¿™äº›å¼•ç”¨å¯¹è±¡ä¼šä¿æŒåˆ°è¯¥æ¶ˆæ¯è¢«å¤„ç†å®Œï¼Œè¿™æ ·å°±å¯¼è‡´è¯¥Activityå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œä»è€Œå¯¼è‡´äº†ä¸Šé¢è¯´çš„ Activityæ³„éœ²ã€‚<br>è¦ä¿®æ”¹è¯¥é—®é¢˜ï¼Œåªéœ€è¦æŒ‰ç…§Lintæç¤ºçš„é‚£æ ·ï¼ŒæŠŠHandlerç±»å®šä¹‰ä¸ºé™æ€å³å¯ï¼Œç„¶åé€šè¿‡WeakReference æ¥ä¿æŒå¤–éƒ¨çš„Activityå¯¹è±¡ã€‚ </p>
<h4 id="æ³¨å†ŒæŸä¸ªå¯¹è±¡åæœªåæ³¨å†Œ">æ³¨å†ŒæŸä¸ªå¯¹è±¡åæœªåæ³¨å†Œ</h4><h4 id="é›†åˆä¸­å¯¹è±¡æ²¡æ¸…ç†é€ æˆçš„å†…å­˜æ³„éœ²">é›†åˆä¸­å¯¹è±¡æ²¡æ¸…ç†é€ æˆçš„å†…å­˜æ³„éœ²</h4><h4 id="èµ„æºå¯¹è±¡æ²¡å…³é—­é€ æˆçš„å†…å­˜æ³„éœ²">èµ„æºå¯¹è±¡æ²¡å…³é—­é€ æˆçš„å†…å­˜æ³„éœ²</h4><p>æ¯”å¦‚ cursor ã€file</p>
<h2 id="GC_æœºåˆ¶">GC æœºåˆ¶</h2><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒGCä¼šé€‰æ‹©ä¸€äº›å®ƒäº†è§£è¿˜å­˜æ´»çš„å¯¹è±¡ä½œä¸ºå†…å­˜éå†çš„æ ¹èŠ‚ç‚¹ï¼ˆGC Rootsï¼‰ï¼Œæ¯”æ–¹è¯´thread stackä¸­çš„å˜é‡ï¼ŒJNIä¸­çš„å…¨å±€å˜é‡ï¼Œzygoteä¸­çš„å¯¹è±¡ï¼ˆclass loaderåŠ è½½ï¼‰ç­‰ï¼Œç„¶åå¼€å§‹å¯¹heapè¿›è¡Œéå†ã€‚åˆ°æœ€åï¼Œéƒ¨åˆ†æ²¡æœ‰ç›´æ¥æˆ–è€…é—´æ¥å¼•ç”¨åˆ°GC Rootsçš„å°±æ˜¯éœ€è¦å›æ”¶çš„åƒåœ¾ï¼Œä¼šè¢«GCå›æ”¶æ‰ã€‚å¦‚ä¸‹å›¾è“è‰²éƒ¨åˆ†</p>
<p><img src="http://img.blog.csdn.net/20131025115331781?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ2VtbWVt/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="GC"></p>
<ul>
<li>Shallow heapè¡¨ç¤ºå¯¹è±¡æœ¬èº«æ‰€å å†…å­˜å¤§å°ï¼Œä¸€ä¸ªå†…å­˜å¤§å°100bytesçš„å¯¹è±¡Shallow heapå°±æ˜¯100bytesã€‚</li>
<li>Retained heapè¡¨ç¤ºé€šè¿‡å›æ”¶è¿™ä¸€ä¸ªå¯¹è±¡æ€»å…±èƒ½å›æ”¶çš„å†…å­˜ï¼Œæ¯”æ–¹è¯´ä¸€ä¸ª100bytesçš„å¯¹è±¡è¿˜ç›´æ¥æˆ–è€…é—´æ¥åœ°æŒæœ‰äº†å¦å¤–3ä¸ª100bytesçš„å¯¹è±¡å¼•ç”¨ï¼Œå›æ”¶è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™å¦‚æœå¦å¤–3ä¸ªå¯¹è±¡æ²¡æœ‰å…¶ä»–å¼•ç”¨ä¹Ÿèƒ½è¢«å›æ”¶æ‰çš„æ—¶å€™ï¼ŒRetained heapå°±æ˜¯400bytesã€‚</li>
</ul>
<h2 id="å†…å­˜ç®¡ç†åˆ†æ">å†…å­˜ç®¡ç†åˆ†æ</h2><ol>
<li>æ‰“å¼€ DDMS ï¼Œé€‰ä¸­éœ€è¦åˆ†æçš„è¿›ç¨‹ï¼Œç„¶åç‚¹å‡»update heap<img src="media/14527590780897.jpg" alt=""></li>
<li>åœ¨app ä¸­æ“ä½œåï¼Œç‚¹å‡» Cause GC,è§‚å¯Ÿheap çš„ä½¿ç”¨é‡<br><img src="media/14527591546703.png" alt=""></li>
<li>ç‚¹å‡» <img src="media/14527592144127.png" alt=""> å¯¼å‡º HPROF æ–‡ä»¶</li>
<li>è½¬æ¢ hprof çš„æ ¼å¼ï¼Œä»è€Œæ”¯æŒä½¿ç”¨ MAT å·¥å…·æ‰“å¼€åˆ†æ</li>
<li><code>hprof-conv &lt;source_file&gt; &lt;dest_file&gt;</code></li>
<li>ä½¿ç”¨ MAT æ‰“å¼€ç”Ÿæˆæ–‡ä»¶</li>
<li>ç‚¹å‡»<img src="media/14527602568618.png" alt=""> æŸ¥çœ‹è¯¦æƒ…</li>
</ol>
<h2 id="MAT_ä½¿ç”¨">MAT ä½¿ç”¨</h2><ul>
<li>å¯ä»¥åœ¨ä¸Šé¢è¿‡æ»¤è‡ªå·±éœ€è¦çš„ç±»åï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</li>
<li>åœ¨æŸä¸€é¡¹ä¸Šå³é”®æ‰“å¼€èœå•é€‰æ‹© list objects -&gt;with incoming refs å°†åˆ—å‡ºè¯¥ç±»çš„å®ä¾‹ï¼š</li>
<li>å¿«é€Ÿæ‰¾å‡ºæŸä¸ªå®ä¾‹æ²¡è¢«é‡Šæ”¾çš„åŸå› ï¼Œå¯ä»¥å³å¥ Path to GC Rootsâ€”&gt;exclue all phantom/weak/soft etc</li>
</ul>
<ul>
<li>Shallow heapè¡¨ç¤ºå¯¹è±¡æœ¬èº«æ‰€å å†…å­˜å¤§å°ï¼Œä¸€ä¸ªå†…å­˜å¤§å°100bytesçš„å¯¹è±¡Shallow heapå°±æ˜¯100bytesã€‚</li>
<li>Retained heapè¡¨ç¤ºé€šè¿‡å›æ”¶è¿™ä¸€ä¸ªå¯¹è±¡æ€»å…±èƒ½å›æ”¶çš„å†…å­˜ï¼Œæ¯”æ–¹è¯´ä¸€ä¸ª100bytesçš„å¯¹è±¡è¿˜ç›´æ¥æˆ–è€…é—´æ¥åœ°æŒæœ‰äº†å¦å¤–3ä¸ª100bytesçš„å¯¹è±¡å¼•ç”¨ï¼Œå›æ”¶è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™å¦‚æœå¦å¤–3ä¸ªå¯¹è±¡æ²¡æœ‰å…¶ä»–å¼•ç”¨ä¹Ÿèƒ½è¢«å›æ”¶æ‰çš„æ—¶å€™ï¼ŒRetained heapå°±æ˜¯400bytesã€‚</li>
</ul>
<h2 id="åˆ†æå®ä¾‹">åˆ†æå®ä¾‹</h2><h3 id="å®ä¾‹1">å®ä¾‹1</h3><p>Matä¸­å¯¼å…¥æ•°æ®åï¼Œè¿‡æ»¤åŒ…åï¼ŒæŒ‰ç…§ obj æ•°é‡æ’åº<br><img src="media/14530982417272.png" alt=""><br>å‘ç° AsyncTaskService æœ‰9ä¸ªå®ä¾‹ï¼Œä¸æ­£å¸¸ï¼Œå³é”®  Path to GC Roots æŸ¥çœ‹<br><img src="media/14530983537752.png" alt=""><br>å‘ç°æ˜¯ volley ä¸­çš„ NetworkDispatcher æŒæœ‰äº† context å¯¼è‡´é‡Šæ”¾ä¸äº†</p>
<p><strong>NetworkDispatcher æŒæœ‰ï¼ˆç”¨åˆ°äº†ï¼‰ UserStatsPostRequest æŒæœ‰ mLIstenerã€mErrorListener æŒæœ‰ context</strong></p>
<p>åœ¨  <code>AsyncTaskService</code>ä¸­ <code>PoiInfoApi.refreshPoiInfo(AsyncTaskService.this, null);</code><br>ä¼ å…¥çš„ <code>context</code> æ˜¯<code>AsyncTaskService</code>ï¼Œå¯¼è‡´ <code>PoiInfo</code> ä¸ <code>AsyncTaskService</code>çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³è”<br>å½“ <code>service</code>ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼Œ<code>mLIstener</code> ä»ç„¶æŒæœ‰ <code>Service</code> ï¼Œå¯¼è‡´ GCæ— æ³•å›æ”¶ï¼Œå½“ä¸‹æ¬¡å†æ¬¡è¯·æ±‚ <code>Poiapi</code>æ—¶ï¼Œä¼šå†æ¬¡ç”¨åˆ°ä¸€ä¸ªæ–°çš„<code>AsyncTaskService</code> </p>
<h4 id="è§£å†³æ–¹æ³•">è§£å†³æ–¹æ³•</h4><p>ä¼ å…¥çš„ <code>context</code> ä¸ä½¿ç”¨ <code>activity</code> æˆ–<code>Service</code>è¿™æ ·å’Œ Android ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„ï¼Œä½¿ç”¨ <code>appcation</code> ä¸­çš„ <code>sContext</code></p>
<h3 id="å®ä¾‹2">å®ä¾‹2</h3><ol>
<li>ç‚¹å‡»<img src="media/14532588103369.png" alt=""> ï¼ŒæŒ‰ç…§å †æ’åº</li>
</ol>
<p><img src="media/14532588339301.png" alt=""><br>æ­¤æ—¶æ˜¯æŒ‰ç…§å ç”¨çš„å¤§å°æ’åºçš„ï¼Œé¦–å…ˆRetained Heapè¡¨ç¤ºè¿™ä¸ªå¯¹è±¡ä»¥åŠå®ƒæ‰€æŒæœ‰çš„å…¶å®ƒå¼•ç”¨ï¼ˆåŒ…æ‹¬ç›´æ¥å’Œé—´æ¥ï¼‰æ‰€å çš„æ€»å†…å­˜ï¼Œå› æ­¤ä»ä¸Šå›¾ä¸­çœ‹ï¼Œå‰ä¸¤è¡Œçš„Retained Heapæ˜¯æœ€å¤§çš„ï¼Œæˆ‘ä»¬åˆ†æå†…å­˜æ³„æ¼æ—¶ï¼Œå†…å­˜æœ€å¤§çš„å¯¹è±¡ä¹Ÿæ˜¯æœ€åº”è¯¥å»æ€€ç–‘çš„ã€‚</p>
<p>åœ¨æ¯ä¸€è¡Œçš„æœ€å·¦è¾¹éƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å‹çš„å›¾æ ‡ï¼Œè¿™äº›å›¾æ ‡æœ‰çš„å·¦ä¸‹è§’å¸¦æœ‰ä¸€ä¸ªçº¢è‰²çš„ç‚¹ï¼Œæœ‰çš„åˆ™æ²¡æœ‰ã€‚å¸¦æœ‰çº¢ç‚¹çš„å¯¹è±¡å°±è¡¨ç¤ºæ˜¯å¯ä»¥è¢«GC Rootsè®¿é—®åˆ°çš„ï¼Œæ ¹æ®ä¸Šé¢çš„è®²è§£ï¼Œå¯ä»¥è¢«GC Rootè®¿é—®åˆ°çš„å¯¹è±¡éƒ½æ˜¯æ— æ³•è¢«å›æ”¶çš„</p>
<p>ç¬¬ä¸€è¡Œä¸ºèµ„æºæ–‡ä»¶ï¼Œæ¯”è¾ƒå¤§å¾ˆæ­£å¸¸ï¼Œç¬¬äºŒè¡Œä¸º bitmapï¼Œç‚¹å‡»  -&gt; Path to GC Roots -&gt; exclude weak referencesï¼Œä¸ºä»€ä¹ˆé€‰æ‹©exclude weak referenceså‘¢ï¼Ÿå› ä¸ºå¼±å¼•ç”¨æ˜¯ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç›´æ¥æŠŠå®ƒæ’é™¤æ‰<br><img src="media/14532592207499.png" alt=""></p>
<p><strong>é»‘ä½“è¡¨ç¤ºå˜é‡åï¼Œå³ä¾§æ­£å¸¸ä½“è¡¨ç¤ºç±»åï¼Œ ç”±ä¸Šåˆ°ä¸‹è¡¨ç¤ºå«æœ‰å…³ç³»</strong></p>
<p>å¯ä»¥çœ‹åˆ° bitmap ä¹‹æ‰€ä»¥é‡Šæ”¾ä¸æ‰æ˜¯å› ä¸º linearLayout æ— æ³•é‡Šæ”¾ï¼Œè€ŒlinearLayoutä¹‹æ‰€ä»¥é‡Šæ”¾ä¸æ‰æ˜¯å› ä¸º linearLayout æ— æ³•é‡Šæ”¾ï¼Œæ˜¯å› ä¸º LoginActivity æ— æ³•é‡Šæ”¾ï¼Œâ€¦.æœ€ç»ˆå‘ç°æ˜¯ SPDataManagerä¸­ çš„ sContext æŒæœ‰äº† Activityï¼Œå¯¼è‡´ Activity æ— æ³•è¢« GCå›æ”¶</p>
<h4 id="è§£å†³æ–¹æ³•-1">è§£å†³æ–¹æ³•</h4><p>åœ¨æ„é€  SPDataManger æ—¶ï¼Œä¸ä½¿ç”¨ Activity çš„ context ï¼Œè€Œä½¿ç”¨ getapplicationContextï¼Œé¿å…ä¸ Actvity çš„ç”Ÿå‘½å‘¨æœŸå…³è”</p>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1><blockquote>
<p><a href="http://blog.csdn.net/gemmem/article/details/13017999" target="_blank" rel="external">http://blog.csdn.net/gemmem/article/details/13017999</a><br><a href="http://blog.csdn.net/guolin_blog/article/details/4223863" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/4223863</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[Android å†…å­˜æ³„éœ²]]>
    
    </summary>
    
      <category term="GC" scheme="http://yoursite.com/tags/GC/"/>
    
      <category term="å†…å­˜æ³„éœ²" scheme="http://yoursite.com/tags/%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/"/>
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android Studio æŠ€å·§]]></title>
    <link href="http://yoursite.com/2016/01/11/IDEA%20%E6%8A%80%E5%B7%A7/"/>
    <id>http://yoursite.com/2016/01/11/IDEA æŠ€å·§/</id>
    <published>2016-01-11T09:27:00.000Z</published>
    <updated>2016-02-01T08:04:26.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="IDEA_æŠ€å·§">IDEA æŠ€å·§</h1><h2 id="é‡æ„">é‡æ„</h2><ul>
<li>Undo<br><strong>Commend + Z</strong><br><em>undo æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥æ’¤é”€æ‰€æœ‰ refactor æ“ä½œã€‚</em></li>
<li>Find and replace code duplicates<br><em>å¯ä»¥é€‰æ‹©å½“å‰æ–‡ä»¶ï¼Œuncommit æ–‡ä»¶ã€é¡¹ç›®ç­‰ è¿›è¡Œæ›¿æ¢</em></li>
<li>Rename<br><strong>Shift + Commend + F6</strong></li>
<li>Type migration<br><strong>Shift + Commend + F6</strong><br>æ”¹å˜å˜é‡çš„å±æ€§ï¼Œä¸¾ä¸ªğŸŒ° ï¼Œ å¯ä»¥å°† int -&gt; Long ï¼Œéœ€è¦migration çš„æ˜¯ int è€Œä¸æ˜¯å˜é‡</li>
<li>Invert boolean<br>åè½¬ boolean å‹å˜é‡å€¼ ï¼Œtrue -&gt; false, false -&gt; true ,åŒæ—¶ rename å˜é‡å€¼</li>
<li>safe delete<br><strong>Fn + Commend + Delete</strong><br>å®‰å…¨åˆ é™¤</li>
<li><p>extract<br>æå–å˜é‡ã€å‚æ•°ç­‰</p>
</li>
<li><p>æå–ä¸ºå‚æ•°:Option + Cmd + P  å°†å˜é‡æå–åˆ°æ–¹æ³•ä¸­ä¸ºæ–¹æ³•çš„å‚æ•°</p>
</li>
<li>æå–å˜é‡ä¸ºå‡½æ•°å:Option + Cmd + V å°† new å‡ºçš„å¯¹è±¡ï¼Œæå–æˆä¸€ä¸ªå¯¹è±¡</li>
<li>æå–å¸¸é‡:Option + Cmd + C æå–çš„å¸¸é‡ä¸º static final,TAGå¿«é€Ÿç”Ÿæˆ</li>
<li>æå–æ–¹æ³•:Option + Cmd + M</li>
<li>æå–ä¸ºæˆå‘˜å˜é‡:Option + Cmd + F</li>
</ul>
<a id="more"></a>
<h3 id="push_menber_up/down">push menber up/down</h3><p>æŠŠè¿™ä¸ªå˜é‡ã€æ–¹æ³• æ”¾å…¥çˆ¶ç±»/å­ç±»</p>
<h2 id="è·³è½¬">è·³è½¬</h2><ul>
<li>å¢åŠ ä¹¦ç­¾:Option + F3</li>
<li>è·³è½¬ä¹¦ç­¾:Cmd + F3</li>
<li>è¿›å…¥å‡½æ•°:Cmd + B</li>
<li>è·³è½¬åˆ°ä¸Šæ¬¡ä½¿ç”¨è¿‡çš„æ–‡ä»¶:Control + Tab</li>
<li>è·³è½¬åˆ°æœ€è¿‘ä½¿ç”¨è¿‡çš„æ–‡ä»¶:Comand + E</li>
<li>è·³è½¬åˆ° navigation bavï¼šComand + ä¸Š<h2 id="ç¼–è¾‘">ç¼–è¾‘</h2></li>
<li>ä¸Šä¸‹ç§»åŠ¨ä»£ç :Option + Shift + Up/Down</li>
<li>æ‰©å¤§ç¼©å°é€‰ä¸­èŒƒå›´:Option + Up/Down</li>
<li>è‡ªåŠ¨è¡¥å…¨: Cmd + shift + enter</li>
<li>è·³è½¬ä¸Šæ¬¡ç¼–è¾‘:Cmd + shift + backspace</li>
<li>å¿«é€Ÿä¿®å¤:Option + enter</li>
<li>å¿«é€Ÿç”Ÿæˆä»£ç :Cmd + Option + T</li>
<li>æ ¼å¼åŒ–ä»£ç :Cmd + Option + L</li>
<li>åˆ—ç¼–è¾‘æ¨¡å¼: Cmd + shift + 8</li>
</ul>
<h2 id="æŸ¥æ‰¾">æŸ¥æ‰¾</h2><ul>
<li>æ™ºèƒ½æŸ¥æ‰¾:shift shift</li>
<li>æŸ¥æ‰¾ç±»:Cmd + O</li>
<li>æŸ¥æ‰¾æ–‡ä»¶:shift + Cmd + O</li>
<li>æŸ¥æ‰¾æ–¹æ³•:Cmd + F12</li>
<li>æŸ¥æ‰¾è°ƒç”¨:Option + F7</li>
<li>å¿«é€ŸæŸ¥çœ‹å®ç°æ–¹æ³•ï¼Œä¸ç”¨è·³è½¬æ–°çª—å£:Option + space</li>
<li>æŸ¥çœ‹æŸä¸ªæ–¹æ³•çš„è°ƒç”¨è·¯å¾„:control + Option+ H</li>
<li>æŸ¥çœ‹ç±»çš„ç»§æ‰¿å…³ç³»:control + H<h2 id="è°ƒè¯•">è°ƒè¯•</h2></li>
<li>è¿è¡Œ:control + R</li>
<li>è°ƒè¯•:control + D</li>
<li>å•æ­¥:F8</li>
<li>è¿›å…¥å‡½æ•°:F7</li>
<li>å…¨é€Ÿè¿è¡Œ: Option + Cmd + R<h3 id="å…¶ä»–">å…¶ä»–</h3></li>
<li>æŸ¥çœ‹ class ç»“æ„:Cmd + F12</li>
<li>æç¤ºè¾“å…¥:Cmd + P</li>
<li>æ™ºèƒ½å‘½ä»¤:shift + Cmd + A Analyze Data Flow to Here å¯ä»¥æŸ¥æ‰¾è¿™ä¸ªå˜é‡çš„æµç¨‹</li>
<li>æ¡ä»¶æ–­ç‚¹:åœ¨æ–­ç‚¹å¤„å³é”®</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[Android Android Studio æŠ€å·§]]>
    
    </summary>
    
      <category term="Android Studio" scheme="http://yoursite.com/tags/Android-Studio/"/>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[VIM æŠ€å·§]]></title>
    <link href="http://yoursite.com/2016/01/10/VIM/"/>
    <id>http://yoursite.com/2016/01/10/VIM/</id>
    <published>2016-01-10T09:27:00.000Z</published>
    <updated>2016-02-01T08:04:57.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="VIM">VIM</h1><h2 id="ä»£ç é€‰æ‹©">ä»£ç é€‰æ‹©</h2><p>v:é€‰æ‹©ä»£ç å—<br>V:é€‰æ‹©ä»£ç è¡Œ<br>ctrl+V:å¤šè¡Œé€‰ä¸­æ¨¡å¼ ï¼ˆesc ä¹‹åç”Ÿæ•ˆï¼‰</p>
<h2 id="è·³è½¬">è·³è½¬</h2><ul>
<li>ï¼‰:ä»£ç å¿«è·³è½¬</li>
<li>] :å‡½æ•°è·³è½¬</li>
<li>} :class è·³è½¬ <h2 id="ç§»åŠ¨">ç§»åŠ¨</h2></li>
<li>hjkl</li>
<li>f/F: æŸ¥æ‰¾å­—ç¬¦</li>
<li>t/T: åŒä¸Šï¼ŒåŒºåˆ«æ˜¯åœç•™å‰ä¸€ä¸ªå­—ç¬¦</li>
<li>gg/G: æ–‡ä»¶å¼€å¤´/ç»“å°¾ </li>
<li>H/M/Lï¼šè·³åˆ°å½“å‰å±å¹•çš„é¡¶éƒ¨/ä¸­é—´/åº•éƒ¨ã€‚</li>
<li>â€˜[ è·³åˆ°ä¸Šä¸€æ¬¡è¢«æ”¹å˜çš„æ–‡æœ¬çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</li>
<li>â€˜. è·³åˆ°ä¸Šä¸€æ¬¡æ–‡æœ¬è¢«ä¿®æ”¹çš„åœ°æ–¹</li>
<li>â€˜â€™ ==è·³å›ä¸Šä¸€æ¬¡è·³è½¬çš„åœ°æ–¹==</li>
<li>â€˜^ è·³åˆ°æ’å…¥æ¨¡å¼æœ€åä¸€æ¬¡ç»“æŸçš„åœ°æ–¹ <h2 id="ç¼–è¾‘æ¨¡å¼">ç¼–è¾‘æ¨¡å¼</h2></li>
<li>x/Xæ˜¯åˆ é™¤å½“å‰å…‰æ ‡ä¸‹/å…‰æ ‡å‰çš„ä¸€ä¸ªå­—ç¬¦</li>
<li>d/c/yæ˜¯åˆ é™¤/ä¿®æ”¹/å¤åˆ¶å‘½ä»¤</li>
</ul>
<p><em>diw, yiw, ciw, viw åˆ é™¤(å¤åˆ¶,æ”¹å˜,é€‰ä¸­)å…‰æ ‡æ‰€åœ¨å•è¯<br>daâ€, yaâ€, caâ€, vaâ€ åˆ é™¤(å¤åˆ¶,æ”¹å˜,é€‰ä¸­)â€â€å·å†…æ‰€æœ‰æ–‡æœ¬,åŒ…æ‹¬å¼•å·æœ¬èº«</em></p>
<ul>
<li>* å‘å‰æŸ¥æ‰¾å½“å‰å…‰æ ‡ä¸‹çš„å•è¯</li>
<li># åæ–¹å‘æŸ¥æ‰¾å½“å‰å…‰æ ‡ä¸‹çš„å•è¯ </li>
<li>æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªåœ°æ–¹åˆ é™¤å†…å®¹ï¼Œç„¶åéœ€è¦åˆ†åˆ«ç²˜è´´ï¼Œè¿™æ ·çš„æƒ…å†µå°±éœ€è¦ç”¨åˆ°â€ayy â€œapè¿™æ ·çš„å‘½ä»¤äº†ï¼Œâ€ayyæ˜¯æŠŠå½“å‰è¡Œå¤åˆ¶åˆ°åå­—ä¸ºaçš„å¯„å­˜å™¨ä¸­ï¼Œâ€apå°±æ˜¯åœ¨è¿™é‡Œç²˜å¸–aå¯„å­˜å™¨ä¸­çš„å†…å®¹ã€‚</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[VIM æŠ€å·§]]>
    
    </summary>
    
      <category term="Vim" scheme="http://yoursite.com/tags/Vim/"/>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Looperã€Handlerã€Message åˆ†æ]]></title>
    <link href="http://yoursite.com/2015/12/02/Looper%E3%80%81Handler%E3%80%81Message%20%E5%88%86%E6%9E%90/"/>
    <id>http://yoursite.com/2015/12/02/Looperã€Handlerã€Message åˆ†æ/</id>
    <published>2015-12-02T04:32:00.000Z</published>
    <updated>2016-02-01T08:05:04.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="Looperã€Handlerã€Message_åˆ†æ">Looperã€Handlerã€Message åˆ†æ</h1><h2 id="Looper">Looper</h2><p>é€šå¸¸åœ¨çº¿ç¨‹ä¸­æ˜¯è¿™æ ·ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LooperThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">     <span class="keyword">public</span> Handler mHandler;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          Looper.prepare();</span><br><span class="line"></span><br><span class="line">          mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">                  <span class="comment">// process incoming messages here</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;;</span><br><span class="line">          Looper.loop();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<h3 id="prepare()">prepare()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    prepare(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ª Looper åªèƒ½æœ‰ä¸€ä¸ª ThreadLoacl å¯¹è±¡</p>
<blockquote>
<p>ThreadLocalå¯¹è±¡ä¿è¯æ¯ä¸ªçº¿ç¨‹ä¸­çš„ Looper å®ä¾‹äº’ä¸ç›¸åŒ</p>
</blockquote>
<a id="more"></a>
<h3 id="loop()">loop()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Looper me = myLooper();</span><br><span class="line">        <span class="keyword">if</span> (me == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"No Looper; Looper.prepare() wasn't called on this thread."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> MessageQueue queue = me.mQueue;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure the identity of this thread is that of the local process,</span></span><br><span class="line">        <span class="comment">// and keep track of what that identity token actually is.</span></span><br><span class="line">        Binder.clearCallingIdentity();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> ident = Binder.clearCallingIdentity();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Message msg = queue.next(); <span class="comment">// might block</span></span><br><span class="line">            <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// This must be in a local variable, in case a UI event sets the logger</span></span><br><span class="line">            Printer logging = me.mLogging;</span><br><span class="line">            <span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</span><br><span class="line">                logging.println(<span class="string">"&gt;&gt;&gt;&gt;&gt; Dispatching to "</span> + msg.target + <span class="string">" "</span> +</span><br><span class="line">                        msg.callback + <span class="string">": "</span> + msg.what);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            msg.target.dispatchMessage(msg);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (logging != <span class="keyword">null</span>) &#123;</span><br><span class="line">                logging.println(<span class="string">"&lt;&lt;&lt;&lt;&lt; Finished to "</span> + msg.target + <span class="string">" "</span> + msg.callback);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Make sure that during the course of dispatching the</span></span><br><span class="line">            <span class="comment">// identity of the thread wasn't corrupted.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">long</span> newIdent = Binder.clearCallingIdentity();</span><br><span class="line">            <span class="keyword">if</span> (ident != newIdent) &#123;</span><br><span class="line">                Log.wtf(TAG, <span class="string">"Thread identity changed from 0x"</span></span><br><span class="line">                        + Long.toHexString(ident) + <span class="string">" to 0x"</span></span><br><span class="line">                        + Long.toHexString(newIdent) + <span class="string">" while dispatching to "</span></span><br><span class="line">                        + msg.target.getClass().getName() + <span class="string">" "</span></span><br><span class="line">                        + msg.callback + <span class="string">" what="</span> + msg.what);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            msg.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>mylooper()<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sThreadLocal.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç›´æ¥è¿”å›ThreadLocalä¸­å­˜å‚¨çš„ Looper å˜é‡ã€‚<br>ç„¶åå–å‡º looper ä¸­çš„ Queueï¼Œå¹¶ä¸”å¾ªç¯å–å‡ºé˜Ÿåˆ—ä¸­çš„ messageï¼Œäº¤ç»™<code>msg.target.dispatchMessage(msg);</code>å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;  </span><br><span class="line">            handleCallback(msg);  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;  </span><br><span class="line">                <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;  </span><br><span class="line">                    <span class="keyword">return</span>;  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">            handleMessage(msg);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>handleMessage(msg)</code>æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨åˆ›å»º handler å®ä¾‹æ—¶ï¼Œå¤å†™è¿™ä¸ªæ–¹æ³•ã€‚ç„¶åæ ¹æ®msg.whatè¿›è¡Œæ¶ˆæ¯å¤„ç†</p>
<h2 id="Handler">Handler</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">            <span class="keyword">final</span> Class&lt;? extends Handler&gt; klass = getClass();</span><br><span class="line">            <span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">                    (klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">                Log.w(TAG, <span class="string">"The following Handler class should be static or leaks might occur: "</span> +</span><br><span class="line">                    klass.getCanonicalName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        mLooper = Looper.myLooper();</span><br><span class="line">        <span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mQueue = mLooper.mQueue;</span><br><span class="line">        mCallback = callback;</span><br><span class="line">        mAsynchronous = async;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œé€šè¿‡<code>Looper.myLooper()</code>è·å–å½“å‰çº¿ç¨‹ä¸­çš„ Looper å¯¹è±¡ï¼Œå¹¶ä¸”å¾—åˆ°å…¶ä¸­çš„ Queue</p>
<p>æ‰€æœ‰ <code>sendMessage</code>ã€<code>sendMessageDelayed</code>ã€<code>sendEmptyMessageDelayed</code>ç­‰ï¼Œæœ€ç»ˆéƒ½è°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">    MessageQueue queue = mQueue;</span><br><span class="line">    <span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">        Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆä¼šå°†meg åŠ å…¥åˆ° queue çš„é˜Ÿåˆ—ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(Message msg, <span class="keyword">long</span> when)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.isInUse()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AndroidRuntimeException(msg + <span class="string">" This message is already in use."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (msg.target == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AndroidRuntimeException(<span class="string">"Message must have a target."</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mQuitting) &#123;</span><br><span class="line">                RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                        msg.target + <span class="string">" sending message to a Handler on a dead thread"</span>);</span><br><span class="line">                Log.w(<span class="string">"MessageQueue"</span>, e.getMessage(), e);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            msg.when = when;</span><br><span class="line">            Message p = mMessages;</span><br><span class="line">            <span class="keyword">boolean</span> needWake;</span><br><span class="line">            <span class="keyword">if</span> (p == <span class="keyword">null</span> || when == <span class="number">0</span> || when &lt; p.when) &#123;</span><br><span class="line">                <span class="comment">// New head, wake up the event queue if blocked.</span></span><br><span class="line">                msg.next = p;</span><br><span class="line">                mMessages = msg;</span><br><span class="line">                needWake = mBlocked;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Inserted within the middle of the queue.  Usually we don't have to wake</span></span><br><span class="line">                <span class="comment">// up the event queue unless there is a barrier at the head of the queue</span></span><br><span class="line">                <span class="comment">// and the message is the earliest asynchronous message in the queue.</span></span><br><span class="line">                needWake = mBlocked &amp;&amp; p.target == <span class="keyword">null</span> &amp;&amp; msg.isAsynchronous();</span><br><span class="line">                Message prev;</span><br><span class="line">                <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                    prev = p;</span><br><span class="line">                    p = p.next;</span><br><span class="line">                    <span class="keyword">if</span> (p == <span class="keyword">null</span> || when &lt; p.when) &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</span><br><span class="line">                        needWake = <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                msg.next = p; <span class="comment">// invariant: p == prev.next</span></span><br><span class="line">                prev.next = msg;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// We can assume mPtr != 0 because mQuitting is false.</span></span><br><span class="line">            <span class="keyword">if</span> (needWake) &#123;</span><br><span class="line">                nativeWake(mPtr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Handler_post">Handler post</h2><p>eg</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mHandler.post(<span class="keyword">new</span> Runnable()  </span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span>  </span><br><span class="line">            </span>&#123;  </span><br><span class="line">                <span class="comment">//do something </span></span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">post</span><span class="params">(Runnable r)</span>  </span><br><span class="line">   </span>&#123;  </span><br><span class="line">      <span class="keyword">return</span>  sendMessageDelayed(getPostMessage(r), <span class="number">0</span>);  </span><br><span class="line">   &#125;  </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Message <span class="title">getPostMessage</span><span class="params">(Runnable r)</span> </span>&#123;</span><br><span class="line">        Message m = Message.obtain();</span><br><span class="line">        m.callback = r;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨getPostMessageä¸­ï¼Œå¾—åˆ°äº†ä¸€ä¸ªMessageå¯¹è±¡ï¼Œç„¶åå°†æˆ‘ä»¬åˆ›å»ºçš„Runableå¯¹è±¡ä½œä¸ºcallbackå±æ€§ï¼Œèµ‹å€¼ç»™äº†æ­¤message.</p>
<blockquote>
<p>äº§ç”Ÿä¸€ä¸ªMessageå¯¹è±¡ï¼Œå¯ä»¥new  ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Message.obtain()æ–¹æ³•ï¼›ä¸¤è€…éƒ½å¯ä»¥ï¼Œä½†æ˜¯æ›´å»ºè®®ä½¿ç”¨obtainæ–¹æ³•ï¼Œå› ä¸ºMessageå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªMessageæ± ç”¨äºMessageçš„å¤ç”¨ï¼Œé¿å…ä½¿ç”¨new é‡æ–°åˆ†é…å†…å­˜ã€‚</p>
</blockquote>
<p>æœ€ç»ˆè¿˜æ˜¯ä¼šè°ƒç”¨<code>enqueueMessage</code></p>
<p>åœ¨ dispathMessage çš„è¿‡ç¨‹ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;  </span><br><span class="line">       <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;  </span><br><span class="line">           handleCallback(msg);  </span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">           <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;  </span><br><span class="line">               <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;  </span><br><span class="line">                   <span class="keyword">return</span>;  </span><br><span class="line">               &#125;  </span><br><span class="line">           &#125;  </span><br><span class="line">           handleMessage(msg);  </span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨<code>getPostMessage</code>ä¸­ï¼Œå°†post ä¸­çš„<code>Runnable</code>èµ‹å€¼ç»™äº†<code>Message.callback</code><br>æ‰€ä»¥ï¼Œä¼šæ‰§è¡Œ<code>handleCallback(msg)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">handleCallback</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        message.callback.run();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å³æ‰§è¡Œ Post ä¸­çš„Runnable</p>
]]></content>
    <summary type="html">
    <![CDATA[Looperã€Handlerã€Message åˆ†æ]]>
    
    </summary>
    
      <category term="Handler" scheme="http://yoursite.com/tags/Handler/"/>
    
      <category term="Looper" scheme="http://yoursite.com/tags/Looper/"/>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android Media Player]]></title>
    <link href="http://yoursite.com/2015/10/27/Media%20Playback/"/>
    <id>http://yoursite.com/2015/10/27/Media Playback/</id>
    <published>2015-10-27T03:32:00.000Z</published>
    <updated>2016-02-01T07:53:59.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="Media_Player">Media Player</h1><h2 id="Audio_Stream">Audio Stream</h2><p>Androidä¸ºä¸åŒçš„åº”ç”¨åœºåˆå®šä¹‰äº†ä¸åŒçš„Audio Stream: Voice Call, Ring, Music,Alarm, Notification, DTMFã€‚ è¿™äº›AudioStreamæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥ä¹Ÿæœ‰å„è‡ªçš„éŸ³é‡</p>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2><p>æœ€é‡è¦çš„ç±»æ˜¯ <code>MediaPlayer</code>ï¼Œè·å–ã€è§£ç ã€æ’­æ”¾<br>æ’­æ”¾ res/raw ä¸­çš„æ–‡ä»¶ ä¸¾ä¸ªğŸŒ°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MediaPlayer mediaPlayer = MediaPlayer.create(context, R.raw.sound_file_1);</span><br><span class="line">mediaPlayer.start(); <span class="comment">// no need to call prepare(); create() does that for you</span></span><br></pre></td></tr></table></figure>
<h3 id="å¼‚æ­¥å‡†å¤‡">å¼‚æ­¥å‡†å¤‡</h3><p>å¯èƒ½éœ€è¦æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œmedia éœ€è¦è·å–èµ„æºå’Œè§£ç ï¼Œæœ€å¥½ä¸è¦æ”¾åœ¨ UI çº¿ç¨‹ã€‚<br>æ­¤æ—¶å¯ä»¥ä½¿ç”¨<code>prepareAsync()</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨åå°è¿è¡Œï¼Œå½“å‡†å¤‡å·¥èµ„å°±ç»ªä¹‹ååœ¨<code>MediaPlayer.OnPreparedListener</code>è¿”å›ï¼Œå¯ä»¥åœ¨å›è°ƒå‡½æ•°<code>setOnPreparedListener()</code>ä¸­è®¾ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.prepareAsync();</span><br><span class="line">mediaPlayer.setOnPreparedListener(<span class="keyword">new</span> MediaPlayer.OnPreparedListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPrepared</span><span class="params">(MediaPlayer mp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span>: 15/10/27  </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="ç®¡ç†çŠ¶æ€">ç®¡ç†çŠ¶æ€</h3><p>player æœ‰ç‰¹æœ‰çš„çŠ¶æ€ï¼Œå½“æ“ä½œ player æ—¶åªèƒ½å½“ player å¤„ç†ç‰¹å®šçš„çŠ¶æ€ä¸­ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸æˆ–è€…å…¶ä»–ä¸€äº›æƒ³ä¸åˆ°çš„æƒ…å†µã€‚<br>ä¸¾ä¸ªğŸŒ°ï¼Œå½“ creatä¸€ä¸ªæ–°<code>MediaPlayer</code>æ—¶ï¼Œä»–å¤„äº<em>idle</em>çŠ¶æ€ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼Œå¯ä»¥åˆå§‹åŒ–ï¼Œè°ƒç”¨<code>setDataSource()</code>ï¼Œè¿™æ ·å°±è¿›å…¥äº†<em>Initialized</em> çŠ¶æ€ï¼Œæ¥ç€æˆ‘ä»¬è°ƒç”¨<code>prepare()</code>æˆ–è€… <code>prepareAsync()</code>ï¼Œå½“<code>MediaPlayer</code>å‡†å¤‡å®Œå…¨ä¹‹åï¼Œä¼šè¿›å…¥<em>Prepared</em>çŠ¶æ€ï¼Œå½“<code>start()</code>æ’­æ”¾ä¹‹åï¼Œå¯ä»¥è°ƒç”¨ paused stopped ç­‰ï¼›</p>
<p>çŠ¶æ€æµç¨‹å¦‚å›¾<br><img src="http://developer.android.com/images/mediaplayer_state_diagram.gif" alt="çŠ¶æ€æµç¨‹"></p>
<h3 id="é‡Šæ”¾MediaPlayer">é‡Šæ”¾MediaPlayer</h3><p>MediaPlayerä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå½“ä¸åœ¨éœ€è¦çš„æ—¶å€™éœ€è¦ç”¨<code>release()</code>é‡Šæ”¾ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.release();</span><br><span class="line">mediaPlayer = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨_Service_MediaPlayer">ä½¿ç”¨ Service MediaPlayer</h2><p>â€¦â€¦â€¦â€¦</p>
<h2 id="audio_focus">audio focus</h2><p>æŒ‰ç…§AudioFocusçš„æœºåˆ¶ï¼Œåœ¨ä½¿ç”¨Audioä¹‹å‰ï¼Œéœ€è¦ç”³è¯·AudioFocusï¼Œåœ¨è·å¾—AudioFocusä¹‹åæ‰å¯ä»¥ä½¿ç”¨Audioï¼›å¦‚æœæœ‰åˆ«çš„ç¨‹åºç«äº‰ä½ æ­£åœ¨ä½¿ç”¨çš„Audioï¼Œä½ çš„ç¨‹åºéœ€è¦åœ¨æ”¶åˆ°é€šçŸ¥ä¹‹ååšåœæ­¢æ’­æ”¾æˆ–è€…é™ä½å£°éŸ³çš„å¤„ç†ã€‚å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™ç§æœºåˆ¶æ˜¯éœ€è¦åˆä½œå®Œæˆçš„ï¼Œéœ€è¦æ‰€æœ‰ä½¿ç”¨Audioèµ„æºçš„ç¨‹åºéƒ½æŒ‰ç…§è¿™ç§æœºåˆ¶æ¥åšï¼Œè€Œå¦‚æœæœ‰ç¨‹åºåœ¨å®ƒå¤±å»AudioFocusçš„æ—¶å€™ä»ç„¶åœ¨ä½¿ç”¨Audioï¼ŒAudioFocusæ‹¿å®ƒä¹Ÿæ²¡åŠæ³•ã€‚è€Œè¿™ä¸€ç‚¹å¯¹äºå¼€æ”¾ç³»ç»Ÿçš„Androidæ¥è¯´å¾ˆè‡´å‘½çš„ï¼šç”¨æˆ·å¯èƒ½å®‰è£…æ²¡éµå®ˆè¿™ç§æœºåˆ¶çš„ç¨‹åºï¼Œæˆ–è€…ç‰ˆæœ¬å¤ªè€è¿˜æ²¡å¼•å…¥è¿™ç§æœºåˆ¶çš„ç¨‹åºï¼Œè¿™æœ€ç»ˆä¼šå¯¼è‡´å¾ˆå·®çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>å½“åº”ç”¨éœ€è¦æ’­æ”¾å£°éŸ³æˆ–è€… notification æ—¶ï¼Œéœ€è¦è¯·æ±‚audio focusï¼Œä¸€æ—¦è·å–ç„¦ç‚¹ä¹‹åï¼Œä¾¿å¯ä»¥æ’­æ”¾å£°éŸ³ï¼Œå¦‚æœæœ‰å¾ˆå¤šåˆ«çš„audio focusï¼Œè¦ä¹ˆåœæ­¢æ’­æ”¾æ­¤æ—¶çš„éŸ³ä¹ï¼Œæˆ–è€…<em>lower it to a quiet level</em>ï¼Œå†ä¹‹åè·å–audio focusç»§ç»­æ’­æ”¾</p>
<p>è·å–/æ”¾å¼ƒAudioFocusçš„æ–¹æ³•éƒ½åœ¨android.media.AudioManagerä¸­ï¼Œè·å–AudioFocusç”¨<code>requestAudioFocus()</code>ï¼›ç”¨å®Œä¹‹åï¼Œæ”¾å¼ƒAudioFocusï¼Œç”¨<code>abandonAudioFocus()</code>ã€‚</p>
<p>ä¸¾ğŸŒ°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">AudioManager audioManager = (AudioManager) getSystemService(Context.AUDIO_SERVICE);</span><br><span class="line"><span class="keyword">int</span> result = audioManager.requestAudioFocus(<span class="keyword">this</span>, AudioManager.STREAM_MUSIC,</span><br><span class="line">    AudioManager.AUDIOFOCUS_GAIN);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (result != AudioManager.AUDIOFOCUS_REQUEST_GRANTED) &#123;</span><br><span class="line">    <span class="comment">// could not get audio focus.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>requestAudioFocus()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•° æ˜¯<code>AudioManager.OnAudioFocusChangeListener</code>å…¶ä¸­çš„<code>onAudioFocusChange()</code>æ–¹æ³•<br>ğŸŒ° </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span></span><br><span class="line">                <span class="keyword">implements</span> <span class="title">AudioManager</span>.<span class="title">OnAudioFocusChangeListener</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAudioFocusChange</span><span class="params">(<span class="keyword">int</span> focusChange)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Do something based on focus change...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶onAudioFocusChange()æ–¹æ³•æ˜¯Audio Focusè¢«æŠ¢å ä¸å†æ¬¡è·å¾—é€šçŸ¥çš„åœ°æ–¹ã€‚æ‰€ä»¥ï¼Œæ¯ä¸ªè¦ä½¿ç”¨AudioFocusçš„ç¨‹åºéƒ½è¦å°å¿ƒå®ç°è¿™ä¸ªå‡½æ•°ï¼Œä¿è¯AudioFocuså®ç°çš„ä¸€è‡´æ€§ã€‚ç”³è¯·æˆåŠŸä¹‹åç›‘å¬AudioFocusä½¿ç”¨æƒ…å†µçš„Listenerï¼Œå‚æ•° <code>foucsChange</code></p>
<ul>
<li><code>AUDIOFOCUS_GAIN</code>:è·å–åˆ°äº†ç„¦ç‚¹</li>
<li><code>AUDIOFOCUS_LOSS</code>:å¤±å»ç„¦ç‚¹å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå¿…é¡»åœæ­¢æ‰€æœ‰çš„ audio playbackï¼Œæ­¤æ—¶å¯ä»¥é‡Šæ”¾èµ„æºäº†ï¼Œæ¯”å¦‚é‡Šæ”¾ <code>MediaPlayer</code></li>
<li><code>AUDIOFOCUS_LOSS_TRANSIENT</code>:æš‚æ—¶å¤±å»ç„¦ç‚¹ï¼Œä½†æ˜¯ä¼šä¹‹åè·å–åˆ°ç„¦ç‚¹ã€‚æ­¤æ—¶å¿…é¡»åœæ­¢æ’­æ”¾ï¼Œä½†æ˜¯èµ„æºä¸å¿…é‡Šæ”¾ï¼Œå› ä¸ºä¹‹åä¼šè·å–ç„¦ç‚¹</li>
<li><code>AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</code>: æš‚æ—¶å¤±å»ç„¦ç‚¹ï¼Œä½†æ˜¯å…è®¸ç»§ç»­å°å£°çš„æ’­æ”¾éŸ³ä¹ï¼Œè€Œä¸å¿…å…³é—­æ’­æ”¾<br>ä¸¾ä¸ªğŸŒ°</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAudioFocusChange</span><span class="params">(<span class="keyword">int</span> focusChange)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (focusChange) &#123;</span><br><span class="line">        <span class="keyword">case</span> AudioManager.AUDIOFOCUS_GAIN:</span><br><span class="line">            <span class="comment">// resume playback</span></span><br><span class="line">            <span class="keyword">if</span> (mMediaPlayer == <span class="keyword">null</span>) initMediaPlayer();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!mMediaPlayer.isPlaying()) mMediaPlayer.start();</span><br><span class="line">            mMediaPlayer.setVolume(<span class="number">1.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> AudioManager.AUDIOFOCUS_LOSS:</span><br><span class="line">            <span class="comment">// Lost focus for an unbounded amount of time: stop playback and release media player</span></span><br><span class="line">            <span class="keyword">if</span> (mMediaPlayer.isPlaying()) mMediaPlayer.stop();</span><br><span class="line">            mMediaPlayer.release();</span><br><span class="line">            mMediaPlayer = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> AudioManager.AUDIOFOCUS_LOSS_TRANSIENT:</span><br><span class="line">            <span class="comment">// Lost focus for a short time, but we have to stop</span></span><br><span class="line">            <span class="comment">// playback. We don't release the media player because playback</span></span><br><span class="line">            <span class="comment">// is likely to resume</span></span><br><span class="line">            <span class="keyword">if</span> (mMediaPlayer.isPlaying()) mMediaPlayer.pause();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> AudioManager.AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK:</span><br><span class="line">            <span class="comment">// Lost focus for a short time, but it's ok to keep playing</span></span><br><span class="line">            <span class="comment">// at an attenuated level</span></span><br><span class="line">            <span class="keyword">if</span> (mMediaPlayer.isPlaying()) mMediaPlayer.setVolume(<span class="number">0.1f</span>, <span class="number">0.1f</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„æ—¶åºå›¾æè¿°äº†AudioFocusè¢«æŠ¢å ä¸å†æ¬¡è·å–çš„å…¸å‹åœºæ™¯<br><img src="http://my.csdn.net/uploads/201204/03/1333406240_6856.jpg" alt=""></p>
<ul>
<li>AudioFocus Clienté€šè¿‡requestAudioFocus()è·å–AudioFocusï¼Œåœ¨è·å¾—AudioFocusä¹‹åï¼Œå¼€å§‹æ’­æ”¾Audio[Step#1 ~ #2]ï¼›</li>
<li>å…¶å®ƒç¨‹åºï¼ˆOther Appï¼‰ä¹Ÿé€šè¿‡requestAudioFocus()è·å–AudioFocus [Step#3]</li>
<li>AudioFocus Clientå¤±å»äº†Audio Focusï¼Œåœ¨onAudioFocusChanged()ä¸­ï¼Œæ ¹æ®focusChangeã€focusChangeçš„å€¼ä¸Other Appç”³è¯·æ—¶çš„durationHintç›¸åï¼Œå³focusChange = -1*durationHintã€‘çš„å€¼ï¼Œåšç¬¬äºŒèŠ‚ä¸­æ‰€æè¿°çš„å¤„ç†[Step#4]ï¼›</li>
<li>å…¶å®ƒç¨‹åºï¼ˆOther Appï¼‰è·å–Audio Focusä¹‹åï¼Œå¼€å§‹æ’­æ”¾Audio[Step#5]ï¼›</li>
<li>å…¶å®ƒç¨‹åºï¼ˆOther Appï¼‰ä½¿ç”¨Audioä¹‹åï¼Œé€šè¿‡abandonAudioFocus()å½’è¿˜AudioFocus [Step#6]ï¼›</li>
<li>AudioFocus Clienté‡æ–°è·å¾—äº†Audio Focusï¼Œå¯åšè¿›ä¸€æ­¥çš„å¤„ç† [Step#7]</li>
</ul>
<p>AudioFocusä¸­è™½ç„¶æŠŠAudioStreamä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯AudioFocusçš„å†…éƒ¨è£å†³æœºåˆ¶å¹¶æœªé’ˆå¯¹AudioStreamåšä»€ä¹ˆç‰¹åˆ«çš„å¤„ç†ã€‚AudioFocusçš„å¤„ç†é’ˆå¯¹æ‰€æœ‰çš„ç”³è¯·è€…æ¥è¯´çš„ï¼Œé™¤äº†å®ƒè‡ªèº«å†…éƒ¨ä½œä¸ºAlertçš„ç”³è¯·è€…æœ‰ç‚¹ç‰¹æ®Šå¤–ï¼Œå…¶å®ƒä¸€å¾‹å¹³ç­‰ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[Android View å°ç»“]]>
    
    </summary>
    
      <category term="viewï¼ŒMedia Player" scheme="http://yoursite.com/tags/view%EF%BC%8CMedia-Player/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android View å°ç»“ï¼ˆä¸‹ï¼‰]]></title>
    <link href="http://yoursite.com/2015/10/24/%E8%87%AA%E5%AE%9A%E4%B9%89view/"/>
    <id>http://yoursite.com/2015/10/24/è‡ªå®šä¹‰view/</id>
    <published>2015-10-24T13:32:00.000Z</published>
    <updated>2016-02-01T07:52:00.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="è‡ªå®šä¹‰_view">è‡ªå®šä¹‰ view</h1><p>è‡ªå®šä¹‰ view çš„ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>è‡ªå®šä¹‰ view å±æ€§</li>
<li>åœ¨ view çš„æ„é€ æ–¹æ³•ä¸­ï¼ŒåŠ è½½è‡ªå®šä¹‰çš„å±æ€§</li>
<li>é‡å†™ onLayout</li>
<li>é‡å†™ onMeasure</li>
<li>é‡å†™ onDraw</li>
</ol>
<h2 id="è‡ªå®šä¹‰_view_å±æ€§">è‡ªå®šä¹‰ view å±æ€§</h2><p>è‡ªå®šä¹‰Viewçš„å±æ€§ï¼Œé¦–å…ˆåœ¨res/values/  ä¸‹å»ºç«‹ä¸€ä¸ªattrs.xml</p>
<a id="more"></a>
<p>stye.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">resources</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Base application theme. --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;!<span class="tag">--</span> <span class="tag">Customize</span> <span class="tag">your</span> <span class="tag">theme</span> <span class="tag">here</span>. <span class="tag">--</span>&gt;</span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">customViewStyle</span>"&gt;<span class="at_rule">@<span class="keyword">style/custom_view_style&lt;/item&gt;</span></span><br><span class="line">    </span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"text_style"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="rule"><span class="attribute">android</span>:<span class="value">text<span class="string">"&gt;text from style&lt;/item&gt;</span><br><span class="line">    </span></span></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"default_view_style"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr4</span>"&gt;<span class="tag">attr4</span> <span class="tag">from</span> <span class="tag">default_view_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"custom_view_style"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr3</span>"&gt;<span class="tag">attr3</span> <span class="tag">from</span> <span class="tag">custom_view_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr4</span>"&gt;<span class="tag">attr4</span> <span class="tag">from</span> <span class="tag">custom_view_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"xml_style"</span>&gt;</span><span class="css"></span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr2</span>"&gt;<span class="tag">attr2</span> <span class="tag">from</span> <span class="tag">xml_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">        &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr3</span>"&gt;<span class="tag">attr3</span> <span class="tag">from</span> <span class="tag">xml_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewText"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewTextColor"</span> <span class="attribute">format</span>=<span class="value">"color"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewTextSize"</span> <span class="attribute">format</span>=<span class="value">"dimension"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"myView"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewText"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewTextColor"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewTextSize"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr1"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr2"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr3"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr4"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr5"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr6"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"customViewStyle"</span> <span class="attribute">format</span>=<span class="value">"reference"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸»å¸ƒå±€ä¸­åŠ è½½è‡ªå®šä¹‰çš„ view</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">RelativeLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span></span><br><span class="line">    <span class="attribute">xmlns:custum</span>=<span class="value">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ³¨æ„xmlnså¯¼å…¥çš„æ˜¯æ•´ä¸ªå·¥ç¨‹çš„åŒ…åï¼Œä¸æ˜¯ view çš„åŒ…å--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨ gradleå·¥ç¨‹ä¸­åªéœ€è¦    xmlns:custum="http://schemas.android.com/apk/res-auto"</span><br><span class="line">--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">io.github.xuyushi.viewtest.MyView</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:padding</span>=<span class="value">"10dp"</span></span><br><span class="line">        <span class="attribute">custum:myViewText</span>=<span class="value">"test"</span></span><br><span class="line">        <span class="attribute">custum:myViewTextColor</span>=<span class="value">"#ffff00"</span></span><br><span class="line">        <span class="attribute">custum:myViewTextSize</span>=<span class="value">"30sp"</span></span><br><span class="line">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„xmlnså¯¼å…¥çš„æ˜¯æ•´ä¸ªå·¥ç¨‹çš„åŒ…åï¼Œä¸æ˜¯ view çš„åŒ…å.åœ¨ gradleå·¥ç¨‹ä¸­åªéœ€è¦    xmlns:custum=â€<a href="http://schemas.android.com/apk/res-auto" target="_blank" rel="external">http://schemas.android.com/apk/res-auto</a>â€œ</p>
<p>2.è‡ªå®šä¹‰ view</p>
<p>è‡ªå®šä¹‰ view ç»§æ‰¿ view</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.viewtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.res.TypedArray;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Color;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Rect;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/10/23.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> String LOG_TAG = <span class="string">"MyView"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mText;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mextColor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mextSize;</span><br><span class="line">    <span class="keyword">private</span> Rect mBound;</span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span>: 15/10/23 ä¸‰ä¸ªæ„é€ å‡½æ•°åˆ†åˆ«ä»€ä¹ˆæ—¶å€™è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, R.attr.customViewStyle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        TypedArray array = context.getTheme()</span><br><span class="line">                .obtainStyledAttributes(attrs, R.styleable.myView, defStyleAttr, R.style.default_view_style);</span><br><span class="line">        <span class="keyword">int</span> n = array.getIndexCount();</span><br><span class="line"></span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"attr1 =&gt; "</span> + array.getString(R.styleable.myView_attr1));</span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"attr2 =&gt; "</span> + array.getString(R.styleable.myView_attr2));</span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"attr3 =&gt; "</span> + array.getString(R.styleable.myView_attr3));</span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"attr4 =&gt; "</span> + array.getString(R.styleable.myView_attr4));</span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"attr5 =&gt; "</span> + array.getString(R.styleable.myView_attr5));</span><br><span class="line">        Log.d(LOG_TAG, <span class="string">"attr6 =&gt; "</span> + array.getString(R.styleable.myView_attr6));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> attr = array.getIndex(i);</span><br><span class="line">            <span class="keyword">switch</span> (attr) &#123;</span><br><span class="line">                <span class="keyword">case</span> R.styleable.myView_myViewText:</span><br><span class="line">                    mText = array.getString(attr);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.styleable.myView_myViewTextColor:</span><br><span class="line">                    mextColor = array.getColor(attr, Color.BLACK);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.styleable.myView_myViewTextSize:</span><br><span class="line">                    mextSize = array.getDimensionPixelSize(attr,</span><br><span class="line">                            getResources().getDimensionPixelSize(R.dimen.textsize));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        array.recycle(); <span class="comment">//æ³¨æ„é‡Šæ”¾</span></span><br><span class="line">        mPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        mPaint.setTextSize(mextSize);</span><br><span class="line">        mBound = <span class="keyword">new</span> Rect();</span><br><span class="line">        Log.d(<span class="string">"MyView"</span>, <span class="string">"height"</span> + mBound.height());</span><br><span class="line">        mPaint.getTextBounds(mText, <span class="number">0</span>, mText.length(), mBound);</span><br><span class="line">        <span class="comment">//è°ƒç”¨getTextBounds æ–¹æ³•ä¹‹åï¼Œä¼šæ ¹æ®mTextè®¡ç®—mbound çš„å¤§å°</span></span><br><span class="line">        Log.d(<span class="string">"MyView"</span>, <span class="string">"height"</span> + mBound.height());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                mText = randText();</span><br><span class="line">                <span class="comment">//é•¿åº¦æ”¹å˜ï¼Œéœ€è¦é‡æ–° layout</span></span><br><span class="line">                requestLayout();</span><br><span class="line">                invalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">randText</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        Set&lt;Integer&gt; set = <span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">while</span> (set.size() &lt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> randomInt = random.nextInt(<span class="number">10</span>);</span><br><span class="line">            set.add(randomInt);</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (Integer i : set) &#123;</span><br><span class="line">            sb.append(<span class="string">""</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        return sb.toString();</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"1234567"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> width;</span><br><span class="line">        <span class="keyword">int</span> height;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (widthMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">        <span class="comment">//match parent æˆ–è€…ç›´æ¥å†™å®šå¤§å°</span></span><br><span class="line">            width = widthSize;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//wrap content</span></span><br><span class="line">            mPaint.setTextSize(mextSize);</span><br><span class="line">            mPaint.getTextBounds(mText, <span class="number">0</span>, mText.length(), mBound);</span><br><span class="line">            <span class="keyword">float</span> textWidth = mBound.width();</span><br><span class="line">            <span class="keyword">int</span> desired = (<span class="keyword">int</span>) (getPaddingLeft() + textWidth + getPaddingRight());</span><br><span class="line">            width = desired;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (heightMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            height = heightSize;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mPaint.setTextSize(mextSize);</span><br><span class="line">            mPaint.getTextBounds(mText, <span class="number">0</span>, mText.length(), mBound);</span><br><span class="line">            <span class="keyword">float</span> textHeight = mBound.height();</span><br><span class="line">            <span class="keyword">int</span> desired = (<span class="keyword">int</span>) (getPaddingTop() + textHeight + getPaddingBottom());</span><br><span class="line">            height = desired;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        setMeasuredDimension(width, height);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        mPaint.setColor(Color.RED);</span><br><span class="line">        canvas.drawRect(<span class="number">0</span>, <span class="number">0</span>, getMeasuredWidth(), getMeasuredHeight(), mPaint);</span><br><span class="line">        mPaint.setColor(mextColor);</span><br><span class="line">        canvas.drawText(mText, getWidth() / <span class="number">2</span> - mBound.width() / <span class="number">2</span>,</span><br><span class="line">                getHeight() / <span class="number">2</span> + mBound.height() / <span class="number">2</span></span><br><span class="line">                , mPaint);</span><br><span class="line">        Log.d(<span class="string">"onDraw"</span>, <span class="string">"height"</span> + mBound.height());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, left, top, right, bottom);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‡½æ•°è¯å…¸">å‡½æ•°è¯å…¸</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">public void getTextBounds (char[] text, int index, int count, Rect bounds)</span><br><span class="line"></span><br><span class="line">Added in API level 1</span><br><span class="line">Return in bounds (allocated by the caller) the smallest rectangle that encloses all of the characters, with an implied origin at (0,0).</span><br><span class="line"></span><br><span class="line">Parameters</span><br><span class="line">text	Array of chars to measure and return their unioned bounds</span><br><span class="line">index	Index of the first char in the array to measure</span><br><span class="line">count	The number of chars, beginning at index, to measure</span><br><span class="line">bounds	Returns the unioned bounds of all the text. Must be allocated by the caller.</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">Added in API level 1</span><br><span class="line">Draw the text, with origin at (x,y), using the specified paint. The origin is interpreted based on the Align setting in the paint.</span><br><span class="line"></span><br><span class="line">Parameters</span><br><span class="line">text	The text to be drawn</span><br><span class="line">x	The x-coordinate of the origin of the text being drawn</span><br><span class="line">y	The y-coordinate of the baseline of the text being drawn</span><br><span class="line">paint	The paint used for the text (e.g. color, size, style)</span><br><span class="line">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="viewçš„æ„é€ å‡½æ•°">viewçš„æ„é€ å‡½æ•°</h2><p>å¯ä»¥çœ‹åˆ°è‡ªå®šä¹‰çš„ view æœ‰ä¸‰ä¸ªæ„é€ æ–¹æ³•</p>
<ol>
<li>public void MyView(Context context) {}</li>
<li>public void MyView(Context context, AttributeSet attrs) {}</li>
<li>public void MyView(Context context, AttributeSet attrs, int defStyle) {}</li>
</ol>
<p><strong>ä¸‰ä¸ªæ„é€ æ–¹æ³•è°ƒç”¨çš„æƒ…å†µ</strong></p>
<ol>
<li>codeåŠ¨æ€åˆ›å»ºä¸€ä¸ªviewè€Œä¸ä½¿ç”¨å¸ƒå±€æ–‡ä»¶xml inflate</li>
<li>å¤šäº†ä¸€ä¸ªAttributeSetç±»å‹çš„å‚æ•°ï¼Œåœ¨é€šè¿‡å¸ƒå±€æ–‡ä»¶xmlåˆ›å»ºä¸€ä¸ªviewæ—¶ï¼Œè¿™ä¸ªå‚æ•°ä¼šå°†xmlé‡Œè®¾å®šçš„å±æ€§ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚å¦‚æœä½ é‡‡ç”¨xml inflateçš„æ–¹æ³•å´æ²¡æœ‰åœ¨codeé‡Œå®ç°C2ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶å°±ä¼šæŠ¥é”™ã€‚ä½†æ˜¯ç”±äºç¼–è¯‘èƒ½é¡ºåˆ©é€šè¿‡</li>
<li>åœ¨æºç ä¸­é€šå¸¸æ˜¯è‡ªå·±çš„æ˜¾ç¤ºè°ƒç”¨</li>
</ol>
<p>å®˜æ–¹æ–‡æ¡£å¦‚ä¸‹</p>
<blockquote>
<p>Perform inflation from XML and apply a class-specific base style. This constructor of View allows subclasses to use their own base style when they are inflating. For example, a Button classâ€™s constructor would call this version of the super class constructor and supply R.attr.buttonStyle for defStyle; this allows the themeâ€™s button style to modify all of the base view attributes (in particular its background) as well as the Button classâ€™s attributes.</p>
</blockquote>
<p>å¯¹ç¬¬ä¸‰ä¸ªå‚æ•°çš„è§£é‡Šæ˜¯ï¼š</p>
<blockquote>
<p>An attribute in the current theme that contains a reference to a style resource to apply to this view. If 0, no default style will be applied.</p>
</blockquote>
<p>ä»£ç ç¬¬<code>40</code>è¡Œï¼Œ <strong>æ³¨æ„ä¼ å…¥çš„å‚æ•°æ˜¯0 </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TypedArray array = context.getTheme()</span><br><span class="line">        .obtainStyledAttributes(attrs, R.styleable.myView, defStyleAttr, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>æ¥ç€åˆ†æ<code>obtainStyledAttributes</code><a href="http://developer.android.com/intl/zh-cn/reference/android/content/res/Resources.Theme.html#obtainStyledAttributes(android.util.AttributeSet,%20int[],%20int,%20int" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>)</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TypedArray <span class="title">obtainStyledAttributes</span> <span class="params">(AttributeSet <span class="built_in">set</span>, <span class="keyword">int</span>[] attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>setï¼šåœ¨XMLä¸­æ˜ç¡®å†™å‡ºäº†çš„å±æ€§é›†åˆ,å¦‚<code>android:layout_width</code>ï¼Œ åœ¨æœ¬ä¾‹å­ä¸­å³<code>myView_myViewTextColor</code></li>
<li>defStyleAttr: ä»£è¡¨éœ€è¦æŸ¥è¯¢è‡ªå®šä¹‰çš„å±æ€§å€¼çš„ viewï¼Œåœ¨æœ¬ç¨‹åºä¸­æŒ‡<code>myView</code></li>
<li>defStyleAttrï¼šè¿™æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨attrs.xmlæ–‡ä»¶ä¸­çš„attributeã€‚è¿™ä¸ªå€¼èµ·ä½œç”¨éœ€è¦ä¸¤ä¸ªæ¡ä»¶ï¼š1. å€¼ä¸ä¸º0ï¼›2. åœ¨Themeä¸­ä½¿ç”¨äº†</li>
<li>defStyleResï¼šè¿™æ˜¯åœ¨styles.xmlæ–‡ä»¶ä¸­å®šä¹‰çš„ä¸€ä¸ªstyleã€‚åªæœ‰å½“defStyleAttræ²¡æœ‰èµ·ä½œç”¨ï¼Œæ‰ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå€¼</li>
</ul>
<blockquote>
<p>å¦‚æœåœ¨Codeä¸­å®ä¾‹åŒ–ä¸€ä¸ªViewä¼šè°ƒç”¨ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¦‚æœåœ¨xmlä¸­å®šä¹‰ä¼šè°ƒç”¨ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ï¼Œè€Œç¬¬ä¸‰ä¸ªå‡½æ•°ç³»ç»Ÿæ˜¯ä¸è°ƒç”¨çš„ï¼Œè¦ç”±Viewï¼ˆæˆ‘ä»¬è‡ªå®šä¹‰çš„æˆ–ç³»ç»Ÿé¢„å®šä¹‰çš„Viewï¼Œå¦‚æ­¤å¤„çš„CustomTextViewå’ŒButtonï¼‰æ˜¾å¼è°ƒç”¨ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œæˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªæ„é€ å‡½æ•°ä¸­è°ƒç”¨äº†ç¬¬ä¸‰ä¸ªæ„é€ å‡½æ•°ï¼Œå¹¶å°†R.attr.CustomizeStyleä¼ ç»™äº†ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚</p>
</blockquote>
<p>ã€€ã€€ç¬¬ä¸‰ä¸ªå‚æ•°çš„æ„ä¹‰å°±å¦‚åŒå®ƒçš„åå­—æ‰€è¯´çš„ï¼Œæ˜¯é»˜è®¤çš„Styleï¼Œåªæ˜¯è¿™é‡Œæ²¡æœ‰è¯´æ¸…æ¥šï¼Œè¿™é‡Œçš„é»˜è®¤çš„Styleæ˜¯æŒ‡å®ƒåœ¨å½“å‰Applicationæˆ–Activityæ‰€ç”¨çš„Themeä¸­çš„é»˜è®¤Style<br>æ˜¾ç„¶ï¼Œä¸€ä¸ªå±æ€§æœ€ç»ˆçš„å–å€¼ï¼Œæœ‰ä¸€ä¸ªé¡ºåºé—®é¢˜ï¼Œè¿™ä¸ªé¡ºåºä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡æ˜¯ï¼š</p>
<p>==ç»“è®º==</p>
<ol>
<li>ç›´æ¥åœ¨XMLæ–‡ä»¶ä¸­å®šä¹‰çš„ã€‚</li>
<li>åœ¨XMLæ–‡ä»¶ä¸­é€šè¿‡styleè¿™ä¸ªå±æ€§å®šä¹‰çš„ã€‚</li>
<li>é€šè¿‡defStyleAttrå®šä¹‰çš„ã€‚</li>
<li>é€šè¿‡defStyleReså®šä¹‰çš„ã€‚</li>
<li>ç›´æ¥åœ¨å½“ç„¶å·¥ç¨‹çš„themeä¸»é¢˜ä¸‹å®šä¹‰çš„ã€‚</li>
</ol>
<h4 id="å®ç°è¿‡ç¨‹">å®ç°è¿‡ç¨‹</h4><h5 id="1-_åœ¨_view_çš„_attr_ä¸­å¢åŠ å±æ€§">1. åœ¨ view çš„ attr ä¸­å¢åŠ å±æ€§</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">declare-styleable</span> <span class="attribute">name</span>=<span class="value">"myView"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewText"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewTextColor"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"myViewTextSize"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr1"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr2"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr3"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr4"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr5"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"attr6"</span> <span class="attribute">format</span>=<span class="value">"string"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">declare-styleable</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">attr</span> <span class="attribute">name</span>=<span class="value">"customViewStyle"</span> <span class="attribute">format</span>=<span class="value">"reference"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„è¦å°†<code>customViewStyle</code> çš„æ ¼å¼ä¸º<code>reference</code></strong></p>
<h5 id="2-_åœ¨_style_ä¸­å®šä¹‰custom_view_style">2. åœ¨ style ä¸­å®šä¹‰custom_view_style</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"custom_view_style"</span>&gt;</span><span class="css"></span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr3</span>"&gt;<span class="tag">attr3</span> <span class="tag">from</span> <span class="tag">custom_view_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr4</span>"&gt;<span class="tag">attr4</span> <span class="tag">from</span> <span class="tag">custom_view_style</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3-åœ¨xml_ä¸­å®šä¹‰_xml_style">3.åœ¨xml ä¸­å®šä¹‰ xml_style</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"xml_style"</span>&gt;</span><span class="css">  </span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr2</span>"&gt;<span class="tag">attr2</span> <span class="tag">from</span> <span class="tag">xml_style</span>&lt;/<span class="tag">item</span>&gt;  </span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">attr3</span>"&gt;<span class="tag">attr3</span> <span class="tag">from</span> <span class="tag">xml_style</span>&lt;/<span class="tag">item</span>&gt;  </span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-_ä¸ºäº†ä½¿_theme_ç”Ÿæ•ˆ">4. ä¸ºäº†ä½¿ theme ç”Ÿæ•ˆ</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"AppTheme"</span> <span class="attribute">parent</span>=<span class="value">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">    &lt;!â€” <span class="tag">Customize</span> <span class="tag">your</span> <span class="tag">theme</span> <span class="tag">here</span>. â€”&gt;</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">customViewStyle</span>"&gt;<span class="at_rule">@<span class="keyword">style/custom_view_style&lt;/item&gt;</span></span><br><span class="line">    &lt;item name=<span class="string">"attr5"</span>&gt;attr5 from AppTheme&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">"attr6"</span>&gt;attr6 from AppTheme&lt;/item&gt;</span><br><span class="line"></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="5-_å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰">5. å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">io.github.xuyushi.viewtest.MyView</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">    <span class="attribute">android:padding</span>=<span class="value">"10dp"</span></span><br><span class="line">    <span class="attribute">custum:myViewText</span>=<span class="value">"test"</span></span><br><span class="line">    <span class="attribute">custum:myViewTextColor</span>=<span class="value">"#ffff00"</span></span><br><span class="line">    <span class="attribute">custum:myViewTextSize</span>=<span class="value">"30sp"</span></span><br><span class="line">    <span class="attribute">custum:attr1</span>=<span class="value">"attr1 from xml"</span></span><br><span class="line">    <span class="attribute">custum:attr2</span>=<span class="value">"attr2 from xml"</span></span><br><span class="line">    <span class="attribute">style</span>=<span class="value">"@style/xml_style"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="6-_å°†æœ€åä¸€ä¸ªå‚æ•°ç”±0å˜ä¸º">6. å°†æœ€åä¸€ä¸ªå‚æ•°ç”±0å˜ä¸º</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypedArray array = context.obtainStyledAttributes(attrs, R.styleable.CustomView, defStyle, R.style.default_view_style);</span><br></pre></td></tr></table></figure>
<h5 id="7-_åœ¨_view_çš„æ„é€ å‡½æ•°ä¸­è·å–è¿™äº›_attr1-6çš„å±æ€§">7. åœ¨ view çš„æ„é€ å‡½æ•°ä¸­è·å–è¿™äº› attr1-6çš„å±æ€§</h5><p><strong>log</strong></p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10-24 02:05</span>:37.136    <span class="number">4769-4769</span>/? D/MyViewï¹• attr1 =&gt; attr1 from xml</span><br><span class="line"><span class="number">10-24 02:05</span>:37.136    <span class="number">4769-4769</span>/? D/MyViewï¹• attr2 =&gt; attr2 from xml</span><br><span class="line"><span class="number">10-24 02:05</span>:37.136    <span class="number">4769-4769</span>/? D/MyViewï¹• attr3 =&gt; attr3 from xml_style</span><br><span class="line"><span class="number">10-24 02:05</span>:37.136    <span class="number">4769-4769</span>/? D/MyViewï¹• attr4 =&gt; attr4 from default_view_style</span><br><span class="line"><span class="number">10-24 02:05</span>:37.136    <span class="number">4769-4769</span>/? D/MyViewï¹• attr5 =&gt; attr5 from default_view_style</span><br><span class="line"><span class="number">10-24 02:05</span>:37.136    <span class="number">4769-4769</span>/? D/MyViewï¹• attr6 =&gt; null</span><br></pre></td></tr></table></figure>
<p>åˆ†æç»“æœ</p>
<ul>
<li>attr1åªåœ¨xmlå¸ƒå±€æ–‡ä»¶ä¸­è®¾ç½®ï¼Œæ‰€ä»¥å€¼ä¸ºattr1 from xmlã€‚</li>
<li>attr2åœ¨xmlå¸ƒå±€æ–‡ä»¶å’Œxml styleä¸­éƒ½è®¾ç½®äº†ï¼Œå–å€¼ä¸ºå¸ƒå±€æ–‡ä»¶ä¸­è®¾ç½®çš„å€¼ï¼Œæ‰€ä»¥ä¸ºattr2 from xmlã€‚</li>
<li>attr3æ²¡æœ‰åœ¨xmlå¸ƒå±€æ–‡ä»¶ä¸­è®¾ç½®ï¼Œä½†æ˜¯åœ¨xml styleå’ŒdefStyleAttrå®šä¹‰çš„styleä¸­è®¾ç½®äº†ï¼Œå–xml styleä¸­çš„å€¼ï¼Œæ‰€ä»¥å€¼ä¸ºattr3 from xml_styleã€‚</li>
<li>attr4åªåœ¨defStyleAttrå®šä¹‰çš„styleä¸­è®¾ç½®äº†ï¼Œæ‰€ä»¥å€¼ä¸ºattr4 from custom_view_styleã€‚</li>
<li>attr5å’Œattr6æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è®¾ç½®å€¼ï¼Œæ‰€ä»¥ä¸ºnullã€‚</li>
</ul>
<h4 id="æ€»ç»“">æ€»ç»“</h4><ol>
<li>ç›´æ¥åœ¨XMLå¸ƒå±€æ–‡ä»¶ä¸­è®¾ç½®çš„å€¼ä¼˜å…ˆçº§æœ€é«˜ï¼Œå¦‚æœè¿™é‡Œè®¾ç½®äº†å€¼ï¼Œå°±ä¸ä¼šå»å–å…¶ä»–åœ°æ–¹çš„å€¼äº†ã€‚</li>
<li>XMLå¸ƒå±€æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªå«â€œstyleâ€çš„å±æ€§ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªstyleï¼Œåœ¨è¿™ä¸ªstyleä¸­è®¾ç½®çš„å±æ€§å€¼ä¼˜å…ˆçº§æ¬¡ä¹‹ã€‚</li>
<li>å¦‚æœä¸Šé¢ä¸¤ä¸ªåœ°æ–¹éƒ½æ²¡æœ‰è®¾ç½®å€¼ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®Viewå¸¦ä¸‰ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°attributeæŒ‡å‘çš„styleè®¾ç½®å€¼ï¼Œå‰ææ˜¯è¿™ä¸ªattributeçš„å€¼ä¸ä¸º0ã€‚</li>
<li>å¦‚æœä¸Šé¢çš„attributeè®¾ç½®ä¸º0äº†ï¼Œæˆ‘ä»¬å°±æ ¹æ®obtainStyledAttributes()æ–¹æ³•ä¸­çš„æœ€åä¸€ä¸ªå‚æ•°æŒ‡å‘çš„styleæ¥è®¾ç½®å€¼ã€‚</li>
<li>å¦‚æœä»ç„¶æ²¡æœ‰è®¾ç½®åˆ°å€¼ï¼Œå°±ä¼šç”¨themeä¸­ç›´æ¥è®¾ç½®çš„å±æ€§å€¼ï¼Œè€Œä¸ä¼šå»ç®¡ç¬¬3æ­¥å’Œç¬¬4æ­¥ä¸­æ˜¯å¦è®¾ç½®äº†å€¼ã€‚</li>
</ol>
<blockquote>
<p><strong> å‚è€ƒ <a href="http://www.cnblogs.com/angeldevil/p/3479431.html" target="_blank" rel="external">http://www.cnblogs.com/angeldevil/p/3479431.html</a> è¯¦ç»†è§£é‡Š</strong></p>
</blockquote>
<h2 id="onMeasure">onMeasure</h2><p>onMeasure æ˜¯æµ‹é‡è§†å›¾çš„å¤§å°çš„</p>
<p>MeasureSpecçš„å€¼ç”±specSizeå’ŒspecModeå…±åŒç»„æˆçš„ï¼Œå…¶ä¸­specSizeè®°å½•çš„æ˜¯å¤§å°ï¼ŒspecModeè®°å½•çš„æ˜¯è§„æ ¼ã€‚specModeä¸€å…±æœ‰ä¸‰ç§ç±»å‹</p>
<ul>
<li>EXACTLYï¼šè¡¨ç¤ºçˆ¶è§†å›¾å¸Œæœ›å­è§†å›¾çš„å¤§å°åº”è¯¥æ˜¯ç”±specSizeçš„å€¼æ¥å†³å®šçš„ï¼Œç³»ç»Ÿé»˜è®¤ä¼šæŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥è®¾ç½®å­è§†å›¾çš„å¤§å°ï¼Œå¼€å‘äººå‘˜å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾ç½®æˆä»»æ„çš„å¤§å°ã€‚</li>
<li>AT_MOSTï¼šæœ€å¤šåªèƒ½æ˜¯specSizeä¸­æŒ‡å®šçš„å¤§å°ï¼Œå¼€å‘äººå‘˜åº”è¯¥å°½å¯èƒ½å°å¾—å»è®¾ç½®è¿™ä¸ªè§†å›¾ï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šè¶…è¿‡specSizeã€‚ç³»ç»Ÿé»˜è®¤ä¼šæŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥è®¾ç½®å­è§†å›¾çš„å¤§å°ï¼Œå¼€å‘äººå‘˜å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾ç½®æˆä»»æ„çš„å¤§å°ã€‚é€šå¸¸æ˜¯ wrapcontent</li>
<li>UNSPECIFIEDï¼šè¡¨ç¤ºå¼€å‘äººå‘˜å¯ä»¥å°†è§†å›¾æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾ç½®æˆä»»æ„çš„å¤§å°ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶</li>
</ul>
<p>å½“è®¾ç½®äº†WRAP_CONTENTæ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±è¿›è¡Œæµ‹é‡ï¼Œå³é‡å†™onMesure</p>
<p>è®¡ç®—é•¿å®½ æœ€åè°ƒç”¨ <code>setMeasuredDimension(width, height);</code></p>
<h2 id="onLayout">onLayout</h2><p>ç¡®å®šè§†å›¾çš„ä½ç½®ï¼Œä¸»è¦æ˜¯åœ¨ viewgroup ä¸­ä½¿ç”¨</p>
<p>ViewGroupä¸­çš„onLayout()æ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿™å°±æ„å‘³ç€æ‰€æœ‰ViewGroupçš„å­ç±»éƒ½å¿…é¡»é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªä¾‹å­ layout åªæœ‰ä¸€ä¸ªå­ view</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>(context, attrs);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);  </span><br><span class="line">        <span class="keyword">if</span> (getChildCount() &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">            View childView = getChildAt(<span class="number">0</span>);  </span><br><span class="line">            measureChild(childView, widthMeasureSpec, heightMeasureSpec);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> (getChildCount() &gt; <span class="number">0</span>) &#123;  </span><br><span class="line">            View childView = getChildAt(<span class="number">0</span>);  </span><br><span class="line">            childView.layout(<span class="number">0</span>, <span class="number">0</span>, childView.getMeasuredWidth(), childView.getMeasuredHeight());  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç éå¸¸çš„ç®€å•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å…·ä½“çš„é€»è¾‘å§ã€‚ä½ å·²ç»çŸ¥é“ï¼ŒonMeasure()æ–¹æ³•ä¼šåœ¨onLayout()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå› æ­¤è¿™é‡Œåœ¨onMeasure()æ–¹æ³•ä¸­åˆ¤æ–­SimpleLayoutä¸­æ˜¯å¦æœ‰åŒ…å«ä¸€ä¸ªå­è§†å›¾ï¼Œå¦‚æœæœ‰çš„è¯å°±è°ƒç”¨measureChild()æ–¹æ³•æ¥æµ‹é‡å‡ºå­è§†å›¾çš„å¤§å°ã€‚<br>æ¥ç€åœ¨onLayout()æ–¹æ³•ä¸­åŒæ ·åˆ¤æ–­SimpleLayoutæ˜¯å¦æœ‰åŒ…å«ä¸€ä¸ªå­è§†å›¾ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå­è§†å›¾çš„layout()æ–¹æ³•æ¥ç¡®å®šå®ƒåœ¨SimpleLayoutå¸ƒå±€ä¸­çš„ä½ç½®ï¼Œè¿™é‡Œä¼ å…¥çš„å››ä¸ªå‚æ•°ä¾æ¬¡æ˜¯0ã€0ã€childView.getMeasuredWidth()å’ŒchildView.getMeasuredHeight()ï¼Œåˆ†åˆ«ä»£è¡¨ç€å­è§†å›¾åœ¨SimpleLayoutä¸­å·¦ä¸Šå³ä¸‹å››ä¸ªç‚¹çš„åæ ‡ã€‚å…¶ä¸­ï¼Œè°ƒç”¨childView.getMeasuredWidth()å’ŒchildView.getMeasuredHeight()æ–¹æ³•å¾—åˆ°çš„å€¼å°±æ˜¯åœ¨onMeasure()æ–¹æ³•ä¸­æµ‹é‡å‡ºçš„å®½å’Œé«˜ã€‚</p>
<p><strong>åœ¨onLayout()è¿‡ç¨‹ç»“æŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨getWidth()æ–¹æ³•å’ŒgetHeight()æ–¹æ³•æ¥è·å–è§†å›¾çš„å®½é«˜äº†ï¼Œå¦åˆ™å¾—åˆ°æ˜¯ 0</strong></p>
<h2 id="onDraw">onDraw</h2><h2 id="ViewGroup">ViewGroup</h2><h1 id="å‚è€ƒ">å‚è€ƒ</h1><blockquote>
<p><a href="http://blog.csdn.net/lmj623565791/article/details/24252901" target="_blank" rel="external">http://blog.csdn.net/lmj623565791/article/details/24252901</a><br><a href="http://blog.csdn.net/lmj623565791/article/details/38339817" target="_blank" rel="external">http://blog.csdn.net/lmj623565791/article/details/38339817</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[Android View å°ç»“]]>
    
    </summary>
    
      <category term="view" scheme="http://yoursite.com/tags/view/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[robolectric]]></title>
    <link href="http://yoursite.com/2015/08/15/robolectric/"/>
    <id>http://yoursite.com/2015/08/15/robolectric/</id>
    <published>2015-08-15T07:25:00.000Z</published>
    <updated>2016-02-01T08:06:30.000Z</updated>
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h2><p>ç¯å¢ƒ : Android Studio 1.2.1.1+ Android Gradle Plugin 1.2.3+ Gradle 2.2.1+</p>
<p>gradleä¸­åŠ å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  ...</span><br><span class="line">  testCompile <span class="string">'org.robolectric:robolectric:3.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¡®è®¤åœ¨Build Variantsçª—å£å†…çš„Test Artifactä¸­é€‰æ‹©äº†â€Unit Testsâ€ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-ab4402443ad7dc5f.png" alt=""></p>
<p>ç„¶åï¼Œåœ¨å·¥ç¨‹çš„srcæ–‡ä»¶å¤¹å†…åˆ›å»ºtestå’Œtest/javaæ–‡ä»¶å¤¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ ä¸èƒ½åœ¨Androidè§†å›¾ä¸‹è¿›è¡Œè¿™äº›æ“ä½œï¼Œè¦ä¹ˆåœ¨ç³»ç»Ÿçš„æ–‡ä»¶ç®¡ç†å™¨å†…åˆ›å»ºï¼Œè¦ä¹ˆåœ¨å·¥ç¨‹çª—å£å·¦ä¸Šæ–¹ç‚¹å‡»ä¸‹æ‹‰èœå•é€‰æ‹©Projectè§†å›¾ã€‚æœ€ç»ˆçš„å·¥ç¨‹ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-9e098817f6fcca44.png" alt=""></p>
<blockquote>
<p>é…ç½®æˆåŠŸä¹‹å<code>java</code>æ–‡ä»¶å¤¹çš„é¢œè‰²æ˜¯ç»¿è‰²çš„</p>
</blockquote>
<p><code>**é‡è¦é‡è¦**</code><br>Run -&gt; Edit Configurations -&gt; Defaults -&gt; Junit<br>è®¾ç½®å¦‚ä¸‹  <strong>$MODULE_DIR$.</strong><br><img src="https://camo.githubusercontent.com/b6776bd8da529df04410b6c6d5d6a6a63ebce717/687474703a2f2f726f626f6c6563747269632e6f72672f696d616765732f616e64726f69642d73747564696f2d636f6e6669677572652d64656661756c74732d34626634383430322e706e67" alt=""></p>
<p>gradle åŒæ­¥</p>
<blockquote>
<p>æ³¨æ„Robolectricç›®å‰ä¸æ”¯æŒandroid 5.1 API level 22ï¼Œç¼–è¯‘æ—¶ sdk = 21 æˆ–è€…ä»¥ä¸‹ã€‚</p>
</blockquote>
<a id="more"></a>
<h2 id="å•å…ƒæµ‹è¯•å†™æ³•">å•å…ƒæµ‹è¯•å†™æ³•</h2><p><strong>@Config(constants = BuildConfig.class)</strong><br>è®°å¾—åŠ å…¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çœç•¥import</span></span><br><span class="line"><span class="annotation">@RunWith</span>(RobolectricGradleTestRunner.class)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainActivity activity;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œåˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validateTextViewContent</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	     <span class="comment">//æ‰§è¡Œå„ç§æµ‹è¯•é€»è¾‘åˆ¤æ–­</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Activity">Activity</h3><h4 id="Activityçš„åˆ›å»º">Activityçš„åˆ›å»º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Activity activity = Robolectric.buildActivity(MyAwesomeActivity.class).create().get();</span><br></pre></td></tr></table></figure>
<p>ä¼šåˆ›å»ºä¸€ä¸ª<code>MyAwesomeActivity</code>å®ä¾‹ï¼Œç„¶åè°ƒç”¨å®ƒçš„onCreat()æ–¹æ³•</p>
<p>å¦‚æœåªæƒ³éªŒè¯å…¶onResume()æ–¹æ³•ï¼Œå¯ä»¥å¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ActivityController controller = Robolectric.buildActivity(MyAwesomeActivity.class).create().start();</span><br><span class="line">Activity activity = controller.get();</span><br><span class="line"><span class="comment">// assert that something hasn't happened</span></span><br><span class="line">activityController.resume();</span><br><span class="line"><span class="comment">// assert it happened!</span></span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœæƒ³æµ‹è¯•æ•´ä¸ªactivity çš„ç”Ÿå‘½å‘¨æœŸå¯ä»¥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Activity activity = Robolectric.buildActivity(MyAwesomeActivity.class).create().start().resume().visible().get();</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>ç­‰ä½ éœ€è¦åœ¨activityä¸­ï¼Œå¯¹viewè¿›è¡Œä¸€äº›æ“ä½œæ—¶å€™ï¼Œæ¯”å¦‚<code>Robolectric.clickOn()</code>ï¼Œè¿™æ—¶å€™ä½ éœ€è¦åœ¨<code>create()</code>ååŠ å…¥<code>visible()</code></p>
</blockquote>
<h4 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h4><p>æˆ‘åœ¨å·¥ç¨‹ä¸­å»ºç«‹äº†ä¸‰ä¸ªActivityåˆ†åˆ«ä¸º MainActivityï¼ŒAnotherActivityï¼ŒThridActivity<br>åœ¨MainActivityåŠ å…¥æŒ‰é”®è·³è½¬åˆ°AnotherActivityä¸­ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startAnotherActivity</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">     startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherActivity.class));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>å¢åŠ å•å…ƒæµ‹è¯•ç”¨ä¾‹åˆ¤æ–­è·³è½¬çš„æ˜¯å¦æ­£ç¡®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clickingLogin_shouldStartLoginActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Button button = (Button) activity.findViewById(R.id.button);</span><br><span class="line">    assertTrue(button.isEnabled());</span><br><span class="line">    button.performClick();</span><br><span class="line"></span><br><span class="line">    Intent expectedIntent = <span class="keyword">new</span> Intent(activity, ThridActivity.class);</span><br><span class="line">    assertEquals(expectedIntent,shadowOf(activity).getNextStartedActivity() );</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>1.é€šè¿‡ activity.findViewById æ‰¾åˆ°button<br>2.åˆ¤æ–­buttonæ˜¯å¦å¯ä»¥ç‚¹å‡»<br>3.ç‚¹å‡»button<br>4.æ„é€ ä¸€ä¸ªintentï¼ˆä»MainActivityè·³è½¬åˆ°ThridActivityï¼‰<br>5.åˆ¤æ–­å®é™…è·³è½¬çš„å’Œæ„é€ çš„æ˜¯å¦ä¸€ç›´</p>
<p>ç»“æ„ä¸ä¸€è‡´æŠ¥é”™<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java.lang.AssertionError: </span><br><span class="line">Expected :Intent&#123;componentName=ComponentInfo&#123;io.github.xuyushi.robolectric/io.github.xuyushi.robolectric.ThridActivity&#125;, extras=Bundle[&#123;&#125;]&#125;</span><br><span class="line">Actual   :Intent&#123;componentName=ComponentInfo&#123;io.github.xuyushi.robolectric/io.github.xuyushi.robolectric.AnotherActivity&#125;, extras=Bundle[&#123;&#125;]&#125;</span><br><span class="line"> &lt;Click to see difference&gt;</span><br><span class="line">	at org.junit.Assert.fail(Assert.java:<span class="number">91</span>)</span><br><span class="line">	at org.junit.Assert.failNotEquals(Assert.java:<span class="number">645</span>)</span><br><span class="line">	at org.junit.Assert.assertEquals(Assert.java:<span class="number">126</span>)</span><br><span class="line">	at org.junit.Assert.assertEquals(Assert.java:<span class="number">145</span>)</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥å¾ˆæ¸…æ¥šçš„å®šä½åˆ°é”™è¯¯</p>
<h3 id="DialogéªŒè¯">DialogéªŒè¯</h3><h3 id="ToastéªŒè¯">ToastéªŒè¯</h3><h3 id="responseå†™æ³•">responseå†™æ³•</h3><h3 id="Shodaw">Shodaw</h3><h2 id="å‚è€ƒ">å‚è€ƒ</h2><blockquote>
<p><a href="http://hkliya.gitbooks.io/unit-test-android-with-robolectric/content/2-api-explained.html" target="_blank" rel="external">http://hkliya.gitbooks.io/unit-test-android-with-robolectric/content/2-api-explained.html</a><br><a href="http://robolectric.org" target="_blank" rel="external">http://robolectric.org</a><br><a href="http://chriszou.com/android-unit-testing-with-robolectric" target="_blank" rel="external">http://chriszou.com/android-unit-testing-with-robolectric</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[robolectric]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="robolectric" scheme="http://yoursite.com/tags/robolectric/"/>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android Studioä¸­è¿›è¡Œå•å…ƒæµ‹è¯•]]></title>
    <link href="http://yoursite.com/2015/08/15/Android%20Studio%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2015/08/15/Android Studioä¸­è¿›è¡Œå•å…ƒæµ‹è¯•/</id>
    <published>2015-08-15T07:25:00.000Z</published>
    <updated>2016-02-01T08:05:53.000Z</updated>
    <content type="html"><![CDATA[<h2 id="æ­¥éª¤">æ­¥éª¤</h2><h3 id="æ–°å»ºhello_worldå·¥ç¨‹">æ–°å»ºhello_worldå·¥ç¨‹</h3><p>ç•¥</p>
<h3 id="é…ç½®å•å…ƒæµ‹è¯•">é…ç½®å•å…ƒæµ‹è¯•</h3><p>é¦–å…ˆï¼Œç¡®è®¤åœ¨Build Variantsçª—å£å†…çš„Test Artifactä¸­é€‰æ‹©äº†â€Unit Testsâ€ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-ab4402443ad7dc5f.png" alt=""></p>
<p>ç„¶åï¼Œåœ¨å·¥ç¨‹çš„srcæ–‡ä»¶å¤¹å†…åˆ›å»ºtestå’Œtest/javaæ–‡ä»¶å¤¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ ä¸èƒ½åœ¨Androidè§†å›¾ä¸‹è¿›è¡Œè¿™äº›æ“ä½œï¼Œè¦ä¹ˆåœ¨ç³»ç»Ÿçš„æ–‡ä»¶ç®¡ç†å™¨å†…åˆ›å»ºï¼Œè¦ä¹ˆåœ¨å·¥ç¨‹çª—å£å·¦ä¸Šæ–¹ç‚¹å‡»ä¸‹æ‹‰èœå•é€‰æ‹©Projectè§†å›¾ã€‚æœ€ç»ˆçš„å·¥ç¨‹ç»“æ„åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-9e098817f6fcca44.png" alt=""></p>
<blockquote>
<p>é…ç½®æˆåŠŸä¹‹å<code>java</code>æ–‡ä»¶å¤¹çš„é¢œè‰²æ˜¯ç»¿è‰²çš„</p>
</blockquote>
<p>æœ€åï¼Œæ‰“å¼€å·¥ç¨‹çš„build.gradleï¼ˆModule:appï¼‰æ–‡ä»¶ï¼Œæ·»åŠ JUnit4ä¾èµ–ï¼Œç‚¹å‡»Gradle syncæŒ‰é’®ã€‚</p>
<p>åœ¨<code>build.gradle</code>ä¸­åŠ å…¥ä¾èµ–</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span><br><span class="line">    compile 'com.android.support:appcompat-v7:22.1.1'</span><br><span class="line">    testCompile 'junit:junit:4.12'</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="åˆ›å»ºç¬¬ä¸€ä¸ªå•å…ƒæµ‹è¯•">åˆ›å»ºç¬¬ä¸€ä¸ªå•å…ƒæµ‹è¯•</h3><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªéå¸¸ç®€å•çš„è¢«æµ‹ç±»ï¼šCalculatorç±»ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testing.testingexample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">sum</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">substract</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">divide</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">multiply</span><span class="params">(<span class="keyword">double</span> a, <span class="keyword">double</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Android Studioæä¾›äº†ä¸€ä¸ªå¿«é€Ÿåˆ›å»ºæµ‹è¯•ç±»çš„æ–¹æ³•ã€‚åªéœ€åœ¨ç¼–è¾‘å™¨å†…å³é”®ç‚¹å‡»Calculatorç±»çš„å£°æ˜ï¼Œé€‰æ‹©Go to &gt; Testï¼Œç„¶åâ€Create a new testâ€¦â€</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-729c021ff61b0dc7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>åœ¨æ‰“å¼€çš„å¯¹è¯çª—å£ä¸­ï¼Œé€‰æ‹©JUnit4å’Œâ€setUp/@Beforeâ€ï¼ŒåŒæ—¶ä¸ºæ‰€æœ‰çš„è®¡ç®—å™¨è¿ç®—ç”Ÿæˆæµ‹è¯•æ–¹æ³•ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-19f96a03d2fa811a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>è¿™æ ·ï¼Œå°±ä¼šåœ¨æ­£ç¡®çš„æ–‡ä»¶å¤¹å†…(app/src/test/java/com/example/testing/testingexample)ç”Ÿæˆæµ‹è¯•ç±»æ¡†æ¶ï¼Œåœ¨æ¡†æ¶å†…å¡«å…¥æµ‹è¯•æ–¹æ³•å³å¯ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.testing.testingexample;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Calculator mCalculator;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        mCalculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSum</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//expected: 6, sum of 1 and 5</span></span><br><span class="line">        assertEquals(<span class="number">6</span>d, mCalculator.sum(<span class="number">1</span>d, <span class="number">5</span>d), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSubstract</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">1</span>d, mCalculator.substract(<span class="number">5</span>d, <span class="number">4</span>d), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDivide</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">4</span>d, mCalculator.divide(<span class="number">20</span>d, <span class="number">5</span>d), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMultiply</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">10</span>d, mCalculator.multiply(<span class="number">2</span>d, <span class="number">5</span>d), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="è¿è¡Œå•å…ƒæµ‹è¯•">è¿è¡Œå•å…ƒæµ‹è¯•</h3><p>ç»ˆäºåˆ°è¿è¡Œæµ‹è¯•çš„æ—¶å€™äº†ï¼å³é”®ç‚¹å‡»CalculatorTestç±»ï¼Œé€‰æ‹©Run &gt; CalculatorTestã€‚ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œæµ‹è¯•ï¼Œåœ¨å·¥ç¨‹ç›®å½•å†…è¾“å…¥ï¼š</p>
<p><img src="http://upload-images.jianshu.io/upload_images/580359-00a07e968baebccc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
]]></content>
    <summary type="html">
    <![CDATA[Android Studioä¸­è¿›è¡Œå•å…ƒæµ‹è¯•]]>
    
    </summary>
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
      <category term="unit tests" scheme="http://yoursite.com/tags/unit-tests/"/>
    
      <category term="Android" scheme="http://yoursite.com/categories/Android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android è§¦æ‘¸äº‹ä»¶ä¼ é€’æœºåˆ¶]]></title>
    <link href="http://yoursite.com/2015/07/19/Android%20%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92%E6%9C%BA%E5%88%B6/"/>
    <id>http://yoursite.com/2015/07/19/Android è§¦æ‘¸äº‹ä»¶ä¼ é€’æœºåˆ¶/</id>
    <published>2015-07-19T12:12:00.000Z</published>
    <updated>2016-02-01T03:22:12.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h1 id="Android_è§¦æ‘¸äº‹ä»¶ä¼ é€’æœºåˆ¶">Android è§¦æ‘¸äº‹ä»¶ä¼ é€’æœºåˆ¶</h1><p>ä¹‹å‰åœ¨è®¾ç½®ç›‘å¬äº‹ä»¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œä»Šå¤©å‚è€ƒå­¦ä¹ äº†ä¸€äº›æ–‡æ¡£å’Œåšå®¢ï¼Œè®°å½•æ€»ç»“viewå’Œviewgroupçš„è§¦æ‘¸äº‹ä»¶ä¼ é€’<br><a id="more"></a></p>
<h2 id="View">View</h2><h3 id="å¸¸ç”¨ç›‘å¬æ–¹æ³•">å¸¸ç”¨ç›‘å¬æ–¹æ³•</h3><p>viewè¡¨ç¤ºæ²¡æœ‰å­ç©ºé—´çš„å¸ƒå±€ï¼Œä¾‹å¦‚textviewã€buttonç­‰ï¼ŒMotionEventåˆ†ä¸ºä¸‰ç§</p>
<ul>
<li>MotionEvent.ACTION_DOWNï¼šæŒ‰ä¸‹æ—¶å€™</li>
<li>MotionEvent.ACTION_MOVEï¼šæ»‘åŠ¨æ—¶</li>
<li>MotionEvent.ACTION_UPï¼šæŠ¬èµ·æ—¶</li>
</ul>
<p>å¸¸ç”¨ä¸¤ç§ç›‘å¬äº‹ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">******.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;		</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">*******.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span></span>&#123;</span><br><span class="line">				<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">	</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šsetOnTouchListenerä¸­æœ€åè¿”å›çš„æ˜¯false</p>
</blockquote>
<p>é€šå¸¸ä¸€ä¸ªæŒ‰é”®è§¦å‘çš„é¡ºåºæ˜¯ï¼š</p>
<ol>
<li>onClick-&gt;MotionEvent.ACTION_DOWN</li>
<li>onClick-&gt;MotionEvent.ACTION_UP</li>
<li>OnClickListener</li>
</ol>
<p>è‹¥åœ¨setOnTouchListenerè¿”å›trueï¼Œåˆ™ä¸ä¼šæ‰§è¡ŒOnClickListeneræ–¹æ³•</p>
<h3 id="åˆ†ææºç ">åˆ†ææºç </h3><p>åœ¨Buttonä¸­å¹¶æœªå‘ç°dispatchTouchEventä»£ç ï¼Œå‘ä¸Šå¯»æ‰¾ï¼ŒButton-&gt;TextVIew-&gt;Viewï¼Œåœ¨viewä¸­å‘ç°dispatchTouchEventå‡½æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">     * Pass the touch screen motion event down to the target view, or this</span><br><span class="line">     * view if it is the target.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> event The motion event to be dispatched.</span><br><span class="line">     * <span class="doctag">@return</span> True if the event was handled by the view, false otherwise.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// If the event should be handled by accessibility focus first.</span></span><br><span class="line">        <span class="keyword">if</span> (event.isTargetAccessibilityFocus()) &#123;</span><br><span class="line">            <span class="comment">// We don't have focus or no virtual descendant has it, do not handle the event.</span></span><br><span class="line">            <span class="keyword">if</span> (!isAccessibilityFocusedViewOrHost()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// We have focus and got the event, then use normal event dispatch.</span></span><br><span class="line">            event.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mInputEventConsistencyVerifier.onTouchEvent(event, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = event.getActionMasked();</span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Defensive cleanup for new gesture</span></span><br><span class="line">            stopNestedScroll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class="line">            <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">            ListenerInfo li = mListenerInfo;</span><br><span class="line">            <span class="keyword">if</span> (li != <span class="keyword">null</span> &amp;&amp; li.mOnTouchListener != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</span><br><span class="line">                    &amp;&amp; li.mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ if (li != null &amp;&amp; <strong>li.mOnTouchListener != null</strong>                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {</p>
<p>mOnTouchListenerå³æ³¨å†Œçš„touchç›‘å¬äº‹ä»¶ã€‚</p>
<p>å½“li.mOnTouchListener è¿”å›trueæ—¶ï¼Œresult = true</p>
<p>åœ¨onTouchEventä¸­ä¾æ¬¡è°ƒç”¨performClick()-&gt;li.mOnClickListener.onClick(this);</p>
<p>æœ€ç»ˆä¼šå›è°ƒç”¨æˆ·æ³¨å†Œçš„onclickå‡½æ•°</p>
<p>d</p>
<h3 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h3><h4 id="ä¸»Activity">ä¸»Activity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MyButton button;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button = (MyButton) findViewById(R.id.button_id);</span><br><span class="line"></span><br><span class="line">        button.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                        Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnTouchListener()-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                        Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnTouchListener()-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnClickListener()-&gt;"</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"dispatchTouchEvent()-&gt;"</span>+<span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"dispatchTouchEvent()-&gt;"</span>+ <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"onTouchEvent()-&gt;"</span>+<span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"onTouchEvent()-&gt;"</span>+ <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è‡ªå®šä¹‰Button">è‡ªå®šä¹‰Button</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/2.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyButton</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„ è¿™é‡Œç¬¬äºŒä¸ªå‚æ•°ä¸èƒ½çœç•¥ï¼Œå¦åˆ™ä¼šå¯¼è‡´å´©æºƒï¼Œä¹‹åæœ‰æ—¶é—´å­¦ä¹ ç ”ç©¶</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyButton</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"onTouchEvent-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"onTouchEvent-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"dispatchTouchEvent-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"dispatchTouchEvent-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¸ƒå±€æ–‡ä»¶">å¸ƒå±€æ–‡ä»¶</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span> <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">io.github.xuyushi.toucheventtest.MyButton</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/button_id"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"button"</span></span><br><span class="line">        <span class="attribute">android:textSize</span>=<span class="value">"30dp"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="log">log</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTestï¹• MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;OnClickListener()-&gt;</span><br></pre></td></tr></table></figure>
<h4 id="è‹¥ä¿®æ”¹MyButton_dispatchTouchEventè¿”å›å€¼ä¸ºtrueæ—¶">è‹¥ä¿®æ”¹MyButton dispatchTouchEventè¿”å›å€¼ä¸ºtrueæ—¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTestï¹• MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br></pre></td></tr></table></figure>
<p>äº‹ä»¶å…ˆç”±Activityçš„dispatchTouchEventè¿›è¡Œåˆ†å‘ï¼Œç„¶åTestButtonçš„dispatchTouchEventè¿›è¡Œåˆ†å‘ï¼Œæ¥ç€æ‰§è¡ŒonTouchç›‘å¬ï¼Œç„¶åæ‰§è¡ŒonTouchEventã€‚ç¬¬äºŒæ¬¡UPåŠ¨ä½œçš„æ—¶å€™ï¼Œåœ¨onTouchEventé‡Œåˆæ‰§è¡Œäº†onClickç›‘å¬</p>
<h4 id="è‹¥ä¿®æ”¹MyButton_onTouchEventè¿”å›å€¼ä¸ºtrueæ—¶">è‹¥ä¿®æ”¹MyButton onTouchEventè¿”å›å€¼ä¸ºtrueæ—¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTestï¹• MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTestï¹• MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨ï¼šè¿™é‡Œå’Œå‚è€ƒåšå®¢çš„ç»“æœä¸ä¸€æ ·ï¼Œå› ä¸ºåœ¨dispatchTouchEventæºç ä¸­ï¼Œè¿›è¡Œä¹‹å‰åš<strong> if (li != null &amp;&amp; </strong>li.mOnTouchListener != null<strong>                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {</strong>åˆ¤æ–­åï¼Œæ‰§è¡Œçš„æ˜¯<code>result = true;</code>å¹¶ä¸æ˜¯ <code>return true;</code> æ‰€ä»¥<code>onTouchEvent</code> ä¾ç„¶ä¼šæ‰§è¡Œ</p>
</blockquote>
<p>æ‰€ä»¥åªå°‘ä¸€ä¸ª OnClickListeneræœªæ‰§è¡Œ</p>
<h2 id="ViewGroup">ViewGroup</h2><p>ViewGroupæ¯”Viewå¤šä¸€ä¸ªonInterceptTouchEventæ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ˜¯ç”¨æ¥æ‹¦æˆªäº‹ä»¶ï¼Œæ‹¦æˆªä¹‹åViewGroupä¸­çš„å­å¸ƒå±€æ˜¯æ¥å—ä¸åˆ°äº‹ä»¶äº†ã€‚</p>
<h3 id="æºç ä¿®æ”¹">æºç ä¿®æ”¹</h3><h4 id="è‡ªå®šä¹‰å¸ƒå±€">è‡ªå®šä¹‰å¸ƒå±€</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/2.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLinearLayout</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyLinearLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"dispatchTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"dispatchTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onInterceptTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onInterceptTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸»activityå¢åŠ ç›‘å¬">ä¸»activityå¢åŠ ç›‘å¬</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mylayout.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span>(event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"setOnTouchListener()-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"setOnTouchListener()-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mylayout.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        Log.i(TAG, <span class="string">"MainActivity--mylayout-onClick..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="LOG">LOG</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;<span class="built_in">test</span>Btn---onClick</span><br><span class="line">MainActivity-&gt;OnClickListener()</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå°†Linearlayoutçš„onInterceptTouchEvent æ”¹æˆreturn true</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_UP</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">MainActivity--mylayout-onClick...</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å¯è§ï¼Œå½“onInterceptTouchEvent è¿”å›tureä¹‹åï¼Œbuttonæ¥å—ä¸åˆ°äº‹ä»¶äº†ï¼Œåªæ‰§è¡ŒMyLinearLayoutä¸­çš„OnTouch å’ŒOnClickäº†</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2><p>1ã€å¦‚æœæ˜¯è‡ªå®šä¹‰å¤åˆæ§ä»¶ï¼Œå¦‚å›¾ç‰‡+æ–‡å­—ï¼Œæˆ‘å†Activityé‡Œç»™ä½ æ³¨å†Œäº†onClickç›‘å¬ï¼ŒæœŸæœ›ç‚¹å‡»å®ƒæ‰§è¡Œã€‚é‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†å›¾ç‰‡+æ–‡å­—çš„çˆ¶å¸ƒå±€ï¼Œä¹Ÿå³è®©å…¶å®¹å™¨ViewGroupçš„ç§˜ä¹¦å°†äº‹ä»¶æ‹¦ä¸‹ï¼Œè¿™æ ·çˆ¶äº²å°±å¯ä»¥æ‰§è¡ŒonClickäº†ã€‚è¿™æ—¶å€™çš„çˆ¶äº²å°±åƒä¸€ä¸ªç‹¬ç«‹çš„å­©å­ä¸€æ ·äº†(View)ï¼Œå†ä¹Ÿä¸ç”¨ç®¡å®ƒçš„å­©å­äº†,å¯ä»¥æ­£å¸¸onClick onTouch.</p>
<p>2ã€å¦‚æœå¸Œæœ›ä¸€ä¸ªViewåªonTouchè€Œä¸onClickï¼Œåœ¨onTouché‡Œreturn trueå°±okäº†ã€‚</p>
<p>3ã€dispatchæ˜¯ä¸ºäº†onTouchç›‘å¬ï¼ŒonTouchEventæ˜¯ä¸ºäº†onClickç›‘å¬ã€‚</p>
<p>4ã€è‡ªå®šä¹‰å¸ƒå±€æ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼š</p>
<p>@Override</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onTouchEvent</span><span class="params">(event)</span></span>;}  
</code></pre><p>@Override</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">dispatchTouchEvent</span><span class="params">(event)</span></span>;

æˆ‘ä»¬å¯ä»¥å¤å†™ï¼Œä½†æ˜¯æœ€åçš„<span class="keyword">super</span>.***æ˜¯ä¸‡ä¸‡ä¸èƒ½å°‘æ»´ã€‚å¦‚æœå°‘äº†ï¼Œè¡¨ç¤ºè¿dispatch*** onTouchEventå‹æ ¹å°±ä¸è°ƒç”¨äº†ï¼Œäº‹ä»¶å°±æ­¤æ‰“ä½ã€‚
</code></pre><h2 id="å‚è€ƒ">å‚è€ƒ</h2><blockquote>
<p><a href="http://blog.csdn.net/yanzi1225627/article/details/22592831" target="_blank" rel="external">http://blog.csdn.net/yanzi1225627/article/details/22592831</a></p>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/9097463" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/9097463</a></p>
<p><a href="http://www.cnblogs.com/sunzn/archive/2013/05/10/3064129.html" target="_blank" rel="external">http://www.cnblogs.com/sunzn/archive/2013/05/10/3064129.html</a></p>
</blockquote>
<h4 id=""> </h4>]]></content>
    <summary type="html">
    <![CDATA[ä¹‹å‰åœ¨è®¾ç½®ç›‘å¬äº‹ä»¶é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œä»Šå¤©å‚è€ƒå­¦ä¹ äº†ä¸€äº›æ–‡æ¡£å’Œåšå®¢ï¼Œè®°å½•æ€»ç»“viewå’Œviewgroupçš„è§¦æ‘¸äº‹ä»¶ä¼ é€’]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="è§¦æ‘¸äº‹ä»¶" scheme="http://yoursite.com/tags/%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[volleyå­¦ä¹ ]]></title>
    <link href="http://yoursite.com/2015/07/12/volley%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2015/07/12/volleyå­¦ä¹ /</id>
    <published>2015-07-12T09:13:00.000Z</published>
    <updated>2016-02-01T02:22:33.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2><p>Vollryç‰¹åˆ«é€‚åˆæ•°æ®é‡ä¸å¤§ä½†æ˜¯é€šä¿¡é¢‘ç¹çš„åœºæ™¯ã€‚</p>
<p>æ¯”å¦‚ä»¥å‰ä»ç½‘ä¸Šä¸‹è½½å›¾ç‰‡çš„æ­¥éª¤å¯èƒ½è¿™æ ·çš„æµç¨‹ï¼š</p>
<ul>
<li>åœ¨ListAdatpter-getviewï¼ˆï¼‰æ–¹æ³•é‡Œå¼€å§‹å›¾åƒçš„è¯»å–</li>
<li>é€šè¿‡AsyncTaskç­‰æœºåˆ¶ä½¿ç”¨HttpURLConnectionä»æœåŠ¡å™¨å»è¯»å–å›¾ç‰‡èµ„æº</li>
<li>åœ¨AsyncTask-onPostExecuteï¼ˆï¼‰é‡Œè®¾ç½®ç›¸åº”çš„Imageviewçš„å±æ€§</li>
</ul>
<p>è€Œåœ¨Volleyä¸‹ï¼Œåªéœ€è¦ä¸€ä¸ªå‡½æ•°å³å¯<br><a id="more"></a></p>
<h2 id="Volleyæä¾›çš„åŠŸèƒ½ï¼š">Volleyæä¾›çš„åŠŸèƒ½ï¼š</h2><ul>
<li>JSON,å›¾åƒç­‰å¼‚æ­¥ä¸‹è½½ï¼›</li>
<li>ç½‘ç»œè¯·æ±‚çš„æ’åº</li>
<li>ç½‘ç»œè¯·æ±‚çš„ä¼˜å…ˆçº§å¤„ç†</li>
<li>ç¼“å­˜</li>
<li>å¤šçº§åˆ«å–æ¶ˆè¯·æ±‚</li>
<li>å’ŒActivityçš„ç”Ÿå‘½å‘¨æœŸçš„è”åŠ¨ï¼ˆActivityç»“æŸçš„åŒæ—¶ï¼Œå–æ¶ˆæ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼‰</li>
</ul>
<h2 id="ä¸‹è½½volley_jaråŒ…">ä¸‹è½½volley jaråŒ…</h2><h3 id="æ³•1">æ³•1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://android.googlesource.com/platform/frameworks/volley</span><br><span class="line">$ <span class="built_in">cd</span> volley</span><br><span class="line">$ android update project -p .</span><br><span class="line">$ ant jar</span><br></pre></td></tr></table></figure>
<p>å¤åˆ¶<code>bin/volley.jar</code> åˆ°å·¥ç¨‹ <code>libs/</code>ç›®å½•<br>åœ¨android studioä¸­ add as library</p>
<h3 id="æ³•2">æ³•2</h3><p>ç›´æ¥ä¸‹è½½ <a href="http://api.androidhive.info/volley/volley.jar" target="_blank" rel="external">http://api.androidhive.info/volley/volley.jar</a></p>
<h3 id="æ³•3">æ³•3</h3><p>gradleåŠ å…¥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile <span class="string">'com.mcxiaoke.volley:library:1.0.+'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>éå®˜æ–¹çš„é•œåƒ</p>
</blockquote>
<h2 id="StringRequestçš„ç”¨æ³•">StringRequestçš„ç”¨æ³•</h2><h3 id="åŠ ä¸Šç½‘ç»œæƒé™">åŠ ä¸Šç½‘ç»œæƒé™</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="è·å–RequestQueueå¯¹è±¡">è·å–RequestQueueå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestQueue mQueue = Volley.newRequestQueue(context);</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„è¿™é‡Œæ‹¿åˆ°çš„RequestQueueæ˜¯ä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç¼“å­˜æ‰€æœ‰çš„HTTPè¯·æ±‚ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•å¹¶å‘åœ°å‘å‡ºè¿™äº›è¯·æ±‚ã€‚RequestQueueå†…éƒ¨çš„è®¾è®¡å°±æ˜¯éå¸¸åˆé€‚é«˜å¹¶å‘çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªRequestQueueå¯¹è±¡ï¼Œè¿™æ˜¯éå¸¸æµªè´¹èµ„æºçš„ï¼ŒåŸºæœ¬ä¸Šåœ¨æ¯ä¸€ä¸ªéœ€è¦å’Œç½‘ç»œäº¤äº’çš„Activityä¸­åˆ›å»ºä¸€ä¸ªRequestQueueå¯¹è±¡å°±è¶³å¤Ÿäº†ã€‚</p>
<h3 id="åˆ›å»ºä¸€ä¸ªStringRequestå¯¹è±¡">åˆ›å»ºä¸€ä¸ªStringRequestå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">StringRequest stringRequest = <span class="keyword">new</span> StringRequest(<span class="string">"http://www.baidu.com"</span>,</span><br><span class="line">		<span class="keyword">new</span> Response.Listener&lt;String&gt;() &#123;</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(String response)</span> </span>&#123;</span><br><span class="line">				Log.d(<span class="string">"TAG"</span>, response);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;</span><br><span class="line">		Log.e(<span class="string">"TAG"</span>, error.getMessage(), error);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å‚æ•°1ï¼šç›®æ ‡æœåŠ¡å™¨åœ°å€<br>å‚æ•°2ï¼šå“åº”æˆåŠŸçš„å›è°ƒå‡½æ•°<br>å‚æ•°3ï¼šå“åº”åå…«çš„å›è°ƒå‡½æ•°</p>
<h3 id="å°†è¿™ä¸ªStringRequestå¯¹è±¡æ·»åŠ åˆ°RequestQueue">å°†è¿™ä¸ªStringRequestå¯¹è±¡æ·»åŠ åˆ°RequestQueue</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mQueue.add(stringRequest);</span><br></pre></td></tr></table></figure>
<h2 id="postè¯·æ±‚">postè¯·æ±‚</h2><p>Volleyä¼šå°è¯•è°ƒç”¨StringRequestçš„çˆ¶ç±»â€”â€”Requestä¸­çš„getParams()æ–¹æ³•æ¥è·å–POSTå‚æ•°,ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨StringRequestçš„åŒ¿åç±»ä¸­é‡å†™getParams()æ–¹æ³•ï¼Œåœ¨è¿™é‡Œè®¾ç½®POSTå‚æ•°å°±å¯ä»¥äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">StringRequest stringRequest = <span class="keyword">new</span> StringRequest(Method.POST, url,  listener, errorListener) &#123;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="keyword">protected</span> Map&lt;String, String&gt; getParams() <span class="keyword">throws</span> AuthFailureError &#123;  </span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();  </span><br><span class="line">        map.put(<span class="string">"params1"</span>, <span class="string">"value1"</span>);  </span><br><span class="line">        map.put(<span class="string">"params2"</span>, <span class="string">"value2"</span>);  </span><br><span class="line">        <span class="keyword">return</span> map;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="JsonRequestçš„ç”¨æ³•">JsonRequestçš„ç”¨æ³•</h2><p>JsonRequestæœ‰ä¸¤ä¸ªç›´æ¥çš„å­ç±»<br>JsonObjectRequestå’ŒJsonArrayRequestï¼Œä»åå­—ä¸Šä½ åº”è¯¥èƒ½å°±çœ‹å‡ºå®ƒä»¬çš„åŒºåˆ«äº†å§ï¼Ÿä¸€ä¸ªæ˜¯ç”¨äºè¯·æ±‚ä¸€æ®µJSONæ•°æ®çš„ï¼Œä¸€ä¸ªæ˜¯ç”¨äºè¯·æ±‚ä¸€æ®µJSONæ•°ç»„çš„</p>
<p>åŒç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">JsonObjectRequest jsonObjectRequest = <span class="keyword">new</span> JsonObjectRequest(<span class="string">"http://m.weather.com.cn/data/101010100.html"</span>, <span class="keyword">null</span>,  </span><br><span class="line">        <span class="keyword">new</span> Response.Listener&lt;JSONObject&gt;() &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(JSONObject response)</span> </span>&#123;  </span><br><span class="line">                Log.d(<span class="string">"TAG"</span>, response.toString());  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;, <span class="keyword">new</span> Response.ErrorListener() &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;  </span><br><span class="line">                Log.e(<span class="string">"TAG"</span>, error.getMessage(), error);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mQueue.add(jsonObjectRequest);</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨VolleyåŠ è½½ç½‘ç»œå›¾ç‰‡">ä½¿ç”¨VolleyåŠ è½½ç½‘ç»œå›¾ç‰‡</h2><h3 id="ImageRequestçš„ç”¨æ³•">ImageRequestçš„ç”¨æ³•</h3><h4 id="åˆ›å»ºRequestQueueå¯¹è±¡">åˆ›å»ºRequestQueueå¯¹è±¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestQueue mQueue = Volley.newRequestQueue(context);</span><br></pre></td></tr></table></figure>
<h4 id="å®ä¾‹åŒ–ImageRequestå¯¹è±¡">å®ä¾‹åŒ–ImageRequestå¯¹è±¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getImg</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">	RequestQueue mQueue = Volley.newRequestQueue(<span class="keyword">this</span>);</span><br><span class="line">	ImageRequest imageRequest = <span class="keyword">new</span> ImageRequest(</span><br><span class="line">			<span class="string">"http://avatar.csdn.net/blogpic/20140903135550859.jpg"</span>,</span><br><span class="line">			<span class="keyword">new</span> Response.Listener&lt;Bitmap&gt;() &#123;</span><br><span class="line">				<span class="annotation">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Bitmap response)</span> </span>&#123;</span><br><span class="line">					imageView.setImageBitmap(response);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;, <span class="number">0</span>, <span class="number">0</span>, Bitmap.Config.RGB_565, <span class="keyword">new</span> Response.ErrorListener() &#123;</span><br><span class="line">		<span class="annotation">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onErrorResponse</span><span class="params">(VolleyError error)</span> </span>&#123;</span><br><span class="line">			imageView.setImageResource(R.mipmap.ic_launcher);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br></pre></td></tr></table></figure>
<p>å‚æ•°1ï¼šå›¾ç‰‡åœ°å€<br>å‚æ•°2ï¼šå›è°ƒå‡½æ•°ï¼Œåœ¨æ­¤æŠŠæ¥å—çš„bitmapè®¾ç½®åˆ°imageViewä¸­<br>å‚æ•°3ï¼šå›¾ç‰‡æœ€å¤§å®½åº¦<br>å‚æ•°4ï¼šå›¾ç‰‡æœ€å¤§é«˜åº¦<br>å‚æ•°5ï¼šå›¾ç‰‡çš„é¢œè‰²ï¼ˆARGB_8888æœ€å¥½çš„é¢œè‰²ã€‚RGB_565æ¯ä¸ªåƒç´ 2å­—èŠ‚ï¼‰</p>
<h4 id="imageRequeståŠ å…¥é˜Ÿåˆ—">imageRequeståŠ å…¥é˜Ÿåˆ—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mQueue.add(imageRequest);</span><br></pre></td></tr></table></figure>
<h3 id="ImageLoaderçš„ç”¨æ³•">ImageLoaderçš„ç”¨æ³•</h3><ol>
<li>åˆ›å»ºä¸€ä¸ªRequestQueueå¯¹è±¡ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªImageLoaderå¯¹è±¡ã€‚</li>
<li>è·å–ä¸€ä¸ªImageListenerå¯¹è±¡ã€‚</li>
<li>è°ƒç”¨ImageLoaderçš„get()æ–¹æ³•åŠ è½½ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚<h4 id="æ–°å»ºä¸€ä¸ªImageLoaderå¯¹">æ–°å»ºä¸€ä¸ªImageLoaderå¯¹</h4></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(mQueue, <span class="keyword">new</span> ImageCache() &#123;  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putBitmap</span><span class="params">(String url, Bitmap bitmap)</span> </span>&#123;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getBitmap</span><span class="params">(String url)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å‚æ•°1ï¼šRequestQueue<br>å‚æ•°2ï¼šImageCacheå¯¹è±¡</p>
<h4 id="è·å–ä¸€ä¸ªImageListenerå¯¹è±¡">è·å–ä¸€ä¸ªImageListenerå¯¹è±¡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ImageListener listener = ImageLoader.getImageListener(imageView,  </span><br><span class="line">        R.drawable.default_image, R.drawable.failed_image);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡è°ƒç”¨ImageLoaderçš„getImageListener()æ–¹æ³•èƒ½å¤Ÿè·å–åˆ°ä¸€ä¸ªImageListenerå¯¹è±¡ï¼ŒgetImageListener()æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šç”¨äºæ˜¾ç¤ºå›¾ç‰‡çš„ImageViewæ§ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šåŠ è½½å›¾ç‰‡çš„è¿‡ç¨‹ä¸­æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šåŠ è½½å›¾ç‰‡å¤±è´¥çš„æƒ…å†µä¸‹æ˜¾ç¤ºçš„å›¾ç‰‡ã€‚</p>
<h4 id="è°ƒç”¨ImageLoaderçš„get()æ–¹æ³•æ¥åŠ è½½å›¾ç‰‡">è°ƒç”¨ImageLoaderçš„get()æ–¹æ³•æ¥åŠ è½½å›¾ç‰‡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageLoader.get(<span class="string">"http://img.my.csdn.net/uploads/201404/13/1397393290_5765.jpeg"</span>, listener);</span><br></pre></td></tr></table></figure>
<h4 id="cacheçš„å®ç°">cacheçš„å®ç°</h4><p>BitmapCacheå¹¶å®ç°äº†ImageCacheæ¥å£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitmapCache</span> <span class="keyword">implements</span> <span class="title">ImageCache</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> LruCache&lt;String, Bitmap&gt; mCache;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BitmapCache</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> maxSize = <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>;  </span><br><span class="line">        mCache = <span class="keyword">new</span> LruCache&lt;String, Bitmap&gt;(maxSize) &#123;  </span><br><span class="line">            <span class="annotation">@Override</span>  </span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap bitmap)</span> </span>&#123;  </span><br><span class="line">                <span class="keyword">return</span> bitmap.getRowBytes() * bitmap.getHeight();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getBitmap</span><span class="params">(String url)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> mCache.get(url);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putBitmap</span><span class="params">(String url, Bitmap bitmap)</span> </span>&#123;  </span><br><span class="line">        mCache.put(url, bitmap);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ç¼“å­˜å›¾ç‰‡çš„å¤§å°è®¾ç½®ä¸º10Mã€‚æ¥ç€ä¿®æ”¹åˆ›å»ºImageLoaderå®ä¾‹çš„ä»£ç ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥BitmapCacheçš„å®ä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageLoader imageLoader = <span class="keyword">new</span> ImageLoader(mQueue, <span class="keyword">new</span> BitmapCache());</span><br></pre></td></tr></table></figure></p>
<p>é™¤äº†ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¹‹å¤–ï¼ŒVolleyè¿˜æä¾›äº†ç¬¬ä¸‰ç§æ–¹å¼æ¥åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼Œå³ä½¿ç”¨NetworkImageViewã€‚ä¸åŒäºä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼ŒNetworkImageViewæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ§åˆ¶ï¼Œå®ƒæ˜¯ç»§æ‰¿è‡ªImageViewçš„ï¼Œå…·å¤‡ImageViewæ§ä»¶çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”åœ¨åŸç”Ÿçš„åŸºç¡€ä¹‹ä¸ŠåŠ å…¥äº†åŠ è½½ç½‘ç»œå›¾ç‰‡çš„åŠŸèƒ½ã€‚NetworkImageViewæ§ä»¶çš„ç”¨æ³•è¦æ¯”å‰ä¸¤ç§æ–¹å¼æ›´åŠ ç®€å•ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹äº”æ­¥ï¼š</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªRequestQueueå¯¹è±¡ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªImageLoaderå¯¹è±¡ã€‚</li>
<li>åœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªNetworkImageViewæ§ä»¶ã€‚</li>
<li>åœ¨ä»£ç ä¸­è·å–è¯¥æ§ä»¶çš„å®ä¾‹ã€‚</li>
<li>è®¾ç½®è¦åŠ è½½çš„å›¾ç‰‡åœ°å€ã€‚</li>
</ol>
<p>å…¶ä¸­ï¼Œç¬¬ä¸€ç¬¬äºŒæ­¥å’ŒImageLoaderçš„ç”¨æ³•æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬å°±ä»ç¬¬ä¸‰æ­¥å¼€å§‹å­¦ä¹ äº†ã€‚é¦–å…ˆä¿®æ”¹å¸ƒå±€æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œåœ¨é‡Œé¢åŠ å…¥NetworkImageViewæ§ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>  </span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span>  </span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"fill_parent"</span>  </span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> &gt;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span>  </span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/button"</span>  </span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span>  </span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span>  </span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"Send Request"</span> /&gt;</span>  </span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;<span class="title">com.android.volley.toolbox.NetworkImageView</span>   </span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/network_image_view"</span>  </span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"200dp"</span>  </span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"200dp"</span>  </span><br><span class="line">        <span class="attribute">android:layout_gravity</span>=<span class="value">"center_horizontal"</span>  </span><br><span class="line">        /&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è·å–æ§ä»¶<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">networkImageView = (NetworkImageView) findViewById(R.id.network_image_view);</span><br></pre></td></tr></table></figure></p>
<p>å¾—åˆ°äº†NetworkImageViewæ§ä»¶çš„å®ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å®ƒçš„setDefaultImageResId()æ–¹æ³•ã€setErrorImageResId()æ–¹æ³•å’ŒsetImageUrl()æ–¹æ³•æ¥åˆ†åˆ«è®¾ç½®åŠ è½½ä¸­æ˜¾ç¤ºçš„å›¾ç‰‡ï¼ŒåŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œä»¥åŠç›®æ ‡å›¾ç‰‡çš„URLåœ°å€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">networkImageView.setDefaultImageResId(R.drawable.default_image);  </span><br><span class="line">networkImageView.setErrorImageResId(R.drawable.failed_image);  </span><br><span class="line">networkImageView.setImageUrl(<span class="string">"http://img.my.csdn.net/uploads/201404/13/1397393290_5765.jpeg"</span>,  </span><br><span class="line">                imageLoader);</span><br></pre></td></tr></table></figure></p>
<p>NetworkImageViewå¹¶ä¸éœ€è¦æä¾›ä»»ä½•è®¾ç½®æœ€å¤§å®½é«˜çš„æ–¹æ³•ä¹Ÿèƒ½å¤Ÿå¯¹åŠ è½½çš„å›¾ç‰‡è¿›è¡Œå‹ç¼©ã€‚è¿™æ˜¯ç”±äºNetworkImageViewæ˜¯ä¸€ä¸ªæ§ä»¶ï¼Œåœ¨åŠ è½½å›¾ç‰‡çš„æ—¶å€™å®ƒä¼šè‡ªåŠ¨è·å–è‡ªèº«çš„å®½é«˜ï¼Œç„¶åå¯¹æ¯”ç½‘ç»œå›¾ç‰‡çš„å®½åº¦ï¼Œå†å†³å®šæ˜¯å¦éœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‹ç¼©è¿‡ç¨‹æ˜¯åœ¨å†…éƒ¨å®Œå…¨è‡ªåŠ¨åŒ–çš„ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å…³å¿ƒï¼ŒNetworkImageViewä¼šå§‹ç»ˆå‘ˆç°ç»™æˆ‘ä»¬ä¸€å¼ å¤§å°åˆšåˆšå¥½çš„ç½‘ç»œå›¾ç‰‡ï¼Œä¸ä¼šå¤šå ç”¨ä»»ä½•ä¸€ç‚¹å†…å­˜ï¼Œè¿™ä¹Ÿæ˜¯NetworkImageViewæœ€ç®€å•å¥½ç”¨çš„ä¸€ç‚¹å§ã€‚</p>
<blockquote>
<p>è½¬è‡ª ï¼š<a href="http://blog.csdn.net/guolin_blog/article/details/17482165" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/17482165</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[volley]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="volley" scheme="http://yoursite.com/tags/volley/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[listviewçš„å¤ç”¨æœºåˆ¶]]></title>
    <link href="http://yoursite.com/2015/07/09/listview%E7%9A%84%E5%A4%8D%E7%94%A8%E6%9C%BA%E5%88%B6/"/>
    <id>http://yoursite.com/2015/07/09/listviewçš„å¤ç”¨æœºåˆ¶/</id>
    <published>2015-07-09T11:12:00.000Z</published>
    <updated>2016-02-01T03:20:39.000Z</updated>
    <content type="html"><![CDATA[<h1 id="listviewçš„å¤ç”¨æœºåˆ¶">listviewçš„å¤ç”¨æœºåˆ¶</h1><p>æœ¬æ–‡ä»‹ç»äº†listviewçš„å¤ç”¨æœºåˆ¶<br><a id="more"></a></p>
<p>listview çš„itemåªä¼šåˆ›å»ºä¸€å®šæ•°é‡ï¼Œåªä¼šåˆ›å»ºçš„viewä¼šå¤ç”¨ä¹‹å‰çš„</p>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹</p>
<p>è‡ªå®šä¹‰ä¸€ä¸ªadapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/9.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">ArrayAdapter</span>&lt;<span class="title">String</span> &gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyAdapter"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> resourceId ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAdapter</span><span class="params">(Context context, <span class="keyword">int</span> textViewResourceId, List&lt;String&gt; objects)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, textViewResourceId, objects);</span><br><span class="line">        <span class="keyword">this</span>.resourceId = textViewResourceId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ViewHolder myViews;</span><br><span class="line">        String string =  getItem(position);</span><br><span class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">"ä¸ºç©ºï¼š"</span> + position);</span><br><span class="line">            myViews = <span class="keyword">new</span> ViewHolder();</span><br><span class="line">            convertView = LayoutInflater.from(getContext()).inflate(resourceId, <span class="keyword">null</span>);</span><br><span class="line">            myViews.mNameText = (TextView) convertView.findViewById(R.id.list_item);</span><br><span class="line">            convertView.setTag(myViews);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            myViews = (ViewHolder) convertView.getTag();</span><br><span class="line">            Log.d(TAG, <span class="string">"ä¸ä¸ºç©ºï¼š"</span> + position);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        myViews.mNameText.setText(string);</span><br><span class="line">        <span class="keyword">return</span> convertView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> TextView mNameText;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° éšç€listview å¾€ä¸‹æ»šåŠ¨ï¼Œæ‰“å°çš„éƒ½ä¸ºâ€ä¸ä¸ºç©ºâ€</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†</p>
<p>æ¯”å¦‚å¼‚æ­¥åŠ è½½å›¾ç‰‡ï¼Œæœ€ç»ˆé€ æˆç•Œé¢æ˜¾ç¤ºçš„æ··ä¹±</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šlistviewä¸­æœ‰ä¸€ä¸ªimageviewï¼ŒåŠ¨æ€çš„åŠ è½½ç½‘ç»œå›¾ç‰‡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span>  </span><br><span class="line">    </span>&#123;  </span><br><span class="line">        <span class="keyword">final</span> String url = getItem(position);  </span><br><span class="line">        View view;  </span><br><span class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>)  </span><br><span class="line">        &#123;  </span><br><span class="line">            view = LayoutInflater.from(getContext()).inflate(R.layout.photo_layout, <span class="keyword">null</span>);  </span><br><span class="line">        &#125; <span class="keyword">else</span>  </span><br><span class="line">        &#123;  </span><br><span class="line">            view = convertView;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">final</span> ImageView photo = (ImageView) view.findViewById(R.id.photo);  </span><br><span class="line">        <span class="comment">// ç»™ImageViewè®¾ç½®ä¸€ä¸ªTagï¼Œä¿è¯å¼‚æ­¥åŠ è½½å›¾ç‰‡æ—¶ä¸ä¼šä¹±åº  </span></span><br><span class="line">        photo.setTag(url);  </span><br><span class="line">        <span class="keyword">new</span> LoadImgTask(photo).execute(url);  </span><br><span class="line">        <span class="keyword">return</span> view;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç¬¬ä¸€é¡µçš„imageviewå¼€å¯å¼‚æ­¥çº¿ç¨‹åŠ è½½å›¾ç‰‡æ—¶å€™ï¼Œlistviewä¸‹ç¿»ï¼Œæ–°çš„itemä¼šå¤ç”¨ä¹‹å‰æ©itemï¼Œè€Œä¸”setTagä¼šè¦†ç›–ä¹‹å‰çš„tagã€‚å½“ç¬¬ä¸€å±çš„ItemViewçš„å›¾ç‰‡ä¸‹è½½å®Œæˆåï¼Œå¦‚æœç›´æ¥findViewByTagç„¶åè®¾ç½®å›¾ç‰‡ä¼šæ˜¾ç¤ºåœ¨ç¬¬äºŒå±ä¸Šï¼Œå°±æ··ä¹±äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬åœ¨æ˜¾ç¤ºå‰éƒ½ä¼šåˆ¤æ–­photo.getTag().equals(url);ç¡®å®šäº†å†æ˜¾ç¤ºã€‚ä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€å±çš„ItemViewå›¾ç‰‡ä¸‹è½½å®Œäº†ï¼Œä½†æ˜¯Tagè¢«è¦†ç›–äº†ï¼Œæ‰€ä»¥å³ä½¿ä¸‹è½½å®Œæˆäº†ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ˜¾ç¤ºã€‚è¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬é˜²æ­¢æ··ä¹±çš„ä»£ç éœ€è¦é‚£æ ·å»å†™ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[listviewçš„å¤ç”¨æœºåˆ¶]]>
    
    </summary>
    
      <category term="listview" scheme="http://yoursite.com/tags/listview/"/>
    
      <category term="view" scheme="http://yoursite.com/tags/view/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Android View å°ç»“ï¼ˆä¸Šï¼‰]]></title>
    <link href="http://yoursite.com/2015/07/09/Android%20View%20%E5%B0%8F%E7%BB%93/"/>
    <id>http://yoursite.com/2015/07/09/Android View å°ç»“/</id>
    <published>2015-07-09T11:12:00.000Z</published>
    <updated>2016-02-01T07:50:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="Android_View_å°ç»“">Android View å°ç»“</h1><p>æœ¬æ–‡ä»‹ç»äº† Android è‡ªå®šä¹‰ View çš„åŸºæœ¬æ­¥éª¤<br><a id="more"></a></p>
<h2 id="LayoutInflateråˆ†æ">LayoutInflateråˆ†æ</h2><p>åŠŸèƒ½ï¼šåŠ è½½å¸ƒå±€çš„</p>
<p>Activityä¸­è°ƒç”¨setContentView()æ–¹æ³•ä¹Ÿæ˜¯è°ƒç”¨LayoutInflater()å®ŒæˆåŠ è½½å¸ƒå±€çš„</p>
<h3 id="ä½¿ç”¨æ­¥éª¤">ä½¿ç”¨æ­¥éª¤</h3><p>-è·å–LayoutInflaterçš„å®ä¾‹</p>
<p>æ³•1:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LayoutInflater layoutInflater = LayoutInflater.from(context);</span><br></pre></td></tr></table></figure>
<p>æ³•2:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LayoutInflater layoutInflater = (LayoutInflater) context  </span><br><span class="line">        .getSystemService(Context.LAYOUT_INFLATER_SERVICE);</span><br></pre></td></tr></table></figure>
<p>-ä½¿ç”¨inflate()æ–¹æ³•åŠ è½½å¸ƒå±€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">layoutInflater.inflate(resourceId, root);</span><br></pre></td></tr></table></figure>
<p>å‚æ•°1:éœ€è¦åŠ è½½çš„å¸ƒå±€Id</p>
<p>å‚æ•°2:æ˜¯æŒ‡ç»™è¯¥å¸ƒå±€çš„å¤–éƒ¨å†åµŒå¥—ä¸€å±‚çˆ¶å¸ƒå±€ï¼Œå¦‚æœä¸éœ€è¦å°±ç›´æ¥ä¼ nullã€‚è¿™æ ·å°±æˆåŠŸæˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªå¸ƒå±€çš„å®ä¾‹ï¼Œä¹‹åå†å°†å®ƒæ·»åŠ åˆ°æŒ‡å®šçš„ä½ç½®å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p>
<h3 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h3><h4 id="å®šä¹‰ä¸€ä¸ªbutton_layout-xml">å®šä¹‰ä¸€ä¸ªbutton_layout.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">Button</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:text</span>=<span class="value">"button"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">Button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="MainActivityä¸­">MainActivityä¸­</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    LayoutInflater layoutInflater = LayoutInflater.from(<span class="keyword">this</span>);</span><br><span class="line">    mainLayout = (LinearLayout) findViewById(R.id.activity_main);</span><br><span class="line">    View buttonLayout = layoutInflater.inflate(R.layout.bytton_layout, <span class="keyword">null</span>);</span><br><span class="line">    mainLayout.addView(buttonLayout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å³å¯å°†<code>button_layout.xml</code>åŠ è½½è¿›æ¥</p>
<p>æµ‹è¯•è‹¥æƒ³è°ƒæ•´<code>button_layout.xml</code>çš„å¤§å°ï¼Œä¿®æ”¹<code>android:layout_width</code>æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œå¿…é¡»å°†button_layout.xml æ”¾å…¥ä¸€ä¸ªlayoutä¸­ï¼Œè·³è½¬layoutçš„å¤§å°æ¥ã€‚</p>
<p>è€ŒsetContentView()æ–¹æ³•ä¸­çš„å­æ§ä»¶å¯ä»¥è°ƒæ•´å¤§å°æ˜¯å› ä¸ºï¼ŒAndroidä¼šè‡ªåŠ¨åœ¨å¸ƒå±€æ–‡ä»¶çš„æœ€å¤–å±‚å†åµŒå¥—ä¸€ä¸ªFrameLayoutï¼Œæ‰€ä»¥layout_widthå’Œlayout_heightå±æ€§æ‰ä¼šæœ‰æ•ˆæœã€‚</p>
<h3 id="åˆ†ææºç ">åˆ†ææºç </h3><p>View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot):pullè§£æxml</p>
<pre><code>-<span class="ruby">&gt;<span class="constant">View</span> temp = createViewFromTag(name, attrs); æ ¹æ®èŠ‚ç‚¹åæ¥åˆ›å»º<span class="constant">View</span>å¯¹è±¡çš„
</span>
    -<span class="ruby">&gt;createView() åˆ›å»ºviewå®ä¾‹å¹¶ä¸”è¿”å›
</span>
-<span class="ruby">&gt;rInflate()å¾ªç¯éå†è¿™ä¸ªæ ¹å¸ƒå±€ä¸‹çš„å­å…ƒç´ 
</span>
    -<span class="ruby">&gt; rInflate()é€’å½’è°ƒç”¨ï¼ŒæŸ¥æ‰¾è¿™ä¸ª<span class="constant">View</span>ä¸‹çš„å­å…ƒç´ ï¼Œæ¯æ¬¡é€’å½’å®Œæˆååˆ™å°†è¿™ä¸ª<span class="constant">View</span>æ·»åŠ åˆ°çˆ¶å¸ƒå±€å½“ä¸­</span>
</code></pre><h2 id="Viewçš„ç»˜åˆ¶è¿‡ç¨‹">Viewçš„ç»˜åˆ¶è¿‡ç¨‹</h2><h3 id="onMeasure()">onMeasure()</h3><p>åŠŸèƒ½ï¼šæµ‹é‡è§†å›¾çš„å¤§å°çš„</p>
<p>Viewç³»ç»Ÿçš„ç»˜åˆ¶æµç¨‹ä¼šä»ViewRootçš„performTraversals()æ–¹æ³•ä¸­å¼€å§‹ï¼Œåœ¨å…¶å†…éƒ¨è°ƒç”¨Viewçš„measure()æ–¹æ³•ã€‚measure()æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ŒwidthMeasureSpecå’ŒheightMeasureSpecï¼Œè¿™ä¸¤ä¸ªå€¼åˆ†åˆ«ç”¨äºç¡®å®šè§†å›¾çš„å®½åº¦å’Œé«˜åº¦çš„è§„æ ¼å’Œå¤§å°ã€‚</p>
<p>MeasureSpecçš„å€¼ç”±specSizeå’ŒspecModeå…±åŒç»„æˆçš„ï¼Œå…¶ä¸­specSizeè®°å½•çš„æ˜¯å¤§å°ï¼ŒspecModeè®°å½•çš„æ˜¯è§„æ ¼ã€‚specModeä¸€å…±æœ‰ä¸‰ç§ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>-EXACTLY</p>
<p>è¡¨ç¤ºçˆ¶è§†å›¾å¸Œæœ›å­è§†å›¾çš„å¤§å°åº”è¯¥æ˜¯ç”±specSizeçš„å€¼æ¥å†³å®šçš„ï¼Œç³»ç»Ÿé»˜è®¤ä¼šæŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥è®¾ç½®å­è§†å›¾çš„å¤§å°ï¼Œå¼€å‘äººå‘˜å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾ç½®æˆä»»æ„çš„å¤§å°ã€‚</p>
<p>-AT_MOST</p>
<p>è¡¨ç¤ºå­è§†å›¾æœ€å¤šåªèƒ½æ˜¯specSizeä¸­æŒ‡å®šçš„å¤§å°ï¼Œå¼€å‘äººå‘˜åº”è¯¥å°½å¯èƒ½å°å¾—å»è®¾ç½®è¿™ä¸ªè§†å›¾ï¼Œå¹¶ä¸”ä¿è¯ä¸ä¼šè¶…è¿‡specSizeã€‚ç³»ç»Ÿé»˜è®¤ä¼šæŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥è®¾ç½®å­è§†å›¾çš„å¤§å°ï¼Œå¼€å‘äººå‘˜å½“ç„¶ä¹Ÿå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾ç½®æˆä»»æ„çš„å¤§å°ã€‚</p>
<p>-UNSPECIFIED</p>
<p>è¡¨ç¤ºå¼€å‘äººå‘˜å¯ä»¥å°†è§†å›¾æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è®¾ç½®æˆä»»æ„çš„å¤§å°ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚è¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ï¼Œä¸å¤ªä¼šç”¨åˆ°ã€‚</p>
<p>widthMeasureSpecå’ŒheightMeasureSpecä¸¤ä¸ªå€¼éƒ½æ˜¯ç”±çˆ¶è§†å›¾ç»è¿‡è®¡ç®—åä¼ é€’ç»™å­è§†å›¾çš„ï¼Œè¯´æ˜çˆ¶è§†å›¾ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå†³å®šå­è§†å›¾çš„å¤§å°</p>
<p>measure()è¿™ä¸ªæ–¹æ³•æ˜¯finalçš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•åœ¨å­ç±»ä¸­å»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè¯´æ˜Androidæ˜¯ä¸å…è®¸æˆ‘ä»¬æ”¹å˜Viewçš„measureæ¡†æ¶çš„ã€‚ç„¶ååœ¨ç¬¬9è¡Œè°ƒç”¨äº†onMeasure()æ–¹æ³•ï¼Œè¿™é‡Œæ‰æ˜¯çœŸæ­£å»æµ‹é‡å¹¶è®¾ç½®Viewå¤§å°çš„åœ°æ–¹ï¼Œé»˜è®¤ä¼šè°ƒç”¨getDefaultSize()æ–¹æ³•æ¥è·å–è§†å›¾çš„å¤§å°ï¼Œ</p>
<p>onMeasure()æ–¹æ³•æ˜¯å¯ä»¥é‡å†™çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„æµ‹é‡æ–¹å¼ï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ„æ„¿è¿›è¡Œå®šåˆ¶ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    ......  </span><br><span class="line">      </span><br><span class="line">    <span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;  </span><br><span class="line">        setMeasuredDimension(<span class="number">200</span>, <span class="number">200</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯å°±æŠŠViewé»˜è®¤çš„æµ‹é‡æµç¨‹è¦†ç›–æ‰äº†ï¼Œä¸ç®¡åœ¨å¸ƒå±€æ–‡ä»¶ä¸­å®šä¹‰MyViewè¿™ä¸ªè§†å›¾çš„å¤§å°æ˜¯å¤šå°‘ï¼Œæœ€ç»ˆåœ¨ç•Œé¢ä¸Šæ˜¾ç¤ºçš„å¤§å°éƒ½å°†ä¼šæ˜¯200*200ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨setMeasuredDimension()æ–¹æ³•è°ƒç”¨ä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½ä½¿ç”¨getMeasuredWidth()å’ŒgetMeasuredHeight()æ¥è·å–è§†å›¾æµ‹é‡å‡ºçš„å®½é«˜ï¼Œä»¥æ­¤ä¹‹å‰è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•å¾—åˆ°çš„å€¼éƒ½ä¼šæ˜¯0ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œè§†å›¾å¤§å°çš„æ§åˆ¶æ˜¯ç”±çˆ¶è§†å›¾ã€å¸ƒå±€æ–‡ä»¶ã€ä»¥åŠè§†å›¾æœ¬èº«å…±åŒå®Œæˆçš„ï¼Œçˆ¶è§†å›¾ä¼šæä¾›ç»™å­è§†å›¾å‚è€ƒçš„å¤§å°ï¼Œè€Œå¼€å‘äººå‘˜å¯ä»¥åœ¨XMLæ–‡ä»¶ä¸­æŒ‡å®šè§†å›¾çš„å¤§å°ï¼Œç„¶åè§†å›¾æœ¬èº«ä¼šå¯¹æœ€ç»ˆçš„å¤§å°è¿›è¡Œæ‹æ¿ã€‚</p>
<h3 id="onLayout()">onLayout()</h3><p>ViewRootçš„performTraversals()æ–¹æ³•ä¼šåœ¨measureç»“æŸåç»§ç»­æ‰§è¡Œï¼Œå¹¶è°ƒç”¨Viewçš„layout()æ–¹æ³•æ¥æ‰§è¡Œæ­¤è¿‡ç¨‹</p>
<p>Viewä¸­çš„onLayout()æ–¹æ³•å°±æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œå› ä¸ºonLayout()è¿‡ç¨‹æ˜¯ä¸ºäº†ç¡®å®šè§†å›¾åœ¨å¸ƒå±€ä¸­æ‰€åœ¨çš„ä½ç½®ï¼Œè€Œè¿™ä¸ªæ“ä½œåº”è¯¥æ˜¯ç”±å¸ƒå±€æ¥å®Œæˆçš„ï¼Œå³çˆ¶è§†å›¾å†³å®šå­è§†å›¾çš„æ˜¾ç¤ºä½ç½®ã€‚</p>
<h3 id="onDraw()">onDraw()</h3><p>ViewRootä¸­çš„ä»£ç ä¼šç»§ç»­æ‰§è¡Œå¹¶åˆ›å»ºå‡ºä¸€ä¸ªCanvaså¯¹è±¡ï¼Œç„¶åè°ƒç”¨Viewçš„draw()æ–¹æ³•æ¥æ‰§è¡Œå…·ä½“çš„ç»˜åˆ¶å·¥ä½œã€‚draw()æ–¹æ³•å†…éƒ¨çš„ç»˜åˆ¶è¿‡ç¨‹æ€»å…±å¯ä»¥åˆ†ä¸ºå…­æ­¥ï¼Œå…¶ä¸­ç¬¬äºŒæ­¥å’Œç¬¬äº”æ­¥åœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¾ˆå°‘ç”¨åˆ°ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬åªåˆ†æç®€åŒ–åçš„ç»˜åˆ¶è¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">if</span> (ViewDebug.TRACE_HIERARCHY) &#123;  </span><br><span class="line">        ViewDebug.trace(<span class="keyword">this</span>, ViewDebug.HierarchyTraceType.DRAW);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> privateFlags = mPrivateFlags;  </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> dirtyOpaque = (privateFlags &amp; DIRTY_MASK) == DIRTY_OPAQUE &amp;&amp;  </span><br><span class="line">            (mAttachInfo == <span class="keyword">null</span> || !mAttachInfo.mIgnoreDirtyState);  </span><br><span class="line">    mPrivateFlags = (privateFlags &amp; ~DIRTY_MASK) | DRAWN;  </span><br><span class="line">    <span class="comment">// Step 1, draw the background, if needed  </span></span><br><span class="line">    <span class="keyword">int</span> saveCount;  </span><br><span class="line">    <span class="keyword">if</span> (!dirtyOpaque) &#123;  </span><br><span class="line">        <span class="keyword">final</span> Drawable background = mBGDrawable;  </span><br><span class="line">        <span class="keyword">if</span> (background != <span class="keyword">null</span>) &#123;  </span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> scrollX = mScrollX;  </span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> scrollY = mScrollY;  </span><br><span class="line">            <span class="keyword">if</span> (mBackgroundSizeChanged) &#123;  </span><br><span class="line">                background.setBounds(<span class="number">0</span>, <span class="number">0</span>,  mRight - mLeft, mBottom - mTop);  </span><br><span class="line">                mBackgroundSizeChanged = <span class="keyword">false</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">            <span class="keyword">if</span> ((scrollX | scrollY) == <span class="number">0</span>) &#123;  </span><br><span class="line">                background.draw(canvas);  </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">                canvas.translate(scrollX, scrollY);  </span><br><span class="line">                background.draw(canvas);  </span><br><span class="line">                canvas.translate(-scrollX, -scrollY);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> viewFlags = mViewFlags;  </span><br><span class="line">    <span class="keyword">boolean</span> horizontalEdges = (viewFlags &amp; FADING_EDGE_HORIZONTAL) != <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">boolean</span> verticalEdges = (viewFlags &amp; FADING_EDGE_VERTICAL) != <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">if</span> (!verticalEdges &amp;&amp; !horizontalEdges) &#123;  </span><br><span class="line">        <span class="comment">// Step 3, draw the content  </span></span><br><span class="line">        <span class="keyword">if</span> (!dirtyOpaque) onDraw(canvas);  </span><br><span class="line">        <span class="comment">// Step 4, draw the children  </span></span><br><span class="line">        dispatchDraw(canvas);  </span><br><span class="line">        <span class="comment">// Step 6, draw decorations (scrollbars)  </span></span><br><span class="line">        onDrawScrollBars(canvas);  </span><br><span class="line">        <span class="comment">// we're done...  </span></span><br><span class="line">        <span class="keyword">return</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="è§†å›¾é‡ç»˜">è§†å›¾é‡ç»˜</h2><p>è°ƒç”¨è§†å›¾çš„setVisibility()ã€setEnabled()ã€setSelected()ç­‰æ–¹æ³•æ—¶éƒ½ä¼šå¯¼è‡´è§†å›¾é‡ç»˜ï¼Œè€Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ‰‹åŠ¨åœ°å¼ºåˆ¶è®©è§†å›¾è¿›è¡Œé‡ç»˜ï¼Œå¯ä»¥è°ƒç”¨invalidate()æ–¹æ³•æ¥å®ç°</p>
<p>-&gt; invalidate()</p>
<pre><code>-&gt;skipInvalidate<span class="literal">()</span>åˆ¤æ–­æ˜¯å¦è®¸é‡ç»˜

-&gt; invalidateChild<span class="literal">()</span>

    -&gt; invalidateChildInParent<span class="literal">()</span>

        -&gt; invalidateChild<span class="literal">()</span>

            -&gt; scheduleTraversals<span class="literal">()</span>

                -&gt; sendEmptyMessage(<span class="type">DO_TRAVERSAL</span>); 

                    handler æ¥å—

                    - &gt; performTraversals<span class="literal">()</span> [onmeasureçš„å…¥å£]

    ä¸æ–­åœ°è·å–å½“å‰å¸ƒå±€çš„çˆ¶å¸ƒå±€ï¼Œå¹¶è°ƒç”¨å®ƒçš„invalidateChildInParent<span class="literal">()</span>æ–¹æ³•ï¼Œå½“å¾ªç¯åˆ°æœ€å¤–å±‚çš„æ ¹å¸ƒå±€åï¼Œå°±ä¼šè°ƒç”¨<span class="type">ViewRoot</span>çš„invalidateChildInParent<span class="literal">()</span>æ–¹æ³•äº†ï¼Œä»…ä»…æ˜¯å»è°ƒç”¨äº†invalidateChild<span class="literal">()</span>æ–¹æ³•è€Œ
</code></pre>]]></content>
    <summary type="html">
    <![CDATA[Android View å°ç»“]]>
    
    </summary>
    
      <category term="git" scheme="http://yoursite.com/tags/git/"/>
    
      <category term="view" scheme="http://yoursite.com/tags/view/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[wifiå‹åŠ›æµ‹è¯•]]></title>
    <link href="http://yoursite.com/2015/07/09/wifi%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/"/>
    <id>http://yoursite.com/2015/07/09/wifiå‹åŠ›æµ‹è¯•/</id>
    <published>2015-07-09T11:12:00.000Z</published>
    <updated>2016-02-01T02:22:39.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h2 id="æ•ˆæœå›¾">æ•ˆæœå›¾</h2><p><img src="https://raw.githubusercontent.com/xuyushi/Blog_img/master/wifitest.gif" alt="æ•ˆæœå›¾"></p>
<p>å¼€å…³wifi<br>å¹¶ä¸”åœ¨å¼€wifiåï¼Œåˆ¤æ–­ç½‘ç»œè¿æ¥<br>ç”±äºå­˜åœ¨wifiè¿æ¥ä¹‹åå¹¶æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µï¼Œæ‰€ä»¥é‡‡ç”¨ping æ¥åˆ¤æ–­ç½‘ç»œçš„é€šæ–­<br><a id="more"></a></p>
<h2 id="AndroidManifestä¸­ç”³è¯·æƒé™">AndroidManifestä¸­ç”³è¯·æƒé™</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.ACCESS_WIFI_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.CHANGE_WIFI_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.CHANGE_NETWORK_STATE"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.WAKE_LOCK"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.WRITE_SETTINGS"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ§ä»¶ï¼Œç•Œé¢åˆå§‹åŒ–">æ§ä»¶ï¼Œç•Œé¢åˆå§‹åŒ–</h2><p>  è¯¦è§æºç </p>
<h2 id="å¾ªç¯ä»»åŠ¡">å¾ªç¯ä»»åŠ¡</h2><p>ä½¿ç”¨timeræ¥å®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startTest</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">       isRunning = <span class="keyword">true</span>;</span><br><span class="line">       mTimer = <span class="keyword">new</span> Timer();</span><br><span class="line">       mTimer.schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">           <span class="annotation">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">               <span class="keyword">if</span> (!isRunning || (mMaxTestCount != <span class="number">0</span> &amp;&amp; mCurrentCount &gt;= mMaxTestCount)) &#123;</span><br><span class="line">                   mHandler.sendEmptyMessage(<span class="number">0</span>);</span><br><span class="line">                   mTimer.cancel();</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">if</span> (mWifiManager.getWifiState() == mWifiManager.WIFI_STATE_DISABLED) &#123;</span><br><span class="line">                       mWifiManager.setWifiEnabled(<span class="keyword">true</span>);</span><br><span class="line">                       Log.d(TAG, <span class="string">"*********wifistate is closed, try open wifi now!*****"</span>);</span><br><span class="line">                   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mWifiManager.getWifiState() == mWifiManager.WIFI_STATE_ENABLED) &#123;</span><br><span class="line">                       pingIpAddr();</span><br><span class="line">                       <span class="keyword">if</span> (<span class="keyword">null</span> != mPingIpAddrResult) &#123;</span><br><span class="line">                           Log.d(TAG, mPingIpAddrResult);</span><br><span class="line">                       &#125;</span><br><span class="line">                       mWifiManager.setWifiEnabled(<span class="keyword">false</span>);</span><br><span class="line">                       Log.d(TAG, <span class="string">"*********wifistate is opened, try close wifi now!******"</span>);</span><br><span class="line">                       incCurCount();</span><br><span class="line">                   &#125;</span><br><span class="line">                   mHandler.sendEmptyMessage(<span class="number">1</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, <span class="number">2000</span>, <span class="number">10000</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>åˆ¤æ–­ isRunning æ ‡å¿—ä½ï¼Œ</p>
<ul>
<li>å¦‚æœä¸ºï¼isRunning ï¼Œæˆ–è€…ä»»åŠ¡çš„æ¬¡æ•°æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™å–æ¶ˆå®šæ—¶ä»»åŠ¡ã€‚å¹¶ä¸”å‘é€message(0)</li>
<li>å¦‚æœä¸ºï¼isRunningï¼Œåˆ‡æ¢wifiçš„çŠ¶æ€ï¼Œå¹¶åœ¨wifiå¼€çš„é€‚åˆåˆ¤æ–­ç½‘ç»œè¿æ¥ï¼Œå¹¶ä¸”å‘é€messageï¼ˆ1ï¼‰</li>
</ul>
<h3 id="åˆ¤æ–­ç½‘ç»œé€šæ–­ä»£ç ">åˆ¤æ–­ç½‘ç»œé€šæ–­ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pingIpAddr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span>: Hardcoded for now, make it UI configurable</span></span><br><span class="line">            Process p = Runtime.getRuntime().exec(<span class="string">"ping -c 1 -w 7 "</span> + mIpAddress);</span><br><span class="line">            <span class="keyword">int</span> status = p.waitFor();</span><br><span class="line">            <span class="keyword">if</span> (status == <span class="number">0</span>) &#123;</span><br><span class="line">                mPingIpAddrResult = <span class="string">"Pass"</span>;</span><br><span class="line">                mPassCount++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mPingIpAddrResult = <span class="string">"Fail: IP addr not reachable"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            mPingIpAddrResult = <span class="string">"Fail: IOException"</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            mPingIpAddrResult = <span class="string">"Fail: InterruptedException"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>Runtime.getRuntime().exec</code>æ¥æ‰§è¡Œå‘½ä»¤è¡Œ<br><code>status = p.waitFor();</code>æ¥è·å–è¿è¡Œç»“æœã€‚</p>
<blockquote>
<p>p.waitForä¼šé˜»å¡</p>
</blockquote>
<h2 id="è‡ªå®šä¹‰handleå¤„ç†æ¶ˆæ¯">è‡ªå®šä¹‰handleå¤„ç†æ¶ˆæ¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler() &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(android.os.Message msg)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                  isRunning = <span class="keyword">false</span>;</span><br><span class="line">                  <span class="keyword">if</span> (mTimer != <span class="keyword">null</span>)</span><br><span class="line">                      mTimer.cancel();</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                  currentCount.setText(getString(R.string.current_count) + mCurrentCount);</span><br><span class="line">                  passCount.setText(getString(R.string.pass_count) + mPassCount);</span><br><span class="line">                  Log.d(TAG, <span class="string">"already test time:"</span> + mCurrentCount);</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">default</span>:</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>æºç ï¼š<a href="https://github.com/xuyushi/WifiTest" target="_blank" rel="external">https://github.com/xuyushi/WifiTest</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>[TOC]</p>
<h2 id="æ•ˆæœå›¾">æ•ˆæœå›¾</h2><p><img src="https://raw.githubusercontent.com/xuyushi/Blog_img/master/wifitest.gif" alt="æ•ˆæœå›¾"></p>
<p>å¼€å…³wifi<br>å¹¶ä¸”åœ¨å¼€wifiåï¼Œåˆ¤æ–­ç½‘ç»œè¿æ¥<br>ç”±äºå­˜åœ¨wifiè¿æ¥ä¹‹åå¹¶æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µï¼Œæ‰€ä»¥é‡‡ç”¨ping æ¥åˆ¤æ–­ç½‘ç»œçš„é€šæ–­<br>]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="wifi" scheme="http://yoursite.com/tags/wifi/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[loader æ€»ç»“]]></title>
    <link href="http://yoursite.com/2015/07/05/loader%20%E6%80%BB%E7%BB%93/"/>
    <id>http://yoursite.com/2015/07/05/loader æ€»ç»“/</id>
    <published>2015-07-05T07:57:00.000Z</published>
    <updated>2016-02-01T02:23:29.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h2 id="æœ¬æ–‡å®ç°çš„åŠŸèƒ½">æœ¬æ–‡å®ç°çš„åŠŸèƒ½</h2><p>åœ¨listfragmentä½¿ç”¨è‡ªå®šä¹‰çš„adpterç°å®æ•°æ®åº“çš„æ•°æ®ï¼Œå½“æ•°æ®åº“çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨åˆ·æ–°</p>
<p>æ•ˆæœå¦‚ä¸‹<br><img src="https://raw.githubusercontent.com/xuyushi/Blog_img/master/loader1.gif" alt="loader"><br><a id="more"></a></p>
<h2 id="ç”¨åˆ°çš„çŸ¥è¯†ç‚¹">ç”¨åˆ°çš„çŸ¥è¯†ç‚¹</h2><ol>
<li>listfragment</li>
<li><a href="http://xuyushi.github.io/2015/06/29/GreenDaoå­¦ä¹ /" target="_blank" rel="external">GreenDao</a></li>
<li>è‡ªå®šä¹‰loader</li>
<li>è‡ªå®šä¹‰adapter</li>
<li>loaderManger</li>
<li>contentobserverç›‘å¬æ•°æ®åº“</li>
</ol>
<h2 id="å®ç°è¿‡ç¨‹">å®ç°è¿‡ç¨‹</h2><h3 id="æ•°æ®åº“çš„ç®€å†">æ•°æ®åº“çš„ç®€å†</h3><p>ä¸åšè¿‡å¤šåˆ†æï¼Œè¯¦è§<a href="http://xuyushi.github.io/2015/06/29/GreenDaoå­¦ä¹ /" target="_blank" rel="external">GreenDao</a><br>å»ºç«‹äº†studentè¡¨ï¼ŒåŒ…æ‹¬</p>
<ol>
<li>id</li>
<li>name</li>
<li>age</li>
</ol>
<p>åœ¨DBHleperä¸­å®ç°äº†ä»¥ä¸‹å¢åŠ ï¼Œåˆ é™¤çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addToStudentTable</span><span class="params">(de.greenrobot.daoexample.Student student)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == Student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Student.insert(student);</span><br><span class="line">    <span class="keyword">if</span> (mObserver!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        mObserver.onChange(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Student.loadAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Student.deleteAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨MainActivityçš„onCreatæ–¹æ³•åˆå§‹åŒ–æ•°æ®åº“<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    DBHelper.getInstance(<span class="keyword">this</span>).clearStudent();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i &lt; STUDENT_NUM;i++) &#123;</span><br><span class="line">        student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setName(<span class="string">"testname"</span>+i);</span><br><span class="line">        student.setAge(<span class="number">10</span>+i);</span><br><span class="line">        DBHelper.getInstance(<span class="keyword">this</span>).addToStudentTable(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨ä¸»ç•Œé¢ä¸­å¢åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç”¨æ¥å¢åŠ æ•°æ®åº“ï¼Œç”¨æ¥è§‚æµ‹loaderæ˜¯å¦åˆ·æ–°List<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add_sth</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">    student = <span class="keyword">new</span> Student();</span><br><span class="line">    student.setName(<span class="string">"createdByButton"</span>);</span><br><span class="line">    student.setAge(<span class="number">100</span>);</span><br><span class="line">    DBHelper.getInstance(<span class="keyword">this</span>).addToStudentTable(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="å®ç°è‡ªå®šä¹‰adapter">å®ç°è‡ªå®šä¹‰adapter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mresourceId; <span class="comment">//å¯¹åº”çš„xmlå¸ƒå±€æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ä¼ å‡ºæ¥ï¼Œåœ¨getViewä¸­å†™æ­»ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> Context mcontext;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; mdata;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentAdapter</span><span class="params">(Context context, <span class="keyword">int</span> resourceId, List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        mresourceId = resourceId;</span><br><span class="line">        mcontext = context;</span><br><span class="line">        mdata = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mdata.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mdata.get(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//convertViewç”¨äºå°†ä¹‹å‰åŠ è½½å¥½çš„viewç¼“å­˜</span></span><br><span class="line">        ViewHolder holder = <span class="keyword">null</span>;</span><br><span class="line">        View view;</span><br><span class="line">        Student student = (Student) getItem(position);</span><br><span class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</span><br><span class="line">            holder = <span class="keyword">new</span> ViewHolder();</span><br><span class="line"></span><br><span class="line">            view = LayoutInflater.from(mcontext).inflate(mresourceId, <span class="keyword">null</span>);</span><br><span class="line">            holder.id = (TextView) view.findViewById(R.id.id);</span><br><span class="line">            holder.name = (TextView) view.findViewById(R.id.name);</span><br><span class="line">            holder.age = (TextView) view.findViewById(R.id.age);</span><br><span class="line">            view.setTag(holder);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            view = convertView;</span><br><span class="line">            holder = (ViewHolder) view.getTag();</span><br><span class="line">        &#125;</span><br><span class="line">        holder.id.setText(<span class="string">"id"</span> + student.getId().toString());</span><br><span class="line">        holder.name.setText(<span class="string">"name"</span> + student.getName());</span><br><span class="line">        holder.age.setText(<span class="string">"age"</span> + student.getAge());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        TextView id;</span><br><span class="line">        TextView name;</span><br><span class="line">        TextView age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨holderå¯ä»¥å¤§å¤§åŠ å¿«ç¨‹åºæ•ˆç‡ï¼Œé¿å…é‡å¤åŠ è½½ã€‚</p>
<h3 id="è‡ªå®šä¹‰loader">è‡ªå®šä¹‰loader</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xuyushi.loadertest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.AsyncTaskLoader;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.support.v4.content.Loader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.greenrobot.DBHelper;</span><br><span class="line"><span class="keyword">import</span> de.greenrobot.daoexample.Student;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/7/5.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentLoader</span> <span class="keyword">extends</span> <span class="title">AsyncTaskLoader</span>&lt;<span class="title">List</span>&lt;<span class="title">Student</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; mdata;</span><br><span class="line">    <span class="keyword">final</span> ForceLoadContentObserver mObserver ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentLoader</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        mObserver = <span class="keyword">new</span> ForceLoadContentObserver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">loadInBackground</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            mdata =  DBHelper.getInstance(getContext()).getStudent();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mdata;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliverResult</span><span class="params">(List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        mdata = data;</span><br><span class="line">        <span class="keyword">if</span> (isStarted()) &#123;</span><br><span class="line">            <span class="keyword">super</span>.deliverResult(data);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStartLoading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStartLoading();</span><br><span class="line">        <span class="keyword">if</span> (mdata != <span class="keyword">null</span>) &#123;</span><br><span class="line">            deliverResult(mdata);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mdata == <span class="keyword">null</span>) &#123;</span><br><span class="line">            forceLoad();</span><br><span class="line">        &#125;</span><br><span class="line">        DBHelper.getInstance(getContext()).registerObserver(mObserver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCanceled</span><span class="params">(List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCanceled(data);</span><br><span class="line">        cancelLoad();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onReset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onReset();</span><br><span class="line">        onStopLoading();</span><br><span class="line">        <span class="keyword">if</span> (mdata != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾èµ„æº</span></span><br><span class="line">            mdata = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>onStartLoadingï¼šæ³¨å†Œä¸€äº›ç›‘å¬å™¨åˆ°loaderä¸Šï¼Œå¹¶ä¸”æ‰§è¡Œä¸€æ¬¡forceLoad(); å¦åˆ™loaderä¸ä¼šå¼€å§‹å·¥ä½œ</li>
<li>loadInBackgroundï¼šåŠ è½½æ•°æ®å¹¶ä¸”è¿”å›ï¼Œå…¶å®è¿™ä¸ªæ•°æ®å°±è¿”å›åˆ°äº†å›è°ƒå‡½æ•°ä¸­LoaderManagerçš„onLoadFinishedæ–¹æ³•ç¬¬äºŒä¸ªdataå‚æ•°</li>
<li>onStopLoadingï¼šåœæ­¢åŠ è½½æ•°æ®ï¼Œä½†ä¸è¦åœæ­¢ç›‘å¬ä¹Ÿä¸è¦é‡Šæ”¾æ•°æ®ï¼Œå°±å¯ä»¥éšæ—¶é‡å¯loader</li>
<li>onResetï¼šå…ˆç¡®ä¿å·²ç»åœæ­¢åŠ è½½æ•°æ®äº†ï¼Œç„¶åé‡Šæ”¾æ‰ç›‘å¬å™¨å¹¶è®¾ä¸ºnull</li>
<li>onCanceledï¼š åœ¨è¿™é‡Œå¯ä»¥é‡Šæ”¾èµ„æºï¼Œå¦‚æœæ˜¯listå°±ä¸éœ€è¦åšä»€ä¹ˆäº†ï¼Œä½†æ˜¯è±¡cursoræˆ–è€…æ‰“å¼€äº†ä»€ä¹ˆæ–‡ä»¶å°±åº”è¯¥å…³é—­ä¸€ä¸‹</li>
</ul>
<h3 id="fragment">fragment</h3><p>ç»§æ‰¿fragmentlist ï¼Œå¹¶å®ç° LoaderManager.LoaderCallbacksæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/7/5.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fragment1</span> <span class="keyword">extends</span> <span class="title">ListFragment</span> <span class="keyword">implements</span></span><br><span class="line">        <span class="title">LoaderManager</span>.<span class="title">LoaderCallbacks</span>&lt;<span class="title">List</span>&lt;<span class="title">Student</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StudentAdapter mAdapter;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; mStudents;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater,</span><br><span class="line">                             ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> inflater.inflate(R.layout.fragment1, container, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="comment">//åœ¨fragmentä¸­è·å–contextçš„æ–¹æ³•getActivity().getApplicationContext()</span></span><br><span class="line">        <span class="comment">//è®¾ç½®listçš„Adapter</span></span><br><span class="line"><span class="comment">//        setListAdapter(new StudentAdapter(getActivity().getApplicationContext(),</span></span><br><span class="line"><span class="comment">//                R.layout.student_adpter,</span></span><br><span class="line"><span class="comment">//                DBHelper.getInstance(getActivity().getApplicationContext()).getStudent()));</span></span><br><span class="line">        mStudents = DBHelper.getInstance(getActivity().getApplicationContext()).getStudent();</span><br><span class="line">        mAdapter = <span class="keyword">new</span> StudentAdapter(getActivity().getApplicationContext(),</span><br><span class="line">                R.layout.student_adpter,</span><br><span class="line">                mStudents);</span><br><span class="line">        setListAdapter(mAdapter);</span><br><span class="line">        getLoaderManager().initLoader(<span class="number">2</span>, <span class="keyword">null</span>, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onListItemClick</span><span class="params">(ListView parent, View v,</span><br><span class="line">                                <span class="keyword">int</span> position, <span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Toast.makeText(getActivity(),</span></span><br><span class="line"><span class="comment">//                "You have selected " + presidents[position],</span></span><br><span class="line"><span class="comment">//                Toast.LENGTH_SHORT).show();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Loader&lt;List&lt;Student&gt;&gt; onCreateLoader(<span class="keyword">int</span> id, Bundle args) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StudentLoader(getActivity().getApplicationContext());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadFinished</span><span class="params">(Loader&lt;List&lt;Student&gt;&gt; loader, List&lt;Student&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mAdapter) &#123;</span><br><span class="line">            mStudents.clear();</span><br><span class="line">            mStudents.addAll(DBHelper.getInstance(getActivity().getApplicationContext()).getStudent());</span><br><span class="line">            mAdapter.notifyDataSetChanged();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoaderReset</span><span class="params">(Loader&lt;List&lt;Student&gt;&gt; loader)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>onLoadFinished:ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³loaderåœ¨doinbackfroundçš„è¿”å›å€¼</li>
</ul>
<blockquote>
<p>æ³¨ï¼šåœ¨è°ƒè¯•ä¸­å‘ç°è™½ç„¶ mStudents çš„æ•°æ®åˆ·æ–°äº†ï¼Œä½†æ˜¯ç›´æ¥è°ƒç”¨ mAdapter.notifyDataSetChanged();å¹¶ä¸èƒ½åˆ·æ–°ç•Œé¢ã€‚<br>åŸå› æ˜¯:mAdapterä¼šé€šè¿‡mStudentsè·å–æ•°æ®åº“ä¸­çš„å†…å®¹ã€‚ä½†æ˜¯å®é™…ä¸Šå¯èƒ½æ˜¯ï¼Œåœ¨è°ƒç”¨super(MyActivity.this, R.layout.item, usersList)æ—¶mAdapterä¿å­˜äº†æŒ‡å‘åŸæ•°æ®åº“çš„å¼•ç”¨ï¼Œåœ¨è°ƒç”¨queryå‡½æ•°ä¹‹åï¼ŒmstudentæŒ‡å‘äº†ä¸€ä¸ªæ–°çš„Listï¼ˆList bï¼‰ã€‚ä½†æ˜¯åœ¨è°ƒç”¨notifyDataSetChanged()æ—¶ï¼ŒmAdapterä¼šè·Ÿæ®ä¿å­˜çš„å¼•ç”¨ï¼ˆå³æŒ‡å‘List açš„å¼•ç”¨ï¼‰å»æ›´æ–°ï¼Œå› æ­¤å½“ç„¶è¿˜æ˜¯åŸæ¥çš„ç»“æœï¼Œä¸ä¼šè¿›è¡Œæ›´æ–°ã€‚</p>
</blockquote>
<p>æ‰€ä»¥æœ‰ä»¥ä¸‹ä¿®æ”¹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mStudents.clear();           mStudents.addAll(DBHelper.getInstance(getActivity().getApplicationContext()).getStudent());</span><br><span class="line">            mAdapter.notifyDataSetChanged();</span><br></pre></td></tr></table></figure></p>
<h3 id="contentobserverç›‘å¬æ•°æ®åº“">contentobserverç›‘å¬æ•°æ®åº“</h3><p>é€šè¿‡contentobserverå¯ä»¥å®æ—¶çš„æ›´æ–°æ•°æ®åº“ä¸­çš„ä¿¡æ¯ï¼Œæ— éœ€å»è½®è¯¢ã€‚</p>
<h4 id="åœ¨StudentLoaderä¸­æ³¨å†Œcontentobserver">åœ¨StudentLoaderä¸­æ³¨å†Œcontentobserver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStartLoading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onStartLoading();</span><br><span class="line">    <span class="keyword">if</span> (mdata != <span class="keyword">null</span>) &#123;</span><br><span class="line">        deliverResult(mdata);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mdata == <span class="keyword">null</span>) &#123;</span><br><span class="line">        forceLoad();</span><br><span class="line">    &#125;</span><br><span class="line">    DBHelper.getInstance(getContext()).registerObserver(mObserver);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="DBHelperä¸­">DBHelperä¸­</h4><h5 id="å®šä¹‰mObserver">å®šä¹‰mObserver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Loader.ForceLoadContentObserver mObserver;</span><br></pre></td></tr></table></figure>
<h5 id="å®ç°æ³¨å†Œå‡½æ•°registerObserver">å®ç°æ³¨å†Œå‡½æ•°registerObserver</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerObserver</span><span class="params">(Loader&lt;List&lt;Student&gt;&gt;.ForceLoadContentObserver Observer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mObserver = Observer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å³æŠŠå˜é‡å–å‡º</p>
<h5 id="åœ¨æ•°æ®åº“æ”¹å˜çš„åœ°æ–¹å‘å‡ºé€šçŸ¥">åœ¨æ•°æ®åº“æ”¹å˜çš„åœ°æ–¹å‘å‡ºé€šçŸ¥</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addToStudentTable</span><span class="params">(de.greenrobot.daoexample.Student student)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == Student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">null</span> == student) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Student.insert(student);</span><br><span class="line">    <span class="keyword">if</span> (mObserver!=<span class="keyword">null</span>) &#123;</span><br><span class="line">        mObserver.onChange(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>mObserver.onChange(true);</code>å‘å‡ºé€šçŸ¥</p>
]]></content>
    <summary type="html">
    <![CDATA[åœ¨listfragmentä½¿ç”¨è‡ªå®šä¹‰çš„adpterç°å®æ•°æ®åº“çš„æ•°æ®ï¼Œå½“æ•°æ®åº“çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè‡ªåŠ¨åˆ·æ–°]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="greendao" scheme="http://yoursite.com/tags/greendao/"/>
    
      <category term="loader" scheme="http://yoursite.com/tags/loader/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹android sqliteæ•°æ®åº“]]></title>
    <link href="http://yoursite.com/2015/07/05/%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9F%A5%E7%9C%8Bandroid%20sqlite%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>http://yoursite.com/2015/07/05/ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹android sqliteæ•°æ®åº“/</id>
    <published>2015-07-05T01:33:00.000Z</published>
    <updated>2016-02-01T02:23:15.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<p>è®°å½•å¦‚ä½•ä½¿ç”¨å‘½ä»¤è¡Œå¿«é€ŸæŸ¥çœ‹æ•°æ®åº“<br><a id="more"></a></p>
<h2 id="é¦–å…ˆadb_shellè¿æ¥è™šæ‹Ÿæœºæˆ–è€…è®¾å¤‡">é¦–å…ˆadb shellè¿æ¥è™šæ‹Ÿæœºæˆ–è€…è®¾å¤‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell</span><br></pre></td></tr></table></figure>
<h2 id="è¿›å…¥æ•°æ®åº“ç›®å½•">è¿›å…¥æ•°æ®åº“ç›®å½•</h2><p>é€šå¸¸åœ¨/data/data/åŒ…å/databases ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /data/data/com.example.xuyushi.loadertest/databases</span><br></pre></td></tr></table></figure></p>
<h2 id="è¿›å…¥æ•°æ®åº“">è¿›å…¥æ•°æ®åº“</h2><p>ä½¿ç”¨sqlite3 è¿›å…¥ï¼Œéœ€è¦å®‰è£…å·¥å…·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite3 xxxx</span><br></pre></td></tr></table></figure></p>
<p>æç¤º<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQLite version <span class="number">3.7</span>.<span class="number">11</span> <span class="number">2012</span>-<span class="number">03</span>-<span class="number">20</span> <span class="number">11</span>:<span class="number">35</span>:<span class="number">50</span></span><br><span class="line">Enter <span class="string">".help"</span> <span class="keyword">for</span> instructions</span><br><span class="line">Enter SQL statements terminated with a <span class="string">";"</span></span><br><span class="line">sqlite&gt;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨<code>.help</code>å¯ä»¥æŸ¥çœ‹å¸®åŠ©</p>
<h2 id="ä½¿ç”¨-tableæŸ¥çœ‹å·²å»ºçš„è¡¨æ ¼">ä½¿ç”¨.tableæŸ¥çœ‹å·²å»ºçš„è¡¨æ ¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ .table</span><br></pre></td></tr></table></figure>
<p>æç¤º<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; .table</span><br><span class="line">STUDENT           android_metadata</span><br></pre></td></tr></table></figure></p>
<h2 id="ä½¿ç”¨SELECTæŸ¥çœ‹è¡¨å†…å®¹">ä½¿ç”¨SELECTæŸ¥çœ‹è¡¨å†…å®¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ SELECT * FROM STUDENT;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„æœ‰åˆ†å·</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sqlite&gt; SELECT * FROM STUDENT;</span><br><span class="line"><span class="number">1</span>|zhangsan|<span class="number">22</span></span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹android sqliteæ•°æ®åº“]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="greendao" scheme="http://yoursite.com/tags/greendao/"/>
    
      <category term="sqlite" scheme="http://yoursite.com/tags/sqlite/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[è“ç‰™å­¦ä¹ ]]></title>
    <link href="http://yoursite.com/2015/07/01/%E8%93%9D%E7%89%99%E5%AD%A6%E4%B9%A0/"/>
    <id>http://yoursite.com/2015/07/01/è“ç‰™å­¦ä¹ /</id>
    <published>2015-07-01T11:16:00.000Z</published>
    <updated>2016-02-01T02:23:37.000Z</updated>
    <content type="html"><![CDATA[<p>[TOC]</p>
<h2 id="æƒé™">æƒé™</h2><p>æœ‰ä¸¤ç§æƒé™ï¼Œè‡³å°‘éœ€è¦ä¸€ç§æƒé™</p>
<ol>
<li><code>BLUETOOTH</code>:æ‰§è¡Œä»»ä½•è“ç‰™é€šä¿¡ï¼Œä¾‹å¦‚è¯·æ±‚ä¸€ä¸ªè¿æ¥ã€æ¥å—ä¸€ä¸ªè¿æ¥ä»¥åŠä¼ è¾“æ•°æ®</li>
<li><code>BLUETOOTH_ADMIN</code>ï¼šåˆå§‹åŒ–è®¾å¤‡æŸ¥æ‰¾æˆ–æ§åˆ¶è“ç‰™è®¾ç½®</li>
</ol>
<blockquote>
<p>å¦‚æœä½ ä½¿ç”¨BLUETOOTH_ADMINæƒé™ï¼Œé‚£ä¹ˆå¿…é¡»æ‹¥æœ‰BLUETOOTHæƒé™ã€‚<br> <a id="more"></a></p>
</blockquote>
<p>åœ¨manifestæ–‡ä»¶ä¸­å£°æ˜æƒé™<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">...</span> &gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.BLUETOOTH"</span> /&gt;</span>    </span><br><span class="line">    ...  </span><br><span class="line"><span class="tag">&lt;/<span class="title">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="è®¾ç½®è“ç‰™">è®¾ç½®è“ç‰™</h2><p>åœ¨ä½¿ç”¨è“ç‰™å’Œå…¶ä»–è®¾å¤‡é€šä¿¡ä¹‹å‰ï¼Œè¦ç¡®ä¿æœ¬åœ°è®¾å¤‡æ”¯æŒè“ç‰™ï¼Œå¹¶å¤„äºæ‰“å¼€çš„çŠ¶æ€ã€‚</p>
<h3 id="è·å–BluetoothAdapter">è·å–BluetoothAdapter</h3><p> ä½¿ç”¨getDefaultAdapteræ–¹æ³•æ¥è·å–ï¼Œå¦‚æœè·å–çš„ä¸ºnullåˆ™è¡¨ç¤ºè®¾å¤‡ä¸æ”¯æŒè“ç‰™ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();</span><br><span class="line"><span class="keyword">if</span> (mBluetoothAdapter == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// Device does not support Bluetooth</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="å¼€å¯è“ç‰™">å¼€å¯è“ç‰™</h3><p>ç”¨<code>isEnabled()</code>æ¥æ£€æµ‹è“ç‰™æ˜¯å¦å¼€å¯ï¼Œè‹¥æ²¡ç”¨ä½¿ç”¨<code>startActivityForResult()</code> çš„ <code>ACTION_REQUEST_ENABLE</code>æ¥å¯åŠ¨ä¸€ä¸ªactivityæ¥æç¤ºç”¨æˆ·å¯åŠ¨è“ç‰™<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!mBluetoothAdapter.isEnabled()) &#123;</span><br><span class="line">    Intent enableBtIntent = <span class="keyword">new</span> Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);</span><br><span class="line">    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œå®Œåï¼Œä¼šæœ‰ä¸€ä¸ªå¯¹è¯æ¡†å‡ºç°ï¼Œæç¤ºæ‰“å¼€è“ç‰™ï¼Œå¦‚æœç”¨æˆ·ç‚¹å‡» æ˜¯ï¼Œç³»ç»Ÿåˆ™ä¼šæ‰“å¼€è“ç‰™ï¼Œè¿”å›æ‰“å¼€æˆåŠŸ/å¤±è´¥çš„çŠ¶æ€</p>
<p>åœ¨<code>onActivityResult</code>ä¸­æ¥å—è“ç‰™æ‰“å¼€çš„çŠ¶æ€<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">	<span class="comment">//resultCode æ˜¯ä¹‹å‰startActivityForResultä¸­çš„REQUEST_ENABLE_BT</span></span><br><span class="line">	Log.d(TAG, <span class="string">"requestCode:"</span> + requestCode + <span class="string">"\n resultCode: "</span> + resultCode);</span><br><span class="line">	<span class="keyword">if</span> ((requestCode==RESULT_OK)||(requestCode==RESULT_FIRST_USER)) &#123;</span><br><span class="line">		Log.d(TAG, <span class="string">"ï¼›è“ç‰™å¼€å¯æˆåŠŸ"</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		Log.d(TAG, <span class="string">"ï¼›è“ç‰™å¼€å¯å¤±è´¥"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="æŸ¥æ‰¾è®¾å¤‡">æŸ¥æ‰¾è®¾å¤‡</h2><p>ä½¿ç”¨<code>BluetoothAdapter</code>å‘ç°è¿œç¨‹è“ç‰™è®¾å¤‡æˆ–è€…æœ¬åœ°å·²ç»‘å®šçš„è®¾å¤‡<br>è®¾å¤‡æŸ¥æ‰¾æ˜¯ä¸€ä¸ªæ‰«æå‘¨å›´è“ç‰™è®¾å¤‡çš„è¿‡ç¨‹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå‘¨å›´çš„è“ç‰™è®¾å¤‡ä¼šå›åº”ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚è®¾å¤‡åï¼Œç±»ï¼Œmacåœ°å€ç­‰ã€‚åˆ©ç”¨è¿™äº›ä¿¡æ¯ï¼Œå‘èµ·æ‰«æçš„è®¾å¤‡å¯ä»¥é€‰æ‹©ä¸€ä¸ªè®¾å¤‡è¿›è¡Œè¿æ¥</p>
<p>ä¸€æ—¦ç¬¬ä¸€æ¬¡è¿æ¥å‘èµ·æ—¶ï¼Œé…å¯¹è¯·æ±‚ä¼šè‡ªåŠ¨å‘ˆç°ç»™ç”¨æˆ·ï¼Œå½“è®¾å¤‡é…å¯¹åï¼Œè®¾å¤‡çš„åŸºæœ¬ä¿¡æ¯ï¼ˆè®¾å¤‡åï¼Œmacåœ°å€ï¼‰ä¼šè¢«ä¿å­˜ï¼Œè€Œä¸”å¯ä»¥ä½¿ç”¨è“ç‰™çš„APIæ¥å£è¯»å‡ºæ¥ï¼Œä½¿ç”¨å·²çŸ¥çš„macåœ°å€ï¼Œä¸ç”¨æ‰«æï¼Œè¿æ¥å¯ä»¥éšæ—¶å»ºç«‹ã€‚<br>é…å¯¹ä¸ç­‰åŒäºè¿æ¥ã€‚é…å¯¹è¡¨ç¤ºä¸¤ä¸ªè®¾å¤‡çŸ¥é“å½¼æ­¤çš„å­˜åœ¨ï¼Œè¿æ¥è¡¨ç¤ºä¸¤ä¸ªè®¾å¤‡å…±äº«ä¸€ä¸ªRFCOMMå¯ä»¥äº’ç›¸å‘é€æ•°æ®ï¼Œåœ¨è¿›è¡Œæ•°æ®å‘é€ä¹‹å‰ï¼Œè®¾å¤‡å¿…é¡»é…å¯¹ã€‚</p>
<h3 id="æŸ¥è¯¢å·²é…å¯¹çš„è®¾å¤‡">æŸ¥è¯¢å·²é…å¯¹çš„è®¾å¤‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();</span><br><span class="line"><span class="comment">// If there are paired devices</span></span><br><span class="line"><span class="keyword">if</span> (pairedDevices.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Loop through paired devices</span></span><br><span class="line">    <span class="keyword">for</span> (BluetoothDevice device : pairedDevices) &#123;</span><br><span class="line">        <span class="comment">// Add the name and address to an array adapter to show in a ListView</span></span><br><span class="line">        mArrayAdapter.add(device.getName() + <span class="string">"\n"</span> + device.getAddress());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ‰«æè®¾å¤‡">æ‰«æè®¾å¤‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> BroadcastReceiver mReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">            String action = intent.getAction();</span><br><span class="line">            <span class="comment">// When discovery finds a device</span></span><br><span class="line">            <span class="keyword">if</span> (BluetoothDevice.ACTION_FOUND.equals(action)) &#123;</span><br><span class="line">                <span class="comment">// Get the BluetoothDevice object from the Intent</span></span><br><span class="line">                BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);</span><br><span class="line">                <span class="comment">// Add the name and address to an array adapter to show in a ListView</span></span><br><span class="line">                mArrayAdapter.add(device.getName() + <span class="string">"\n"</span> + device.getAddress());</span><br><span class="line">                Log.d(TAG, device.getName() + <span class="string">"\n"</span> + device.getAddress());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="comment">// Register the BroadcastReceiver</span></span><br><span class="line">IntentFilter filter = <span class="keyword">new</span> IntentFilter(BluetoothDevice.ACTION_FOUND);</span><br><span class="line">registerReceiver(mReceiver, filter); <span class="comment">// Don't forget to unregister during onDestroy</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>SCANéœ€è¦BLUETOOTH_ADMINæƒé™</p>
</blockquote>
<h3 id="å¯è¢«æŸ¥æ‰¾">å¯è¢«æŸ¥æ‰¾</h3><p>å¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œç”¨æˆ·ç‚¹å…è®¸åˆ™å¯è¢«å‘ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Intent discoverableIntent = <span class="keyword">new</span></span><br><span class="line">Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE);</span><br><span class="line">discoverableIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, <span class="number">300</span>);</span><br><span class="line">startActivity(discoverableIntent);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å¦‚è¿‡è“ç‰™æœªè¢«å¼€å¯ï¼Œç”¨æˆ·ç‚¹å‡»å¯è¢«å‘ç°æ—¶ï¼Œè“ç‰™è¢«è‡ªåŠ¨å¼€å¯ã€‚</p>
</blockquote>
<p><code>discoverableIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, 300);</code> æœ€åä¸€ä¸ªå‚æ•°æ˜¯å¯è¢«æŸ¥æ‰¾çš„æ—¶é—´ã€‚è®¾ç½®ä¸º0ï¼Œä¸ºä¸€ç›´å¯è¢«å‘ç°ã€‚<br>å¯è¢«æŸ¥æ‰¾çŠ¶æ€æ”¹å˜æ—¶å¸Œæœ›è·å–çŠ¶æ€å¯ä»¥æœ‰ä»¥ä¸‹å®ç°æ–¹å¼ï¼š<br>æ³¨å†Œä¸€ä¸ª<code>ACTION_SCAN_MODE_CHANGED</code>intentå…¶ä¸­ extra fields<code>EXTRA_SCAN_MODE</code>and <code>EXTRA_PREVIOUS_SCAN_MODE</code>è¡¨ç¤ºä¹‹å‰çŠ¶æ€å’Œç°åœ¨çŠ¶æ€</p>
<h2 id="è¿æ¥è®¾å¤‡">è¿æ¥è®¾å¤‡</h2><p>ä¸ºäº†åœ¨ä¸¤ä¸ªè®¾å¤‡å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œéœ€è¦å®ç°serverå’Œclintçš„æ¥å£ï¼Œä¸€ä¸ªè®¾å¤‡æ‰“å¼€server sockerï¼Œå¦ä¸€ä¸ªè®¾å¤‡å¼€å§‹è¿æ¥(ç”¨serverçš„macåœ°å€è¿æ¥)ï¼Œå½“ä»–ä»¬åœ¨åŒä¸€ä¸ªRFCOMMé¢‘é“ä¸Šå»ºç«‹äº†<code>BluetoothSocket</code>è¿æ¥æ—¶ï¼Œåˆ™è®¤ä¸ºä»–ä»¬è¿æ¥ä¸Šäº†ã€‚æ­¤æ—¶è®¾å¤‡å¯ä»¥è·å–è¾“å…¥è¾“å‡ºæµå¯ä»¥å¼€å§‹ä¼ è¾“æ•°æ®ï¼Œæœ¬èŠ‚æè¿°äº†ä¸¤å°è®¾å¤‡ä¹‹é—´åˆå§‹åŒ–è¿æ¥ã€‚</p>
<p>serverå’Œclientè·å–<code>BluetoothSocket</code>çš„æ–¹å¼ä¸åŒã€‚serveråœ¨æ¥å—è¿æ¥æ˜¯ä¼šå¾—åˆ°BluetoothSocketã€‚clientåœ¨å‘æœåŠ¡å™¨ç«¯æ‰“å¼€ä¸€ä¸ªRFCOMMé€šé“æ—¶ä¼šå¾—åˆ°BluetoothSocketã€‚</p>
<h3 id="serverç«¯è¿æ¥">serverç«¯è¿æ¥</h3><p>å½“ä½ å¸Œæœ›è¿æ¥ä¸¤å°è®¾å¤‡ï¼Œä¸€å°è®¾å¤‡å¿…é¡»ä½œä¸ºserveræŒæœ‰å¹¶æ‰“å¼€<code>BluetoothServerSocket</code>ï¼Œä¸ºäº†ç›‘å¬æ¥å—çš„è¿æ¥è¯·æ±‚ï¼Œå½“ä¸€ä¸ªè¯·æ±‚æ¥å—åï¼Œæä¾›ä¸€ä¸ª<code>BluetoothSocket</code>ï¼Œ==å½“è¯¥<code>BluetoothSocket</code>è¢«<code>BluetoothServerSocket</code>è¯·æ±‚æ—¶ï¼Œ<code>BluetoothServerSocket</code>å¯ä»¥ï¼ˆè€Œä¸”åº”å½“ï¼‰è¢«èˆå¼ƒ==</p>
<p>ä¸‹é¢æ˜¯åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨socketå¹¶ä¸”æ¥å—ä¸€ä¸ªè¿æ¥çš„åŸºæœ¬è¿‡ç¨‹ï¼š</p>
<ol>
<li>é€šè¿‡è°ƒç”¨ <code>listenUsingRfcommWithServiceRecord(String, UUID)</code>è·å–ä¸€ä¸ª<code>BluetoothServerSocket</code><br>string æ˜¯ç‹¬ä¸€æ— äºŒçš„ä½ çš„serveråï¼Œç³»ç»Ÿå°†ä¼šæŠŠå®ƒå†™å…¥è®¾å¤‡ä¸­çš„ä¸€ä¸ªæ–°çš„æœåŠ¡å‘ç°åè®®ï¼ˆSDPï¼‰æ•°æ®åº“æ¡ç›®ä¸­ï¼ˆåå­—æ˜¯ä»»æ„çš„ï¼Œå¹¶ä¸”å¯ä»¥åªæ˜¯ä½ åº”ç”¨çš„åå­—ï¼‰ã€‚UUIDåŒæ ·è¢«åŒ…å«åœ¨SDPæ¡ç›®ä¸­ï¼Œå¹¶ä¸”å°†ä¼šæˆä¸ºå’Œå®¢æˆ·ç«¯è®¾å¤‡è¿æ¥åè®®çš„åŸºç¡€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ==å½“å®¢æˆ·ç«¯å°è¯•è¿æ¥è¿™ä¸ªè®¾å¤‡æ—¶ï¼Œå®ƒå°†ä¼šæºå¸¦ä¸€ä¸ªUUIDç”¨äºå”¯ä¸€æŒ‡å®šå®ƒæƒ³è¦è¿æ¥çš„æœåŠ¡å™¨ã€‚==è¿™äº›UUIDså¿…é¡»åŒ¹é…ä»¥ä¾¿è¯¥è¿æ¥å¯ä»¥è¢«æ¥å—ï¼ˆåœ¨ä¸‹ä¸€æ­¥ä¸­ï¼‰ã€‚</li>
<li>é€šè¿‡è°ƒç”¨accept()å¼€å§‹ç›‘å¬è¿æ¥è¯·æ±‚ã€‚<br>è¿™ä¸€ä¸ªé˜»å¡è°ƒç”¨ã€‚åœ¨ä¸€ä¸ªè¿æ¥è¢«æ¥å—æˆ–ä¸€ä¸ªå¼‚å¸¸å‡ºç°æ—¶ï¼Œå®ƒå°†ä¼šè¿”å›ã€‚åªæœ‰å½“ä¸€ä¸ªè¿œç¨‹è®¾å¤‡ä½¿ç”¨ä¸€ä¸ªUUIDå‘é€äº†ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥UUIDå’Œæ­£åœ¨ç›‘å¬çš„æœåŠ¡å™¨socketæ³¨å†Œçš„UUIDç›¸åŒ¹é…æ—¶ï¼Œä¸€ä¸ªè¿æ¥æ‰ä¼šè¢«æ¥å—ã€‚æˆåŠŸåï¼Œaccept() å°†ä¼šè¿”å›ä¸€ä¸ªå·²è¿æ¥çš„ <code>BluetoothSocket</code>ã€‚</li>
<li>è°ƒç”¨close()ï¼Œé™¤éä½ æƒ³è¦æ¥å—æ›´å¤šçš„è¿æ¥ã€‚<br>è¿™å°†é‡Šæ”¾æœåŠ¡å™¨socketå’Œå®ƒæ‰€æœ‰çš„èµ„æºï¼Œä½†æ˜¯ä¸ä¼šå…³é—­ accept()è¿”å›çš„å·²è¿æ¥çš„ BluetoothSocketã€‚ä¸åŒäºTCP/IPï¼ŒRFCOMMä»…ä»…å…è®¸æ¯ä¸€ä¸ªé€šé“ä¸Šåœ¨æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå·²è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå› æ­¤åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åœ¨æ¥å—ä¸€ä¸ªå·²è¿æ¥çš„socketåï¼Œåœ¨BluetoothServerSocketä¸Šè°ƒç”¨ close() æ˜¯éå¸¸å¿…è¦çš„ã€‚</li>
</ol>
<p>accept() ä¸åº”è¯¥å†ä¸»æ´»åŠ¨UIçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªé˜»å¡è°ƒç”¨ï¼Œå¹¶ä¸”å°†ä¼šé˜»æ­¢ä»»ä½•ä¸åº”ç”¨çš„äº¤äº’è¡Œä¸ºã€‚å®ƒé€šå¸¸åœ¨ä½ çš„åº”ç”¨ç®¡ç†çš„ä¸€ä¸ªæ–°çš„çº¿ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªBluetoothServerSocket æˆ– BluetoothSocket æ¥å®Œæˆæ‰€æœ‰å·¥ä½œã€‚ä¸ºäº†ä¸­æ­¢ä¸€ä¸ªé˜»å¡è°ƒç”¨ï¼Œä¾‹å¦‚accept()ï¼Œä»ä½ çš„å…¶ä»–çº¿ç¨‹é‡Œåœ¨BluetoothServerSocket (æˆ– BluetoothSocket) ä¸Šè°ƒç”¨ close() ï¼Œç„¶åé˜»å¡è°ƒç”¨å°±ä¼šç«‹å³è¿”å›ã€‚æ³¨æ„åœ¨ BluetoothServerSocket æˆ– BluetoothSocket ä¸Šæ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„çº¿ç¨‹ï¼Œç”¨äºæœåŠ¡å™¨ç«¯æ¥å—å¤–æ¥çš„è¿æ¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothServerSocket mmServerSocket;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AcceptThread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Use a temporary object that is later assigned to mmServerSocket,</span></span><br><span class="line">        <span class="comment">// because mmServerSocket is final</span></span><br><span class="line">        BluetoothServerSocket tmp = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// MY_UUID is the app's UUID string, also used by the client code</span></span><br><span class="line">            tmp = mBluetoothAdapter.listenUsingRfcommWithServiceRecord(NAME, MY_UUID);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">        mmServerSocket = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        BluetoothSocket socket = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// Keep listening until exception occurs or a socket is returned</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                socket = mmServerSocket.accept();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// If a connection was accepted</span></span><br><span class="line">            <span class="keyword">if</span> (socket != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// Do work to manage the connection (in a separate thread)</span></span><br><span class="line">                manageConnectedSocket(socket);</span><br><span class="line">                mmServerSocket.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/** Will cancel the listening socket, and cause the thread to finish */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmServerSocket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„å½“accept()è¿”å›ä¸€ä¸ª BluetoothSocketæ˜¯ï¼Œè¯¥socketå·²ç»è¢«è¿æ¥äº†ï¼Œå› æ­¤ä½ ä¸åº”è¯¥è°ƒç”¨connect().<br>manageConnectedSocket()æ˜¯ä¸€ä¸ªè™šæ„çš„æ–¹æ³•ï¼Œå®ƒå°†ä¼šåˆå§‹åŒ–çº¿ç¨‹æ¥ä¼ è¾“æ•°æ®ï¼Œä¸‹ä¸‹èŠ‚è®¨è®ºã€‚<br>å½“ç›‘å¬åˆ°äº†å¤–æ¥çš„è¿æ¥æ—¶ï¼Œé€šå¸¸æ˜¯å…³é—­<code>BluetoothServerSocket</code>ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œ ä¸€æ—¦å¾—åˆ°äº† BluetoothSocket å°±ä¼šè°ƒç”¨close()ã€‚</p>
<h3 id="å®¢æˆ·ç«¯è¿æ¥">å®¢æˆ·ç«¯è¿æ¥</h3><p>ä¸ºäº†å’Œä¸€ä¸ªè¿œç¨‹è®¾å¤‡ï¼ˆä¸€ä¸ªæŒæœ‰æœåŠ¡å™¨socketçš„è®¾å¤‡ï¼‰åˆå§‹åŒ–ä¸€ä¸ªè¿æ¥ï¼Œä½ å¿…é¡»é¦–å…ˆå¾—åˆ°ä¸€ä¸ª <code>BluetoothDevice</code> å¯¹è±¡æ¥è¡¨ç¤ºè¿™ä¸ªè¿œç¨‹è®¾å¤‡ã€‚ï¼ˆä¸Šé¢çš„è¯¾ç¨‹Finding Devicesè®²è¿°äº†å¦‚ä½•å¾—åˆ°ä¸€ä¸ª BluetoothDevice ï¼‰ã€‚ç„¶åä½ å¿…é¡»ä½¿ç”¨<code>BluetoothDevice</code>æ¥å¾—åˆ°ä¸€ä¸ª<code>BluetoothSocket</code> ï¼Œç„¶ååˆå§‹åŒ–è¯¥è¿æ¥ã€‚<br>ä¸‹é¢æ˜¯åŸºæœ¬çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>é€šè¿‡è°ƒç”¨createRfcommSocketToServiceRecord(UUID)æ¥å¾—åˆ°ä¸€ä¸ª BluetoothSocket ã€‚</li>
<li>é€šè¿‡è°ƒç”¨connect()åˆå§‹åŒ–ä¸€ä¸ªè¿æ¥ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯åˆå§‹åŒ–ä¸€ä¸ªè“ç‰™è¿æ¥çš„åŸºæœ¬ä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothDevice mmDevice;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConnectThread</span><span class="params">(BluetoothDevice device)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Use a temporary object that is later assigned to mmSocket,</span></span><br><span class="line">        <span class="comment">// because mmSocket is final</span></span><br><span class="line">        BluetoothSocket tmp = <span class="keyword">null</span>;</span><br><span class="line">        mmDevice = device;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Get a BluetoothSocket to connect with the given BluetoothDevice</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// MY_UUID is the app's UUID string, also used by the server code</span></span><br><span class="line">            tmp = device.createRfcommSocketToServiceRecord(MY_UUID);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">        mmSocket = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Cancel discovery because it will slow down the connection</span></span><br><span class="line">        mBluetoothAdapter.cancelDiscovery();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Connect the device through the socket. This will block</span></span><br><span class="line">            <span class="comment">// until it succeeds or throws an exception</span></span><br><span class="line">            mmSocket.connect();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException connectException) &#123;</span><br><span class="line">            <span class="comment">// Unable to connect; close the socket and get out</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mmSocket.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException closeException) &#123; &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Do work to manage the connection (in a separate thread)</span></span><br><span class="line">        manageConnectedSocket(mmSocket);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/** Will cancel an in-progress connection, and close the socket */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmSocket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>åœ¨è¿æ¥å‰æœ€å¥½è°ƒç”¨cancelDiscovery()ã€‚</p>
</blockquote>
<h2 id="ç®¡ç†ä¸€ä¸ªè¿æ¥">ç®¡ç†ä¸€ä¸ªè¿æ¥</h2><p>å½“ä½ æˆåŠŸè¿æ¥ä¸¤ä¸ªï¼ˆæˆ–æ›´å¤šï¼‰è®¾å¤‡åï¼Œæ¯ä¸€ä¸ªéƒ½å°†æœ‰ä¸€ä¸ªå·²è¿æ¥çš„ BluetoothSocketã€‚æ­¤æ—¶å°±å¯ä»¥åœ¨ä¸åŒçš„è®¾å¤‡ä¹‹é—´å…±äº«æ•°æ®äº†ï¼</p>
<ol>
<li>åˆ†åˆ«é€šè¿‡getInputStream() å’Œ getOutputStream()æ¥å¾—åˆ° <code>InputStream</code> å’Œ <code>OutputStream</code> æ¥æ§åˆ¶socketä¹‹é—´çš„ä¼ è¾“ã€‚</li>
<li>ä½¿ç”¨ read(byte[]) å’Œ write(byte[])æ¥å‘æ•°æ®æµä¸­è¯»å–å’Œå†™å…¥æ•°æ®ã€‚</li>
</ol>
<p>é¦–å…ˆå¹¶ä¸”æœ€é‡è¦çš„æ˜¯ï¼Œä½ åº”è¯¥ä¸ºæ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®æµä½¿ç”¨ä¸€ä¸ªä¸“å±çš„çº¿ç¨‹ã€‚è¿™æ˜¯ååˆ†é‡è¦çš„ï¼Œå› ä¸ºread(byte[]) å’Œ write(byte[])æ–¹æ³•éƒ½æ˜¯é˜»å¡è°ƒç”¨ã€‚ read(byte[])å°†ä¼šå‘ç”Ÿé˜»å¡çŸ¥é“é€æ•°æ®æµä¸­è¯»å–åˆ°äº†ä¸€äº›ä¸œè¥¿ã€‚ write(byte[])ä¸ç»å¸¸å‘ç”Ÿé˜»å¡ï¼Œä½†æ˜¯å½“è¿œç¨‹è®¾å¤‡æ²¡æœ‰è¶³å¤Ÿè¿…é€Ÿåœ°è°ƒç”¨ read(byte[])è€Œä¸­é—´ç¼“å†²åŒºå·²ç»è´Ÿè½½æ—¶å¯ä»¥é˜»å¡ã€‚å› æ­¤ï¼Œä½ çš„çº¿ç¨‹ä¸­çš„ä¸»è¦å¾ªç¯åº”è¯¥æ˜¯ä¸“é—¨ä»InputStreamä¸­è¯»å–æ•°æ®çš„ã€‚ä¸€ä¸ªå•ç‹¬çš„å…¬å…±æ–¹æ³•å¯ä»¥è¢«ç”¨äºåˆå§‹åŒ–å‘ OutputStream ä¸­å†™å…¥æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ConnectedThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BluetoothSocket mmSocket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InputStream mmInStream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OutputStream mmOutStream;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConnectedThread</span><span class="params">(BluetoothSocket socket)</span> </span>&#123;</span><br><span class="line">        mmSocket = socket;</span><br><span class="line">        InputStream tmpIn = <span class="keyword">null</span>;</span><br><span class="line">        OutputStream tmpOut = <span class="keyword">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Get the input and output streams, using temp objects because</span></span><br><span class="line">        <span class="comment">// member streams are final</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            tmpIn = socket.getInputStream();</span><br><span class="line">            tmpOut = socket.getOutputStream();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line"> </span><br><span class="line">        mmInStream = tmpIn;</span><br><span class="line">        mmOutStream = tmpOut;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];  <span class="comment">// buffer store for the stream</span></span><br><span class="line">        <span class="keyword">int</span> bytes; <span class="comment">// bytes returned from read()</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Keep listening to the InputStream until an exception occurs</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Read from the InputStream</span></span><br><span class="line">                bytes = mmInStream.read(buffer);</span><br><span class="line">                <span class="comment">// Send the obtained bytes to the UI activity</span></span><br><span class="line">                mHandler.obtainMessage(MESSAGE_READ, bytes, -<span class="number">1</span>, buffer)</span><br><span class="line">                        .sendToTarget();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* Call this from the main activity to send data to the remote device */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmOutStream.write(bytes);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* Call this from the main activity to shutdown the connection */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mmSocket.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„é€ å™¨éœ€è¦å¿…é¡»çš„æ•°æ®æµï¼Œå¹¶ä¸”ä¸€æ—¦æ‰§è¡Œï¼Œçº¿ç¨‹å°†ä¼šç­‰å¾…InputStream ä¸­æ¥çš„æ•°æ®ã€‚å½“ read(byte[]) è¿”å›ä¸€äº›æ•°å€¼æ—¶ï¼Œæ•°æ®å°†ä¼šä½¿ç”¨ä¸€ä¸ªçˆ¶ç±»çš„ä¸€ä¸ªæˆå‘˜å˜é‡å¥æŸ„å‘é€ç»™ä¸»æ´»åŠ¨ã€‚ç„¶åå®ƒè¿”å›å¹¶ç»§ç»­ç­‰å¾…æ›´å¤šçš„æ•°æ®ã€‚</p>
<p>å‘é€æ•°æ®åªéœ€è¦åœ¨ä¸»æ´»åŠ¨ä¸­è°ƒç”¨çº¿ç¨‹çš„ write()æ–¹æ³•ï¼Œå¹¶å°†éœ€è¦å‘é€æ•°æ®ä¼ é€’ç»™å®ƒå³å¯ã€‚è¿™ä¸ªæ–¹æ³•ç„¶åè°ƒç”¨ write(byte[])æ¥å‘è¿œç¨‹è®¾å¤‡å‘é€æ•°æ®ã€‚</p>
<p>çº¿ç¨‹çš„cancel() æ–¹æ³•æ˜¯é‡è¦çš„ï¼Œä»¥ä¾¿è¿æ¥å¯ä»¥åœ¨ä»»ä½•æ—¶é—´è¢«ä¸­æ–­ï¼ˆé€šè¿‡å…³é—­BluetoothSocketï¼‰ã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥åœ¨ä½ å®Œæˆè“ç‰™è¿æ¥åæ€»æ˜¯è¢«è°ƒç”¨ã€‚</p>
<p>è“ç‰™sampleçš„ä¾‹å­ ï¼š<a href="http://developer.android.com/samples/index.html" target="_blank" rel="external">http://developer.android.com/samples/index.html</a></p>
<h2 id="ä½¿ç”¨é…ç½®æ–‡ä»¶">ä½¿ç”¨é…ç½®æ–‡ä»¶</h2><p>å¾…ç»­<br>å‚è€ƒ</p>
<blockquote>
<p><a href="http://developer.android.com/guide/topics/connectivity/bluetooth.html" target="_blank" rel="external">http://developer.android.com/guide/topics/connectivity/bluetooth.html</a><br><a href="http://blog.csdn.net/candycat1992/article/details/8577927" target="_blank" rel="external">http://blog.csdn.net/candycat1992/article/details/8577927</a></p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[å‚è€ƒå®˜æ–¹æ–‡æ¡£]]>
    
    </summary>
    
      <category term="android" scheme="http://yoursite.com/tags/android/"/>
    
      <category term="bluetooth" scheme="http://yoursite.com/tags/bluetooth/"/>
    
      <category term="android" scheme="http://yoursite.com/categories/android/"/>
    
  </entry>
  
</feed>