<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="o97_geJ8Rz-PdvGXQ3H64C2krv2YSDEYxiyUnAZ3buY" />
  
  <title>Android 触摸事件传递机制 | Xu Yushi&#39;&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="android,触摸事件">
  

  <meta name="description" content="[TOC]
Android 触摸事件传递机制之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递
View常用监听方法view表示没有子空间的布局，例如textview、button等，MotionEvent分为三种

MotionEvent.ACTION_DOWN：按下时候
MotionEvent.ACTION_MOVE：滑动时
Mo">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 触摸事件传递机制">
<meta property="og:url" content="http://yoursite.com/2015/07/14/Android 触摸事件传递机制/index.html">
<meta property="og:site_name" content="Xu Yushi''s Blog">
<meta property="og:description" content="[TOC]
Android 触摸事件传递机制之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递
View常用监听方法view表示没有子空间的布局，例如textview、button等，MotionEvent分为三种

MotionEvent.ACTION_DOWN：按下时候
MotionEvent.ACTION_MOVE：滑动时
Mo">
<meta property="og:updated_time" content="2016-02-03T04:02:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 触摸事件传递机制">
<meta name="twitter:description" content="[TOC]
Android 触摸事件传递机制之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递
View常用监听方法view表示没有子空间的布局，例如textview、button等，MotionEvent分为三种

MotionEvent.ACTION_DOWN：按下时候
MotionEvent.ACTION_MOVE：滑动时
Mo">
  
  

  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '[object Object]', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



  

	<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
</head>

<body>
	<!-- header -->
  
<header class="md-header md-header--half">
  <div class="md-header__wrapper">
		<div class="md-header__toolbar">
			<h1 class="md-header__logo">
				<a class="md-touch-target" href="/"></a>
			</h1>
			<div class="md-header__search-bar">
				<form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="index.search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
			</div>
			<div class="md-header__menu-button-wrapper">
				<button id="md-header__menu-button">
					<i class="fa fa-bars"></i>
				</button> 
				<ul id="md-header__navigations">
						<li><a href="/">index.home</a></li>
						<li><a href="/about">index.about</a></li>
						<li><a href="/archives">index.archives</a></li>
						<ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/android/">android</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/java/">java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/随笔/">随笔</a></li></ul>
			</ul>
			</div>
		</div>
		<div class="md-header__toolbar-spacer md-header__toolbar-spacer--hide"></div>
		<div class="md-header__details">
			<h1 class="md-header__title md-header__title--hide">Android 触摸事件传递机制</h1>
				<h2 class="md-header__subtitle md-header__subtitle--hide">
						<p class="subtitle">低调、务实、自驱、反思</p>
					</h2>
	</div>
	</div>
</header>

  
  <!-- main -->
  <div class="md-content__wrapper">
	  <!-- main -->
	  <main class="md-main">
	    
 
		<article class="md-post--expand md-post--float ">	
			<div class="md-post__details">
				<div class="md-flex--row md-flex--align md-post__title">
						<h2>
							Android 触摸事件传递机制
							<a href="/2015/07/14/Android 触摸事件传递机制/" class="md-touch-target"></a>
						</h2>
						<!-- social media sharing is currently not supported yet -->
						<!--<i class="material-icons">share</i>-->
					</div>
					<span class="md-post__time"><time datetime="2015-07-14T12:13:00.000Z" itemprop="datePublished">Jul 14 2015</time></span>
		
				<div class="md-post__content">
					<p>[TOC]</p>
<h1 id="Android_触摸事件传递机制">Android 触摸事件传递机制</h1><p>之前在设置监听事件遇到了一些问题，今天参考学习了一些文档和博客，记录总结view和viewgroup的触摸事件传递</p>
<h2 id="View">View</h2><h3 id="常用监听方法">常用监听方法</h3><p>view表示没有子空间的布局，例如textview、button等，MotionEvent分为三种</p>
<ul>
<li>MotionEvent.ACTION_DOWN：按下时候</li>
<li>MotionEvent.ACTION_MOVE：滑动时</li>
<li>MotionEvent.ACTION_UP：抬起时</li>
</ul>
<p>常用两种监听事件</p>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">******.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;		</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line"></span><br><span class="line">*******.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="annotation">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span></span>&#123;</span><br><span class="line">				<span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">	</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：setOnTouchListener中最后返回的是false</p>
</blockquote>
<p>通常一个按键触发的顺序是：</p>
<ol>
<li>onClick-&gt;MotionEvent.ACTION_DOWN</li>
<li>onClick-&gt;MotionEvent.ACTION_UP</li>
<li>OnClickListener</li>
</ol>
<p>若在setOnTouchListener返回true，则不会执行OnClickListener方法</p>
<h3 id="分析源码">分析源码</h3><p>在Button中并未发现dispatchTouchEvent代码，向上寻找，Button-&gt;TextVIew-&gt;View，在view中发现dispatchTouchEvent函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">     * Pass the touch screen motion event down to the target view, or this</span><br><span class="line">     * view if it is the target.</span><br><span class="line">     *</span><br><span class="line">     * <span class="doctag">@param</span> event The motion event to be dispatched.</span><br><span class="line">     * <span class="doctag">@return</span> True if the event was handled by the view, false otherwise.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// If the event should be handled by accessibility focus first.</span></span><br><span class="line">        <span class="keyword">if</span> (event.isTargetAccessibilityFocus()) &#123;</span><br><span class="line">            <span class="comment">// We don't have focus or no virtual descendant has it, do not handle the event.</span></span><br><span class="line">            <span class="keyword">if</span> (!isAccessibilityFocusedViewOrHost()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// We have focus and got the event, then use normal event dispatch.</span></span><br><span class="line">            event.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mInputEventConsistencyVerifier.onTouchEvent(event, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = event.getActionMasked();</span><br><span class="line">        <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">            <span class="comment">// Defensive cleanup for new gesture</span></span><br><span class="line">            stopNestedScroll();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (onFilterTouchEventForSecurity(event)) &#123;</span><br><span class="line">            <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">            ListenerInfo li = mListenerInfo;</span><br><span class="line">            <span class="keyword">if</span> (li != <span class="keyword">null</span> &amp;&amp; li.mOnTouchListener != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED</span><br><span class="line">                    &amp;&amp; li.mOnTouchListener.onTouch(<span class="keyword">this</span>, event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!result &amp;&amp; onTouchEvent(event)) &#123;</span><br><span class="line">                result = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>注意 if (li != null &amp;&amp; <strong>li.mOnTouchListener != null</strong>                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {</p>
<p>mOnTouchListener即注册的touch监听事件。</p>
<p>当li.mOnTouchListener 返回true时，result = true</p>
<p>在onTouchEvent中依次调用performClick()-&gt;li.mOnClickListener.onClick(this);</p>
<p>最终会回调用户注册的onclick函数</p>
<p>d</p>
<h3 id="测试代码">测试代码</h3><h4 id="主Activity">主Activity</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarActivity;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MyButton button;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        button = (MyButton) findViewById(R.id.button_id);</span><br><span class="line"></span><br><span class="line">        button.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                        Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnTouchListener()-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                        Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnTouchListener()-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"OnClickListener()-&gt;"</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"dispatchTouchEvent()-&gt;"</span>+<span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"dispatchTouchEvent()-&gt;"</span>+ <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"onTouchEvent()-&gt;"</span>+<span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"onTouchEvent()-&gt;"</span>+ <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="自定义Button">自定义Button</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/2.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyButton</span> <span class="keyword">extends</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//注意 这里第二个参数不能省略，否则会导致崩溃，之后有时间学习研究</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyButton</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"onTouchEvent-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"onTouchEvent-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"dispatchTouchEvent-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MyButton-&gt;"</span> + <span class="string">"dispatchTouchEvent-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="布局文件">布局文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span> <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">io.github.xuyushi.toucheventtest.MyButton</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/button_id"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"button"</span></span><br><span class="line">        <span class="attribute">android:textSize</span>=<span class="value">"30dp"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="log">log</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnClickListener()-&gt;</span><br></pre></td></tr></table></figure>
<h4 id="若修改MyButton_dispatchTouchEvent返回值为true时">若修改MyButton dispatchTouchEvent返回值为true时</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br></pre></td></tr></table></figure>
<p>事件先由Activity的dispatchTouchEvent进行分发，然后TestButton的dispatchTouchEvent进行分发，接着执行onTouch监听，然后执行onTouchEvent。第二次UP动作的时候，在onTouchEvent里又执行了onClick监听</p>
<h4 id="若修改MyButton_onTouchEvent返回值为true时">若修改MyButton onTouchEvent返回值为true时</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">D/TouchEventTest﹕ MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：这里和参考博客的结果不一样，因为在dispatchTouchEvent源码中，进行之前做<strong> if (li != null &amp;&amp; </strong>li.mOnTouchListener != null<strong>                    &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED                    &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {</strong>判断后，执行的是<code>result = true;</code>并不是 <code>return true;</code> 所以<code>onTouchEvent</code> 依然会执行</p>
</blockquote>
<p>所以只少一个 OnClickListener未执行</p>
<h2 id="ViewGroup">ViewGroup</h2><p>ViewGroup比View多一个onInterceptTouchEvent方法，此方法是用来拦截事件，拦截之后ViewGroup中的子布局是接受不到事件了。</p>
<h3 id="源码修改">源码修改</h3><h4 id="自定义布局">自定义布局</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.xuyushi.toucheventtest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.widget.LinearLayout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by xuyushi on 15/8/2.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLinearLayout</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"TouchEventTest"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyLinearLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"dispatchTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"dispatchTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (ev.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onInterceptTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onInterceptTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onTouchEvent-&gt;ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.i(TAG, <span class="string">"MyLinearLayout-&gt;"</span>+<span class="string">"onTouchEvent-&gt;ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="主activity增加监听">主activity增加监听</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mylayout.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">switch</span>(event.getAction())&#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"setOnTouchListener()-&gt;"</span> + <span class="string">"ACTION_DOWN"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</span><br><span class="line">                Log.d(TAG, <span class="string">"MainActivity-&gt;"</span> + <span class="string">"setOnTouchListener()-&gt;"</span> + <span class="string">"ACTION_UP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mylayout.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag"><span class="keyword">TODO</span></span> Auto-generated method stub</span></span><br><span class="line">        Log.i(TAG, <span class="string">"MainActivity--mylayout-onClick..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="LOG">LOG</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyButton-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">MyButton-&gt;onTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;onTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyButton-&gt;<span class="built_in">test</span>Btn---onClick</span><br><span class="line">MainActivity-&gt;OnClickListener()</span><br></pre></td></tr></table></figure>
<p>如果将Linearlayout的onInterceptTouchEvent 改成return true</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_DOWN</span><br><span class="line">MainActivity-&gt;dispatchTouchEvent()-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;dispatchTouchEvent-&gt;ACTION_UP</span><br><span class="line">MyLinearLayout-&gt;onInterceptTouchEvent-&gt;ACTION_UP</span><br><span class="line">MainActivity-&gt;OnTouchListener()-&gt;ACTION_UP</span><br><span class="line">MainActivity--mylayout-onClick...</span><br></pre></td></tr></table></figure>
<p>由此可见，当onInterceptTouchEvent 返回ture之后，button接受不到事件了，只执行MyLinearLayout中的OnTouch 和OnClick了</p>
<h2 id="总结">总结</h2><p>1、如果是自定义复合控件，如图片+文字，我再Activity里给你注册了onClick监听，期望点击它执行。那么最简单的方法就是将图片+文字的父布局，也即让其容器ViewGroup的秘书将事件拦下，这样父亲就可以执行onClick了。这时候的父亲就像一个独立的孩子一样了(View)，再也不用管它的孩子了,可以正常onClick onTouch.</p>
<p>2、如果希望一个View只onTouch而不onClick，在onTouch里return true就ok了。</p>
<p>3、dispatch是为了onTouch监听，onTouchEvent是为了onClick监听。</p>
<p>4、自定义布局时，一般情况下：</p>
<p>@Override</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onTouchEvent</span><span class="params">(event)</span></span>;}  
</code></pre><p>@Override</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>{<span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">dispatchTouchEvent</span><span class="params">(event)</span></span>;

我们可以复写，但是最后的<span class="keyword">super</span>.***是万万不能少滴。如果少了，表示连dispatch*** onTouchEvent压根就不调用了，事件就此打住。
</code></pre><h1 id="Android_事件分发机制结论">Android 事件分发机制结论</h1><h2 id="View-1">View</h2><p>不管是DOWN，MOVE，UP都会按照下面的顺序执行：</p>
<ol>
<li>dispatchTouchEvent  （view中）</li>
<li>setOnTouchListener的onTouch （监听事件设置 activity 中）</li>
<li>onTouchEvent （view中）</li>
</ol>
<p>在dispatchTouchEvent中会进行OnTouchListener的判断，如果OnTouchListener不为null且返回true，则表示事件被消费，onTouchEvent不会被执行；否则执行onTouchEvent。</p>
<h2 id="ViewGroup-1">ViewGroup</h2><p>可以看到大体的事件流程为：<br>MyLinearLayout的dispatchTouchEvent -&gt; MyLinearLayout的onInterceptTouchEvent -&gt; MyButton的dispatchTouchEvent -&gt;Mybutton的onTouchEvent </p>
<p>可以看出，在View上触发事件，最先捕获到事件的为View所在的ViewGroup，然后才会到View自身~</p>
<h3 id="事件拦截">事件拦截</h3><p>ViewGroup 与 View 不同的是，可以对事件进行拦截，使子 view 是否能接受到事件。<br>复写ViewGroup的onInterceptTouchEvent方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line">    <span class="keyword">int</span> action = ev.getAction();  </span><br><span class="line">    <span class="keyword">switch</span> (action)  </span><br><span class="line">    &#123;  </span><br><span class="line">    <span class="keyword">case</span> MotionEvent.ACTION_DOWN:  </span><br><span class="line">        <span class="comment">//如果你觉得需要拦截  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span> ;   </span><br><span class="line">    <span class="keyword">case</span> MotionEvent.ACTION_MOVE:  </span><br><span class="line">        <span class="comment">//如果你觉得需要拦截  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span> ;   </span><br><span class="line">    <span class="keyword">case</span> MotionEvent.ACTION_UP:  </span><br><span class="line">        <span class="comment">//如果你觉得需要拦截  </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span> ;   </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>默认是不拦截的，即返回false；如果你需要拦截，只要return true就行了，这要该事件就不会往子View传递了，并且如果你在DOWN retrun true ，则DOWN,MOVE,UP子View都不会捕获事件；如果你在MOVE return true , 则子View在MOVE和UP都不会捕获事件。</p>
<h3 id="如何不被拦截">如何不被拦截</h3><p>如果ViewGroup的onInterceptTouchEvent(ev) 当ACTION_MOVE时return true ，即拦截了子View的MOVE以及UP事件；</p>
<p>此时子View希望依然能够响应MOVE和UP时该咋办呢？</p>
<p>Android给我们提供了一个方法：requestDisallowInterceptTouchEvent(boolean) 用于设置是否允许拦截，我们在子View的dispatchTouchEvent中直接这么写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span>  </span><br><span class="line">    </span>&#123;  </span><br><span class="line">        getParent().requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);    </span><br><span class="line">        <span class="keyword">int</span> action = event.getAction();  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">switch</span> (action)  </span><br><span class="line">        &#123;  </span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:  </span><br><span class="line">            Log.e(TAG, <span class="string">"dispatchTouchEvent ACTION_DOWN"</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:  </span><br><span class="line">            Log.e(TAG, <span class="string">"dispatchTouchEvent ACTION_MOVE"</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP:  </span><br><span class="line">            Log.e(TAG, <span class="string">"dispatchTouchEvent ACTION_UP"</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">default</span>:  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>getParent().requestDisallowInterceptTouchEvent(true);  这样即使ViewGroup在MOVE的时候return true，子View依然可以捕获到MOVE以及UP事件。</p>
<ol>
<li>如果ViewGroup找到了能够处理该事件的View，则直接交给子View处理，自己的onTouchEvent不会被触发；</li>
<li>可以通过复写onInterceptTouchEvent(ev)方法，拦截子View的事件（即return true），把事件交给自己处理，则会执行自己对应的onTouchEvent方法</li>
<li>子View可以通过调用getParent().requestDisallowInterceptTouchEvent(true);  阻止ViewGroup对其MOVE或者UP事件进行拦截；</li>
</ol>
<blockquote>
<p>比如你需要写一个类似slidingmenu的左侧隐藏menu，主Activity上有个Button、ListView或者任何可以响应点击的View，你在当前View上死命的滑动，菜单栏也出不来；因为MOVE事件被子View处理了~ 你需要这么做：在ViewGroup的dispatchTouchEvent中判断用户是不是想显示菜单，如果是，则在onInterceptTouchEvent(ev)拦截子View的事件；自己进行处理，这样自己的onTouchEvent就可以顺利展现出菜单栏了~~</p>
</blockquote>
<h1 id="参考">参考</h1><blockquote>
<p><a href="http://blog.csdn.net/yanzi1225627/article/details/22592831" target="_blank" rel="external">http://blog.csdn.net/yanzi1225627/article/details/22592831</a><br><a href="http://blog.csdn.net/guolin_blog/article/details/9097463" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/9097463</a><br><a href="http://www.cnblogs.com/sunzn/archive/2013/05/10/3064129.html" target="_blank" rel="external">http://www.cnblogs.com/sunzn/archive/2013/05/10/3064129.html</a></p>
</blockquote>

				</div>
			</div>
			<div class="md-divider"></div>
				
				<footer class="md-post__footer">
					<div class="md-post__footer-pic"></div>
					<div class="md-flex--column">
						<span class="md-post__footer-label">Written by</span>
						<span class="md-post__footer-author">Xu Yushi</span>
						<div class="md-post__footer-social-media">
							<a href="#"><i class="fa fa-facebook"></i></a>
							<a href="#"><i class="fa fa-twitter"></i></a>
						</div>
					</div>
						<div class="md-post__footer-more-articles">
								<div class="md-post__footer-more-articles--prev">
									<a href="/2015/08/15/robolectric/" class="md-touch-target"></a>
										<i class="material-icons">navigate_before</i>
										<span class="md-post__footer-more-title"><span>Previous:</span> robolectric</span>
							</div>
								<div class="md-post__footer-more-articles--next">
									<a href="/2015/07/12/volley学习/" class="md-touch-target"></a>
										<span class="md-post__footer-more-title"><span>Next:</span> volley学习</span>
										<i class="material-icons">navigate_next</i>
							</div>
							</div>
			</footer>
	</article>



	  </main>
  </div>
  
  <!-- js scripts -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/drawer.js" type="text/javascript"></script>
<script src="/js/tiles.js" type="text/javascript"></script>

</body>
</html>
